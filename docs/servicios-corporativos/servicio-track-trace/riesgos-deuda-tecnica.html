<!doctype html>
<html lang="es" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-servicios-corporativos/servicio-track-trace/riesgos-deuda-tecnica" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">11. Riesgos y deuda técnica | Talma</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jclemente-tlm.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jclemente-tlm.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jclemente-tlm.github.io/docs/servicios-corporativos/servicio-track-trace/riesgos-deuda-tecnica"><meta data-rh="true" property="og:locale" content="es"><meta data-rh="true" name="docusaurus_locale" content="es"><meta data-rh="true" name="docsearch:language" content="es"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="11. Riesgos y deuda técnica | Talma"><meta data-rh="true" name="description" content="11.1 Riesgos identificados"><meta data-rh="true" property="og:description" content="11.1 Riesgos identificados"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jclemente-tlm.github.io/docs/servicios-corporativos/servicio-track-trace/riesgos-deuda-tecnica"><link data-rh="true" rel="alternate" href="https://jclemente-tlm.github.io/docs/servicios-corporativos/servicio-track-trace/riesgos-deuda-tecnica" hreflang="es"><link data-rh="true" rel="alternate" href="https://jclemente-tlm.github.io/docs/servicios-corporativos/servicio-track-trace/riesgos-deuda-tecnica" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Servicios Corporativos","item":"https://jclemente-tlm.github.io/docs/servicios-corporativos"},{"@type":"ListItem","position":2,"name":"Servicio Track & Trace","item":"https://jclemente-tlm.github.io/docs/servicios-corporativos/servicio-track-trace"},{"@type":"ListItem","position":3,"name":"11. Riesgos y deuda técnica","item":"https://jclemente-tlm.github.io/docs/servicios-corporativos/servicio-track-trace/riesgos-deuda-tecnica"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Talma RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Talma Atom Feed"><link rel="stylesheet" href="/assets/css/styles.b81aad75.css">
<script src="/assets/js/runtime~main.42c40199.js" defer="defer"></script>
<script src="/assets/js/main.6506ae19.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo-talma.png"><div role="region" aria-label="Saltar al contenido principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Saltar al contenido principal</a></div><nav aria-label="Principal" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Alternar barra lateral" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-talma.png" alt="Talma Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-talma.png" alt="Talma Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentación</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Cambiar entre modo oscuro y claro (actualmente system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Volver al principio" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Barra lateral de Documentos" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introducción</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/lineamientos">Lineamientos</a><button aria-label="Ampliar la categoría &#x27;Lineamientos&#x27; de la barra lateral" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/adrs">ADRs</a><button aria-label="Ampliar la categoría &#x27;ADRs&#x27; de la barra lateral" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/servicios-corporativos">Servicios Corporativos</a><button aria-label="Colapsar categoría &#x27;Servicios Corporativos&#x27; de la barra lateral" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/servicios-corporativos/api-gateway">API Gateway</a><button aria-label="Ampliar la categoría &#x27;API Gateway&#x27; de la barra lateral" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/servicios-corporativos/servicio-identidad">Servicio de Identidad</a><button aria-label="Ampliar la categoría &#x27;Servicio de Identidad&#x27; de la barra lateral" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/servicios-corporativos/servicio-mensajeria-sita">Servicio de Mensajería SITA</a><button aria-label="Ampliar la categoría &#x27;Servicio de Mensajería SITA&#x27; de la barra lateral" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/servicios-corporativos/servicio-notificacion">Servicio de Notificación</a><button aria-label="Ampliar la categoría &#x27;Servicio de Notificación&#x27; de la barra lateral" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace">Servicio Track &amp; Trace</a><button aria-label="Colapsar categoría &#x27;Servicio Track &amp; Trace&#x27; de la barra lateral" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/introduccion-objetivos">1. Introducción y Objetivos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/restricciones-arquitectura">2. Restricciones de la arquitectura</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/contexto-alcance">3. Contexto y alcance del sistema</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/estrategia-solucion">4. Estrategia de solución</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/vista-bloques-construccion">5. Vista de Bloques de Construcción</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/vista-tiempo-ejecucion">6. Vista de tiempo de ejecución</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/vista-implementacion">7. Vista de implementación</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/conceptos-transversales">8. Conceptos transversales</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/decisiones-arquitectura">9. Decisiones de arquitectura</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/requisitos-calidad">10. Requisitos de calidad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/riesgos-deuda-tecnica">11. Riesgos y deuda técnica</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/servicios-corporativos/servicio-track-trace/glosario">12. Glosario</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/aplicaciones">Aplicaciones</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/capa-integracion">Capa de Integración</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Rastro de navegación"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Página de Inicio" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/servicios-corporativos"><span>Servicios Corporativos</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/servicios-corporativos/servicio-track-trace"><span>Servicio Track &amp; Trace</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">11. Riesgos y deuda técnica</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">En esta página</button></div><div class="theme-doc-markdown markdown"><header><h1>11. Riesgos y deuda técnica</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="111-riesgos-identificados">11.1 Riesgos identificados<a href="#111-riesgos-identificados" class="hash-link" aria-label="Enlace directo al 11.1 Riesgos identificados" title="Enlace directo al 11.1 Riesgos identificados">​</a></h2>
<table><thead><tr><th>Riesgo</th><th>Probabilidad</th><th>Impacto</th><th>Mitigación</th></tr></thead><tbody><tr><td><strong>Event store corruption</strong></td><td>Baja</td><td>Alto</td><td>Backups + replication</td></tr><tr><td><strong>Deduplicación failure</strong></td><td>Media</td><td>Medio</td><td>Monitoring + alerts</td></tr><tr><td><strong>Query performance</strong></td><td>Media</td><td>Medio</td><td>Indexing + cache</td></tr><tr><td><strong>Integration failures</strong></td><td>Media</td><td>Alto</td><td>Circuit breakers</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="112-deuda-técnica">11.2 Deuda técnica<a href="#112-deuda-técnica" class="hash-link" aria-label="Enlace directo al 11.2 Deuda técnica" title="Enlace directo al 11.2 Deuda técnica">​</a></h2>
<table><thead><tr><th>Área</th><th>Descripción</th><th>Prioridad</th><th>Esfuerzo</th></tr></thead><tbody><tr><td><strong>Monitoring</strong></td><td>Event sourcing métricas</td><td>Alta</td><td>1 sprint</td></tr><tr><td><strong>Testing</strong></td><td>Event replay testing</td><td>Media</td><td>2 sprints</td></tr><tr><td><strong>Migration</strong></td><td>SNS+SQS readiness</td><td>Media</td><td>3 sprints</td></tr><tr><td><strong>GraphQL</strong></td><td>Schema optimization</td><td>Baja</td><td>1 sprint</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="113-acciones-recomendadas">11.3 Acciones recomendadas<a href="#113-acciones-recomendadas" class="hash-link" aria-label="Enlace directo al 11.3 Acciones recomendadas" title="Enlace directo al 11.3 Acciones recomendadas">​</a></h2>
<table><thead><tr><th>Acción</th><th>Plazo</th><th>Responsable</th></tr></thead><tbody><tr><td><strong>Setup event store monitoring</strong></td><td>2 semanas</td><td>SRE</td></tr><tr><td><strong>Implement read replicas</strong></td><td>1 mes</td><td>DevOps</td></tr><tr><td><strong>Event replay testing</strong></td><td>1 mes</td><td>QA</td></tr><tr><td><strong>Prepare SNS+SQS migration</strong></td><td>2 meses</td><td>Architecture</td></tr></tbody></table>
<p>El <strong>Sistema de Track &amp; Trace</strong> maneja eventos críticos operacionales que requieren gestión proactiva de riesgos para garantizar continuidad operacional y compliance regulatorio.</p>
<p><em>[INSERTAR AQUÍ: Diagrama C4 - Track &amp; Trace Risk Management]</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="111-matriz-de-riesgos">11.1 Matriz de riesgos<a href="#111-matriz-de-riesgos" class="hash-link" aria-label="Enlace directo al 11.1 Matriz de riesgos" title="Enlace directo al 11.1 Matriz de riesgos">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1111-riesgos-técnicos-de-alta-prioridad">11.1.1 Riesgos técnicos de alta prioridad<a href="#1111-riesgos-técnicos-de-alta-prioridad" class="hash-link" aria-label="Enlace directo al 11.1.1 Riesgos técnicos de alta prioridad" title="Enlace directo al 11.1.1 Riesgos técnicos de alta prioridad">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rt-001-event-store-performance-degradation">RT-001: Event Store Performance Degradation<a href="#rt-001-event-store-performance-degradation" class="hash-link" aria-label="Enlace directo al RT-001: Event Store Performance Degradation" title="Enlace directo al RT-001: Event Store Performance Degradation">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Performance/Scalability</td></tr><tr><td><strong>Probabilidad</strong></td><td>Alta (80%)</td></tr><tr><td><strong>Impacto</strong></td><td>Crítico</td></tr><tr><td><strong>Risk Score</strong></td><td>🔴 <strong>20 (Alto)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Platform Engineering Team</td></tr></tbody></table>
<p><strong>Descripción detallada:</strong>
Con el crecimiento exponencial de eventos (50M eventos/año proyectado), el Event Store PostgreSQL puede experimentar degradación de performance en queries complejas y append operations.</p>
<p><strong>Indicadores de riesgo:</strong></p>
<ul>
<li>Query latency P95 &gt; 200ms</li>
<li>Append operations P95 &gt; 100ms</li>
<li>Database connection pool exhaustion</li>
<li>Disk I/O utilization &gt; 85%</li>
</ul>
<p><strong>Estrategias de mitigación:</strong></p>
<p><strong>Inmediatas (0-3 meses)</strong>:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Database optimization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> CONCURRENTLY idx_events_stream_timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> events </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stream_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NOW</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;30 days&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Partitioning strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> events_2024_q1 </span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OF</span><span class="token plain"> events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2024-01-01&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2024-04-01&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Connection pooling optimization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> SYSTEM </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> max_connections </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> SYSTEM </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> shared_buffers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;8GB&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> SYSTEM </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> effective_cache_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;24GB&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Medianas (3-6 meses)</strong>:</p>
<ul>
<li>Implementación de read replicas para queries analíticos</li>
<li>Sharding horizontal por tenant para distribución de carga</li>
<li>Archiving automático de eventos &gt; 1 año a cold storage</li>
</ul>
<p><strong>Largo plazo (6-12 meses)</strong>:</p>
<ul>
<li>Migración a Event Store distribuido (EventStoreDB cluster)</li>
<li>Implementación de CQRS avanzado con projection engine optimizado</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rt-002-multi-tenant-data-isolation-breach">RT-002: Multi-tenant Data Isolation Breach<a href="#rt-002-multi-tenant-data-isolation-breach" class="hash-link" aria-label="Enlace directo al RT-002: Multi-tenant Data Isolation Breach" title="Enlace directo al RT-002: Multi-tenant Data Isolation Breach">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Security/Compliance</td></tr><tr><td><strong>Probabilidad</strong></td><td>Media (40%)</td></tr><tr><td><strong>Impacto</strong></td><td>Crítico</td></tr><tr><td><strong>Risk Score</strong></td><td>🔴 <strong>16 (Alto)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Equipo de Seguridad</td></tr></tbody></table>
<p><strong>Descripción detallada:</strong>
Fallo en la implementación de tenant isolation podría permitir acceso cross-tenant a datos sensibles, violando compliance regulatorio y confianza del cliente.</p>
<p><strong>Indicadores de riesgo:</strong></p>
<ul>
<li>Authorization bypass attempts detectados</li>
<li>Schema switching errors en logs</li>
<li>Cross-tenant queries en audit trail</li>
<li>Failed tenant context validation</li>
</ul>
<p><strong>Estrategias de mitigación:</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Enhanced tenant validation middleware</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TenantValidationMiddleware</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">InvokeAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">HttpContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">RequestDelegate</span><span class="token plain"> next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> claimedTenant </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetTenantId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> requestedTenant </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ExtractTenantFromRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">claimedTenant </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> requestedTenant</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _securityLogger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LogSecurityViolation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                UserId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetUserId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ClaimedTenant </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> claimedTenant</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RequestedTenant </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requestedTenant</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RequestPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                UserAgent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Headers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;User-Agent&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RemoteIP </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RemoteIpAddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StatusCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">403</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Items</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ValidatedTenantId&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> claimedTenant</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Database-level enforcement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TenantFiltered</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EventRepository</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">IEventRepository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">IEnumerable</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">EventData</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetEventsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> tenantId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _tenantContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetCurrentTenantId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Explicit tenant check even with row-level security</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> events </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _dbContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">TenantId </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> tenantId </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StreamId </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToListAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rt-003-event-processing-consistency-failure">RT-003: Event Processing Consistency Failure<a href="#rt-003-event-processing-consistency-failure" class="hash-link" aria-label="Enlace directo al RT-003: Event Processing Consistency Failure" title="Enlace directo al RT-003: Event Processing Consistency Failure">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Data Integrity</td></tr><tr><td><strong>Probabilidad</strong></td><td>Media (30%)</td></tr><tr><td><strong>Impacto</strong></td><td>Alto</td></tr><tr><td><strong>Risk Score</strong></td><td>🟡 <strong>12 (Medio-Alto)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Platform Engineering Team</td></tr></tbody></table>
<p><strong>Descripción detallada:</strong>
Inconsistencias entre Event Store y read models debido a failures en el proceso de proyección, causando datos desactualizados en consultas críticas.</p>
<p><strong>Indicadores de riesgo:</strong></p>
<ul>
<li>Projection lag &gt; 30 segundos</li>
<li>Failed projection updates en logs</li>
<li>Data discrepancies en health checks</li>
<li>Event replay requirements frecuentes</li>
</ul>
<p><strong>Estrategias de mitigación:</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Transactional outbox pattern</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TransactionalEventPublisher</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">IEventPublisher</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token generic-method function" style="color:#d73a49">PublishAsync</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">T</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">T</span><span class="token plain"> @</span><span class="token keyword" style="color:#00009f">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">IDomainEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> transaction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _dbContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Database</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">BeginTransactionAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 1. Store event in Event Store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AppendEventAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">streamId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> @</span><span class="token keyword" style="color:#00009f">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 2. Store in outbox for guaranteed delivery</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> outboxEvent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">OutboxEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EventId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> @</span><span class="token keyword" style="color:#00009f">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EventType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token type-expression class-name">T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EventData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> JsonSerializer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Serialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token keyword" style="color:#00009f">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                CreatedAt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ProcessedAt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _dbContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OutboxEvents</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">outboxEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _dbContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SaveChangesAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> transaction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CommitAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 3. Background service processes outbox</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _backgroundTaskQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">QueueBackgroundWorkItem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">ProcessOutboxEventAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">outboxEvent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> transaction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RollbackAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">throw</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Projection consistency checker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ProjectionConsistencyService</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">ConsistencyReport</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CheckConsistencyAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> eventStoreEvents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetEventsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> projectionState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _projectionStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetProjectionAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> lastEventVersion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eventStoreEvents</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> projectionVersion </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> projectionState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LastProcessedVersion</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">projectionVersion </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> lastEventVersion</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ConsistencyReport</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                IsConsistent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EventStoreLag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lastEventVersion </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> projectionVersion</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RecommendedAction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Trigger projection rebuild&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ConsistencyReport</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> IsConsistent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rt-004-event-bus-message-loss">RT-004: Event Bus Message Loss<a href="#rt-004-event-bus-message-loss" class="hash-link" aria-label="Enlace directo al RT-004: Event Bus Message Loss" title="Enlace directo al RT-004: Event Bus Message Loss">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Integration/Reliability</td></tr><tr><td><strong>Probabilidad</strong></td><td>Media (25%)</td></tr><tr><td><strong>Impacto</strong></td><td>Alto</td></tr><tr><td><strong>Risk Score</strong></td><td>🟡 <strong>10 (Medio)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Integration Team</td></tr></tbody></table>
<p><strong>Descripción detallada:</strong>
Pérdida de mensajes en Event Bus durante picos de tráfico o failures de brokers, causando desincronización entre servicios corporativos.</p>
<p><strong>Estrategias de mitigación:</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Enhanced Event Bus producer configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-method function" style="color:#d73a49">Configure</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">EventBusProducerConfig</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ConnectionString </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eventbus-cluster:5672&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Acks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Acks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">All</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Require all replicas acknowledgment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Retries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MaxValue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Unlimited retries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EnableIdempotence </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Prevent duplicates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MaxInFlight </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Maintain ordering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CompressionType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CompressionType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Snappy</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LingerMs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Batch optimization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BatchSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32768</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 32KB batches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Dead letter queue implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReliableEventPublisher</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">IEventPublisher</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token generic-method function" style="color:#d73a49">PublishAsync</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">T</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">T</span><span class="token plain"> @</span><span class="token keyword" style="color:#00009f">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">IDomainEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> maxAttempts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> attempt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">attempt </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> maxAttempts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _producer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ProduceAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token generic-method function" style="color:#d73a49">GetTopicName</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">T</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">Message</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&lt;</span><span class="token constructor-invocation class-name keyword" style="color:#00009f">string</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">,</span><span class="token constructor-invocation class-name"> </span><span class="token constructor-invocation class-name keyword" style="color:#00009f">byte</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">[</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">]</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> streamId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _serializer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SerializeAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token keyword" style="color:#00009f">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateMessageHeaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token keyword" style="color:#00009f">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LogInformation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Event published successfully: {Topic}/{Partition}/{Offset}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Topic</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Partition</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Offset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Success</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ProduceException</span><span class="token class-name punctuation" style="color:#393A34">&lt;</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token class-name punctuation" style="color:#393A34">,</span><span class="token class-name"> </span><span class="token class-name keyword" style="color:#00009f">byte</span><span class="token class-name punctuation" style="color:#393A34">[</span><span class="token class-name punctuation" style="color:#393A34">]</span><span class="token class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                attempt</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LogWarning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Failed to publish event, attempt {Attempt}/{MaxAttempts}: {Error}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    attempt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxAttempts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Reason</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">attempt </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> maxAttempts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// Send to dead letter queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _deadLetterQueue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SendAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">@</span><span class="token keyword" style="color:#00009f">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">throw</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Delay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromSeconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Pow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attempt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Exponential backoff</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1112-riesgos-operacionales">11.1.2 Riesgos operacionales<a href="#1112-riesgos-operacionales" class="hash-link" aria-label="Enlace directo al 11.1.2 Riesgos operacionales" title="Enlace directo al 11.1.2 Riesgos operacionales">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ro-001-key-personnel-dependency">RO-001: Key Personnel Dependency<a href="#ro-001-key-personnel-dependency" class="hash-link" aria-label="Enlace directo al RO-001: Key Personnel Dependency" title="Enlace directo al RO-001: Key Personnel Dependency">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Operational</td></tr><tr><td><strong>Probabilidad</strong></td><td>Alta (70%)</td></tr><tr><td><strong>Impacto</strong></td><td>Alto</td></tr><tr><td><strong>Risk Score</strong></td><td>🔴 <strong>14 (Alto)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Engineering Manager</td></tr></tbody></table>
<p><strong>Descripción</strong>: Dependencia crítica en 2 desarrolladores senior con conocimiento especializado en Event Sourcing y arquitectura del sistema.</p>
<p><strong>Estrategias de mitigación</strong>:</p>
<ul>
<li>Documentación técnica detallada (en progreso)</li>
<li>Cross-training programa para desarrolladores junior</li>
<li>Pair programming obligatorio para features críticas</li>
<li>Knowledge sharing sessions semanales</li>
</ul>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ro-002-third-party-service-dependencies">RO-002: Third-party Service Dependencies<a href="#ro-002-third-party-service-dependencies" class="hash-link" aria-label="Enlace directo al RO-002: Third-party Service Dependencies" title="Enlace directo al RO-002: Third-party Service Dependencies">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Integration</td></tr><tr><td><strong>Probabilidad</strong></td><td>Media (50%)</td></tr><tr><td><strong>Impacto</strong></td><td>Medio</td></tr><tr><td><strong>Risk Score</strong></td><td>🟡 <strong>10 (Medio)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Equipo DevOps</td></tr></tbody></table>
<p><strong>Descripción</strong>: Dependencias en servicios externos (Keycloak, Event Bus managed service, monitoring tools) pueden causar indisponibilidad.</p>
<p><strong>Estrategias de mitigación</strong>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Circuit breaker configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">circuit_breakers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">keycloak_auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">failure_threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recovery_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fallback</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cached_token_validation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">eventbus_producer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">failure_threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recovery_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fallback</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> local_event_queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">external_apis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">failure_threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recovery_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 120s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">fallback</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> degraded_mode_response</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1113-riesgos-de-compliance">11.1.3 Riesgos de compliance<a href="#1113-riesgos-de-compliance" class="hash-link" aria-label="Enlace directo al 11.1.3 Riesgos de compliance" title="Enlace directo al 11.1.3 Riesgos de compliance">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rc-001-gdpr-data-retention-violation">RC-001: GDPR Data Retention Violation<a href="#rc-001-gdpr-data-retention-violation" class="hash-link" aria-label="Enlace directo al RC-001: GDPR Data Retention Violation" title="Enlace directo al RC-001: GDPR Data Retention Violation">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Compliance/Legal</td></tr><tr><td><strong>Probabilidad</strong></td><td>Media (40%)</td></tr><tr><td><strong>Impacto</strong></td><td>Crítico</td></tr><tr><td><strong>Risk Score</strong></td><td>🔴 <strong>16 (Alto)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Legal + Engineering</td></tr></tbody></table>
<p><strong>Descripción</strong>: Event Store inmutable puede retener PII más allá de los límites permitidos por GDPR.</p>
<p><strong>Estrategias de mitigación</strong>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// GDPR-compliant event pseudonymization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">GdprComplianceService</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">HandleDataDeletionRequestAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> dataSubjectId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 1. Create pseudonymization event instead of deletion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> pseudonymizationEvent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">PersonalDataPseudonymizedEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DataSubjectId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dataSubjectId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PseudonymizationId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Guid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewGuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LegalBasis </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GDPR Article 17 - Right to be forgotten&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AppendEventAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token interpolation-string string" style="color:#e3116c">$&quot;data-subject-</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">{</span><span class="token interpolation-string interpolation expression language-csharp">dataSubjectId</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">}</span><span class="token interpolation-string string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pseudonymizationEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 2. Update all projections to mask PII</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _projectionUpdater</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">PseudonymizeProjectionsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataSubjectId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 3. Schedule crypto-shredding of encryption keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _keyManagementService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ScheduleKeyDeletionAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dataSubjectId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromDays</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="112-deuda-técnica-identificada">11.2 Deuda técnica identificada<a href="#112-deuda-técnica-identificada" class="hash-link" aria-label="Enlace directo al 11.2 Deuda técnica identificada" title="Enlace directo al 11.2 Deuda técnica identificada">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1121-deuda-de-alto-impacto">11.2.1 Deuda de alto impacto<a href="#1121-deuda-de-alto-impacto" class="hash-link" aria-label="Enlace directo al 11.2.1 Deuda de alto impacto" title="Enlace directo al 11.2.1 Deuda de alto impacto">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-001-event-versioning-strategy">DT-001: Event Versioning Strategy<a href="#dt-001-event-versioning-strategy" class="hash-link" aria-label="Enlace directo al DT-001: Event Versioning Strategy" title="Enlace directo al DT-001: Event Versioning Strategy">​</a></h4>
<p><strong>Descripción</strong>: Ausencia de versionado formal para esquemas de eventos, dificultando evolución backward-compatible.
<strong>Impacto</strong>: Alto - Bloquea evolución de dominio
<strong>Esfuerzo estimado</strong>: 3 sprints
<strong>Prioridad</strong>: P1</p>
<p><strong>Plan de remediación</strong>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Implement event versioning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">VersionedEvent</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">IDomainEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">int</span><span class="token plain"> Version </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> SchemaVersion </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetSchemaDefinition</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EntityCreatedEventV2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">EntityCreatedEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">override</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">int</span><span class="token plain"> Version </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name">DateTime</span><span class="token plain"> CreatedAt </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// New field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> CreatedBy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// New field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Backward compatibility via upcasting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name">EntityCreatedEventV2</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FromV1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">EntityCreatedEvent</span><span class="token plain"> v1Event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">EntityCreatedEventV2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            EntityId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1Event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EntityId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1Event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CreatedAt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1Event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Timestamp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Map from old field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CreatedBy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Default value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-002-testing-infrastructure-gaps">DT-002: Testing Infrastructure Gaps<a href="#dt-002-testing-infrastructure-gaps" class="hash-link" aria-label="Enlace directo al DT-002: Testing Infrastructure Gaps" title="Enlace directo al DT-002: Testing Infrastructure Gaps">​</a></h4>
<p><strong>Descripción</strong>: Cobertura insuficiente de integration tests y ausencia de contract testing entre eventos.
<strong>Impacto</strong>: Alto - Riesgo de regressions
<strong>Esfuerzo estimado</strong>: 2 sprints
<strong>Prioridad</strong>: P1</p>
<p><strong>Plan de remediación</strong>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Integration test infrastructure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TestFixture</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EventSourcingIntegrationTests</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">IntegrationTestBase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attribute class-name">Test</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">EventStore_AppendAndRetrieve_MaintainsConsistency</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Arrange</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> streamId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test-stream-&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> Guid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewGuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> events </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TestDataBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateEventSequence</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Act</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AppendEventsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">streamId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> retrievedEvents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetEventsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Assert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        retrievedEvents</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Should</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HaveCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        retrievedEvents</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Should</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">BeInAscendingOrder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Verify projections are updated</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> projection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _projectionStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-method function" style="color:#d73a49">GetProjectionAsync</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">TimelineProjection</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">streamId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        projection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Events</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Should</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HaveCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Contract testing for events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TestFixture</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EventContractTests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attribute class-name">Test</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">EntityCreatedEvent_ShouldMaintainContract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> eventSchema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> JsonSchema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-method function" style="color:#d73a49">FromType</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">EntityCreatedEvent</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> expectedSchema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">LoadSchemaFromFile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;EntityCreatedEvent.v1.schema.json&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eventSchema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Should</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">BeEquivalentTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expectedSchema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-003-monitoring-and-observability-gaps">DT-003: Monitoring and Observability Gaps<a href="#dt-003-monitoring-and-observability-gaps" class="hash-link" aria-label="Enlace directo al DT-003: Monitoring and Observability Gaps" title="Enlace directo al DT-003: Monitoring and Observability Gaps">​</a></h4>
<p><strong>Descripción</strong>: Métricas business-level insuficientes y alertas reactivo en lugar de predictivo.
<strong>Impacto</strong>: Medio - Debugging difficulties
<strong>Esfuerzo estimado</strong>: 1.5 sprints
<strong>Prioridad</strong>: P2</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1122-deuda-de-impacto-medio">11.2.2 Deuda de impacto medio<a href="#1122-deuda-de-impacto-medio" class="hash-link" aria-label="Enlace directo al 11.2.2 Deuda de impacto medio" title="Enlace directo al 11.2.2 Deuda de impacto medio">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-004-code-duplication-in-projection-handlers">DT-004: Code Duplication in Projection Handlers<a href="#dt-004-code-duplication-in-projection-handlers" class="hash-link" aria-label="Enlace directo al DT-004: Code Duplication in Projection Handlers" title="Enlace directo al DT-004: Code Duplication in Projection Handlers">​</a></h4>
<p><strong>Descripción</strong>: Lógica repetitiva en múltiples projection handlers.
<strong>Impacto</strong>: Medio - Mantenibilidad
<strong>Esfuerzo estimado</strong>: 1 sprint
<strong>Prioridad</strong>: P3</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-005-gestión-de-configuración-complexity">DT-005: Gestión de Configuración Complexity<a href="#dt-005-gestión-de-configuración-complexity" class="hash-link" aria-label="Enlace directo al DT-005: Gestión de Configuración Complexity" title="Enlace directo al DT-005: Gestión de Configuración Complexity">​</a></h4>
<p><strong>Descripción</strong>: Configuración dispersa en múltiples archivos sin validación central.
<strong>Impacto</strong>: Medio - Operational overhead
<strong>Esfuerzo estimado</strong>: 0.5 sprints
<strong>Prioridad</strong>: P3</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="113-plan-de-gestión-de-riesgos">11.3 Plan de gestión de riesgos<a href="#113-plan-de-gestión-de-riesgos" class="hash-link" aria-label="Enlace directo al 11.3 Plan de gestión de riesgos" title="Enlace directo al 11.3 Plan de gestión de riesgos">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1131-governance-framework">11.3.1 Governance Framework<a href="#1131-governance-framework" class="hash-link" aria-label="Enlace directo al 11.3.1 Governance Framework" title="Enlace directo al 11.3.1 Governance Framework">​</a></h3>
<p><strong>Risk Assessment Cadence</strong>:</p>
<ul>
<li><strong>Daily</strong>: Monitoring de indicadores de riesgo técnico</li>
<li><strong>Weekly</strong>: Review de métricas de deuda técnica en retrospectiva</li>
<li><strong>Monthly</strong>: Risk assessment completo con stakeholders</li>
<li><strong>Quarterly</strong>: Estrategia de mitigación update y budget allocation</li>
</ul>
<p><strong>Escalation Matrix</strong>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">risk_escalation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">low_risk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">score</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">notification</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Team lead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">response_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 48h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">medium_risk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">score</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 7</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">notification</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Engineering manager + Product owner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">response_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 24h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">high_risk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">score</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 15</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">25</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">notification</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CTO + VP Engineering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">response_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">immediate_action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Required</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1132-mitigation-budget-allocation">11.3.2 Mitigation Budget Allocation<a href="#1132-mitigation-budget-allocation" class="hash-link" aria-label="Enlace directo al 11.3.2 Mitigation Budget Allocation" title="Enlace directo al 11.3.2 Mitigation Budget Allocation">​</a></h3>
<p><strong>Deuda Técnica Budget</strong> (20% of sprint capacity):</p>
<ul>
<li>50% - High impact debt remediation</li>
<li>30% - Infrastructure improvements</li>
<li>20% - Developer experience enhancements</li>
</ul>
<p><strong>Risk Mitigation Investment</strong>:</p>
<ul>
<li>Q1 2024: $150K - Performance optimization + monitoring</li>
<li>Q2 2024: $100K - Security hardening + compliance tools</li>
<li>Q3 2024: $200K - Architecture evolution + scalability</li>
<li>Q4 2024: $75K - Documentation + knowledge transfer</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1133-success-metrics">11.3.3 Success Metrics<a href="#1133-success-metrics" class="hash-link" aria-label="Enlace directo al 11.3.3 Success Metrics" title="Enlace directo al 11.3.3 Success Metrics">​</a></h3>
<p><strong>Risk Reduction KPIs</strong>:</p>
<ul>
<li>Risk exposure reduction: 25% por quarter</li>
<li>Mean time to mitigation: &lt; 48 hours para high-risk issues</li>
<li>Technical debt ratio: &lt; 15% (currently 23%)</li>
<li>Security vulnerability remediation: &lt; 7 days for critical</li>
</ul>
<p><strong>Quality Improvement Metrics</strong>:</p>
<ul>
<li>Code coverage: Target 90% (currently 78%)</li>
<li>Deployment success rate: Target 99% (currently 94%)</li>
<li>Production incident reduction: 50% year-over-year</li>
<li>Developer satisfaction score: &gt; 8/10</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="114-monitoring-y-alertas-de-riesgos">11.4 Monitoring y alertas de riesgos<a href="#114-monitoring-y-alertas-de-riesgos" class="hash-link" aria-label="Enlace directo al 11.4 Monitoring y alertas de riesgos" title="Enlace directo al 11.4 Monitoring y alertas de riesgos">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1141-early-warning-indicators">11.4.1 Early Warning Indicators<a href="#1141-early-warning-indicators" class="hash-link" aria-label="Enlace directo al 11.4.1 Early Warning Indicators" title="Enlace directo al 11.4.1 Early Warning Indicators">​</a></h3>
<p><strong>Technical Risk Indicators</strong>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">technical_indicators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">performance_degradation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metric</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;avg_response_time_increase&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&gt; 20% from baseline&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">window</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7d&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Performance investigation&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">error_rate_trend</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metric</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;error_rate_week_over_week&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&gt; 50% increase&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">window</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7d&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Root cause analysis&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resource_exhaustion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metric</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;resource_utilization_trend&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&gt; 90% projected in 48h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">window</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;24h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Capacity planning review&quot;</span><br></span></code></pre></div></div>
<p><strong>Compliance Risk Indicators</strong>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">compliance_indicators</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">data_retention_violation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metric</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pii_retention_beyond_policy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&gt; 0 records&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">window</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1d&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Immediate GDPR remediation&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">audit_trail_gaps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metric</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;audit_events_missing_percentage&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&gt; 1%&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">window</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Audit system investigation&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">access_control_failures</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metric</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;authorization_bypass_attempts&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&gt; 5 per hour&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">window</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Security incident response&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1142-automated-risk-response">11.4.2 Automated Risk Response<a href="#1142-automated-risk-response" class="hash-link" aria-label="Enlace directo al 11.4.2 Automated Risk Response" title="Enlace directo al 11.4.2 Automated Risk Response">​</a></h3>
<p><strong>Deuda Técnica Thresholds</strong>:</p>
<ul>
<li><strong>Complexity increase</strong> &gt; 15% en 1 sprint → Mandatory refactoring</li>
<li><strong>Coverage decrease</strong> &gt; 5% → Block deployment</li>
<li><strong>Duplication increase</strong> &gt; 2% → Technical debt sprint</li>
</ul>
<p><strong>Architecture Erosion</strong>:</p>
<ul>
<li><strong>Cross-layer dependencies</strong> detected → Architecture review</li>
<li><strong>Event schema violations</strong> → Immediate fix required</li>
<li><strong>Performance regression</strong> &gt; 10% → Rollback consideration</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1143-acciones-automáticas">11.4.3 Acciones automáticas<a href="#1143-acciones-automáticas" class="hash-link" aria-label="Enlace directo al 11.4.3 Acciones automáticas" title="Enlace directo al 11.4.3 Acciones automáticas">​</a></h3>
<p><strong>Preventive Actions</strong>:</p>
<ul>
<li><strong>Auto-scaling</strong>: Trigger en 70% CPU/Memory por 5 minutos</li>
<li><strong>Circuit breaker</strong>: Abrir en 50% error rate por 1 minuto</li>
<li><strong>Snapshot creation</strong>: Trigger en 1000 events por stream</li>
<li><strong>Partition creation</strong>: Trigger en 80% capacidad</li>
</ul>
<p><strong>Remediation Actions</strong>:</p>
<ul>
<li><strong>Event replay</strong>: Automático para corruption detection</li>
<li><strong>Read model rebuild</strong>: Trigger en consistency SLA breach</li>
<li><strong>Failover</strong>: Automático para Event Store unavailability</li>
<li><strong>Alert escalation</strong>: PagerDuty para P1 incidents después de 5 min</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="115-investment-strategy">11.5 Investment Strategy<a href="#115-investment-strategy" class="hash-link" aria-label="Enlace directo al 11.5 Investment Strategy" title="Enlace directo al 11.5 Investment Strategy">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1151-continuous-investment-20-capacity">11.5.1 Continuous Investment (20% capacity)<a href="#1151-continuous-investment-20-capacity" class="hash-link" aria-label="Enlace directo al 11.5.1 Continuous Investment (20% capacity)" title="Enlace directo al 11.5.1 Continuous Investment (20% capacity)">​</a></h3>
<ul>
<li>Event Sourcing tooling improvements</li>
<li>Performance optimizations</li>
<li>Developer experience enhancements</li>
<li>Monitoring and observability</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1152-planned-deuda-técnica-sprints-2024">11.5.2 Planned Deuda Técnica Sprints (2024)<a href="#1152-planned-deuda-técnica-sprints-2024" class="hash-link" aria-label="Enlace directo al 11.5.2 Planned Deuda Técnica Sprints (2024)" title="Enlace directo al 11.5.2 Planned Deuda Técnica Sprints (2024)">​</a></h3>
<ul>
<li><strong>Sprint 24.6</strong>: Event versioning standardization</li>
<li><strong>Sprint 24.8</strong>: Projection engine refactoring</li>
<li><strong>Sprint 24.10</strong>: Testing infrastructure improvements</li>
<li><strong>Sprint 24.12</strong>: Configuration management consolidation</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1153-architecture-evolution-2024-roadmap">11.5.3 Architecture Evolution (2024 Roadmap)<a href="#1153-architecture-evolution-2024-roadmap" class="hash-link" aria-label="Enlace directo al 11.5.3 Architecture Evolution (2024 Roadmap)" title="Enlace directo al 11.5.3 Architecture Evolution (2024 Roadmap)">​</a></h3>
<ul>
<li><strong>Q2</strong>: Sharding strategy implementation</li>
<li><strong>Q3</strong>: Multi-region deployment preparation</li>
<li><strong>Q4</strong>: ML-based anomaly detection integration</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1154-roi-expectations">11.5.4 ROI Expectations<a href="#1154-roi-expectations" class="hash-link" aria-label="Enlace directo al 11.5.4 ROI Expectations" title="Enlace directo al 11.5.4 ROI Expectations">​</a></h3>
<p><strong>Immediate ROI (0-6 months)</strong>:</p>
<ul>
<li>40% reduction en incident response time</li>
<li>25% improvement en deployment success rate</li>
<li>60% reduction en time-to-resolution para performance issues</li>
</ul>
<p><strong>Medium-term ROI (6-18 months)</strong>:</p>
<ul>
<li>50% reduction en operational overhead</li>
<li>30% improvement en developer velocity</li>
<li>20% reduction en infrastructure costs through optimization</li>
</ul>
<p><strong>Long-term ROI (18+ months)</strong>:</p>
<ul>
<li>70% reduction en compliance risk exposure</li>
<li>Platform readiness para 10x scale growth</li>
<li>Architecture foundation para future service expansion</li>
</ul>
<hr>
<p><strong>Resumen ejecutivo de gestión de riesgos</strong>:</p>
<ol>
<li><strong>Riesgos críticos identificados</strong>: 4 técnicos, 2 operacionales, 1 compliance</li>
<li><strong>Investment allocation</strong>: 20% capacity continua + budget específico por quarter</li>
<li><strong>Monitoring strategy</strong>: Early warning indicators + automated responses</li>
<li><strong>Governance</strong>: Weekly reviews + monthly assessments + quarterly strategy updates</li>
<li><strong>Success tracking</strong>: KPIs cuantitativos con targets específicos y timeline</li>
</ol>
<p>Esta estrategia integral garantiza que el servicio Track &amp; Trace mantenga la robustez operacional necesaria mientras evoluciona para cumplir requisitos futuros.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">Performance Optimization Strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Immediate Actions (Q1 2025)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Implement automatic partitioning by tenant and month</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Setup read replicas for analytical workloads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Optimize indexes for frequent query patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Enable connection pooling with PgBouncer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Medium Term (Q2-Q3 2025)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Implement event archiving to cold storage (S3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Setup automated snapshot generation for large streams</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Implement CQRS with specialized read models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Database query performance monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Long Term (2026)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Evaluate Event Store DB or PostgreSQL with SNS+SQS for event storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Implement polyglot persistence strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Cross</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">region event replication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Machine learning</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">based capacity planning</span><br></span></code></pre></div></div>
<p><strong>Monitoreo y alertas:</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EventStorePerformanceMonitor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token class-name">IMetricsCollector</span><span class="token plain"> _metrics</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token class-name">IAlertingService</span><span class="token plain"> _alerting</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attribute class-name">BackgroundService</span><span class="token attribute attribute-arguments punctuation" style="color:#393A34">(</span><span class="token attribute attribute-arguments">IntervalSeconds </span><span class="token attribute attribute-arguments operator" style="color:#393A34">=</span><span class="token attribute attribute-arguments"> </span><span class="token attribute attribute-arguments number" style="color:#36acaa">30</span><span class="token attribute attribute-arguments punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorPerformanceMetricsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> metrics </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetPerformanceMetricsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Critical thresholds monitoring</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AppendLatencyP95 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromMilliseconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _alerting</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SendCriticalAlertAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">PerformanceAlert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AlertType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HighLatency</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Metric </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AppendLatencyP95&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AppendLatencyP95</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Threshold </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromMilliseconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Severity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AlertSeverity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Critical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ActiveConnections </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MaxConnections </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _alerting</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SendWarningAlertAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">CapacityAlert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AlertType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ConnectionPoolNearLimit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ActiveConnections</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Limit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MaxConnections</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Recommendation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Scale up connection pool or add read replicas&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Predictive alertas based on trends</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> growthRate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CalculateEventGrowthRateAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">growthRate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 30% weekly growth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _alerting</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SendPredictiveAlertAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">GrowthAlert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AlertType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CapacityPrediction</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                GrowthRate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> growthRate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EstimatedCapacityDate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CalculateCapacityExhaustionDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">growthRate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                RecommendedActions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Implement partitioning&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Setup archiving&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Add read replicas&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rt-002-event-schema-evolution-complexity">RT-002: Event Schema Evolution Complexity<a href="#rt-002-event-schema-evolution-complexity" class="hash-link" aria-label="Enlace directo al RT-002: Event Schema Evolution Complexity" title="Enlace directo al RT-002: Event Schema Evolution Complexity">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Data Management</td></tr><tr><td><strong>Probabilidad</strong></td><td>Alta (75%)</td></tr><tr><td><strong>Impacto</strong></td><td>Alto</td></tr><tr><td><strong>Risk Score</strong></td><td>🟡 <strong>15 (Medio-Alto)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Development Team + Architecture</td></tr></tbody></table>
<p><strong>Descripción detallada:</strong>
Cambios en la estructura de eventos pueden romper compatibilidad con sistemas existentes y afectar la integridad de la cadena de eventos históricos.</p>
<p><strong>Escenarios de riesgo:</strong></p>
<ul>
<li>Cambios en campos requeridos de eventos existentes</li>
<li>Modificación de tipos de datos en eventos</li>
<li>Eliminación de campos utilizados por read models</li>
<li>Cambios en semántica de eventos existentes</li>
</ul>
<p><strong>Estrategia de versionado de eventos:</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EventVersioningStrategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Event with versioning support</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">VersionedEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> EventId </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Guid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewGuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> EventType </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">int</span><span class="token plain"> Version </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name">DateTimeOffset</span><span class="token plain"> Timestamp </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DateTimeOffset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">object</span><span class="token plain"> Data </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Example: Flight status event evolution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FlightStatusChangedV1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">VersionedEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FlightStatusChangedV1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            EventType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FlightStatusChanged&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FlightStatusData</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> FlightNumber </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> Status </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name">DateTime</span><span class="token plain"> ScheduledTime </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FlightStatusChangedV2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">VersionedEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FlightStatusChangedV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            EventType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FlightStatusChanged&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FlightStatusData</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> FlightNumber </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token plain"> Status </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name">DateTime</span><span class="token plain"> ScheduledTime </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name">DateTime</span><span class="token return-type class-name punctuation" style="color:#393A34">?</span><span class="token plain"> ActualTime </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// New field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">string</span><span class="token return-type class-name punctuation" style="color:#393A34">?</span><span class="token plain"> Reason </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// New optional field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name">GeoLocation</span><span class="token return-type class-name punctuation" style="color:#393A34">?</span><span class="token plain"> Location </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// New complex type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Event upcasting for backward compatibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EventUpcaster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token return-type class-name">VersionedEvent</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UpcastEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">VersionedEvent</span><span class="token plain"> originalEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> originalEvent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventType </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;FlightStatusChanged&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">when</span><span class="token plain"> originalEvent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Version </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">UpcastFlightStatusV1ToV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">originalEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _ </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> originalEvent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token return-type class-name">FlightStatusChangedV2</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UpcastFlightStatusV1ToV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">VersionedEvent</span><span class="token plain"> v1Event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> v1Data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> JsonSerializer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-method function" style="color:#d73a49">Deserialize</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">FlightStatusChangedV1</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">.</span><span class="token generic-method generic class-name">FlightStatusData</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                v1Event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">FlightStatusChangedV2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                EventId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1Event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1Event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Timestamp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">FlightStatusChangedV2</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">.</span><span class="token constructor-invocation class-name">FlightStatusData</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FlightNumber </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1Data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FlightNumber</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1Data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ScheduledTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v1Data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ScheduledTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ActualTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Default for migrated events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Reason </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Default for migrated events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Location </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Default for migrated events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Testing strategy for schema evolution:</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token attribute class-name">TestClass</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EventSchemaEvolutionTests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attribute class-name">TestMethod</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Can_Read_V1_Events_With_V2_Handlers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Arrange: Create V1 event</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> v1Event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">FlightStatusChangedV1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">FlightStatusChangedV1</span><span class="token constructor-invocation class-name punctuation" style="color:#393A34">.</span><span class="token constructor-invocation class-name">FlightStatusData</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                FlightNumber </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;LA2025&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Delayed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ScheduledTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddHours</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Act: Process with V2 handler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> upcaster </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">EventUpcaster</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> upcastedEvent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> upcaster</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">UpcastEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v1Event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> handler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">FlightStatusChangedV2Handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HandleAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">upcastedEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Assert: Verify backward compatibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsTrue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IsSuccess</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AreEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;LA2025&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FlightNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AreEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Delayed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ActualTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Default value for new field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attribute class-name">TestMethod</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Schema_Changes_Maintain_Serialization_Compatibility</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Test for JSON schema backward compatibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> v1Json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;eventId&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;eventType&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FlightStatusChanged&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;version&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;timestamp&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2024-01-01T10:00:00Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;flightNumber&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;LA2025&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Delayed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;scheduledTime&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2024-01-01T12:00:00Z&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Should deserialize successfully with V2 model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> deserializedEvent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> JsonSerializer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-method function" style="color:#d73a49">Deserialize</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">FlightStatusChangedV2</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v1Json</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsNotNull</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deserializedEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AreEqual</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> deserializedEvent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rt-003-cqrs-read-model-synchronization-lag">RT-003: CQRS Read Model Synchronization Lag<a href="#rt-003-cqrs-read-model-synchronization-lag" class="hash-link" aria-label="Enlace directo al RT-003: CQRS Read Model Synchronization Lag" title="Enlace directo al RT-003: CQRS Read Model Synchronization Lag">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Data Consistency</td></tr><tr><td><strong>Probabilidad</strong></td><td>Media (60%)</td></tr><tr><td><strong>Impacto</strong></td><td>Alto</td></tr><tr><td><strong>Risk Score</strong></td><td>🟡 <strong>12 (Medio)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Development Team</td></tr></tbody></table>
<p><strong>Descripción detallada:</strong>
El lag entre la escritura de eventos en el Event Store y la actualización de los read models puede causar inconsistencias percibidas por los usuarios y problemas en dashboards operacionales.</p>
<p><strong>Factores que aumentan el lag:</strong></p>
<ul>
<li>Alto volumen de eventos durante picos operacionales</li>
<li>Complejidad de las proyecciones de read models</li>
<li>Fallos temporales en la infraestructura de messaging</li>
<li>Procesamiento de eventos en batch vs tiempo real</li>
</ul>
<p><strong>Estrategia de consistencia eventual:</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReadModelSynchronizationService</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token class-name">IEventStore</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token class-name">IReadModelStore</span><span class="token plain"> _readModelStore</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token class-name">IEventBus</span><span class="token plain"> _eventBus</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> </span><span class="token class-name">ILogger</span><span class="token class-name punctuation" style="color:#393A34">&lt;</span><span class="token class-name">ReadModelSynchronizationService</span><span class="token class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> _logger</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Real-time projection with fallback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">TimelineView</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetTimelineAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> entityId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">bool</span><span class="token plain"> allowStale </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> readModel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _readModelStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetTimelineAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entityId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">readModel </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">allowStale </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IsStale</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">readModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Fallback: Build view from event store directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LogWarning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Read model stale for {EntityId}, falling back to event store&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> entityId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">BuildTimelineFromEventsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entityId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> readModel</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IsStale</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">TimelineView</span><span class="token plain"> readModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> stalenessThreshold </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromSeconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> DateTimeOffset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UtcNow </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> readModel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LastUpdated </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> stalenessThreshold</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Continuous synchronization monitoring</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">BackgroundService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IntervalSeconds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MonitorSynchronizationLagAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> lagMetrics </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CalculateSynchronizationLagAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> metric </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> lagMetrics</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _metricsCollector</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RecordGaugeAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;read_model_sync_lag_seconds&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                metric</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LagInSeconds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">new</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">$&quot;projection:</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">{</span><span class="token interpolation-string interpolation expression language-csharp">metric</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">.</span><span class="token interpolation-string interpolation expression language-csharp">ProjectionName</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">}</span><span class="token interpolation-string string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metric</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LagInSeconds </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Alert if lag &gt; 10 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _alerting</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SendAlertAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">SyncLagAlert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ProjectionName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metric</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProjectionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    LagInSeconds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metric</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LagInSeconds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    LastProcessedEventId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metric</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LastProcessedEventId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Severity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metric</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LagInSeconds </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain"> AlertSeverity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Critical </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AlertSeverity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Warning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Automatic healing for failed projections</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">HealProjectionAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> projectionName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> checkpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _readModelStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetCheckpointAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">projectionName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> missedEvents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetEventsAfterAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">checkpoint</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LastProcessedEventId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> batchSize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> batch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> missedEvents</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Chunk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">batchSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">try</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ProcessEventBatchAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">projectionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _readModelStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">UpdateCheckpointAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">projectionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Last</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LogInformation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Healed {EventCount} events for projection {ProjectionName}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    batch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Length</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> projectionName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Exception</span><span class="token plain"> ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LogError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Failed to heal projection {ProjectionName} at batch starting with {EventId}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    projectionName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">First</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Implement exponential backoff for retries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> Task</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Delay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromSeconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Pow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> checkpoint</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RetryCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">throw</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1112-riesgos-operacionales-1">11.1.2 Riesgos operacionales<a href="#1112-riesgos-operacionales-1" class="hash-link" aria-label="Enlace directo al 11.1.2 Riesgos operacionales" title="Enlace directo al 11.1.2 Riesgos operacionales">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ro-001-dependency-on-external-systems">RO-001: Dependency on External Systems<a href="#ro-001-dependency-on-external-systems" class="hash-link" aria-label="Enlace directo al RO-001: Dependency on External Systems" title="Enlace directo al RO-001: Dependency on External Systems">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Integration/Disponibilidad</td></tr><tr><td><strong>Probabilidad</strong></td><td>Media (50%)</td></tr><tr><td><strong>Impacto</strong></td><td>Alto</td></tr><tr><td><strong>Risk Score</strong></td><td>🟡 <strong>10 (Medio)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Equipo DevOps + Integration Team</td></tr></tbody></table>
<p><strong>Sistemas de dependencia críticos:</strong></p>
<ul>
<li><strong>SITA Network</strong>: Para eventos aeronáuticos globales</li>
<li><strong>Airport Operational Systems</strong>: Para datos operacionales locales</li>
<li><strong>Identity Service</strong>: Para autenticación y autorización</li>
<li><strong>Event Bus Cluster</strong>: Para event streaming y messaging</li>
</ul>
<p><strong>Estrategias de resilencia:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">Circuit Breaker Configuration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">SITA_Integration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">failure_threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recovery_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">half_open_max_calls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Airport_Systems</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">failure_threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recovery_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">half_open_max_calls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Identity_Service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">failure_threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">recovery_timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">half_open_max_calls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Fallback Strategies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Event_Ingestion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Local queue for offline events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Batch synchronization when connectivity restored</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Manual data entry interface for critical events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Authentication</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Cached JWT tokens with extended TTL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Emergency admin access with autenticación multi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">factor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Read</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">only mode when identity service unavailable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">External_Data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Last known good data caching</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Staleness indicators in UI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Degraded functionality notifications</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1113-riesgos-de-compliance-y-seguridad">11.1.3 Riesgos de compliance y seguridad<a href="#1113-riesgos-de-compliance-y-seguridad" class="hash-link" aria-label="Enlace directo al 11.1.3 Riesgos de compliance y seguridad" title="Enlace directo al 11.1.3 Riesgos de compliance y seguridad">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rc-001-data-retention-and-privacy-compliance">RC-001: Data Retention and Privacy Compliance<a href="#rc-001-data-retention-and-privacy-compliance" class="hash-link" aria-label="Enlace directo al RC-001: Data Retention and Privacy Compliance" title="Enlace directo al RC-001: Data Retention and Privacy Compliance">​</a></h4>
<table><thead><tr><th>Campo</th><th>Valor</th></tr></thead><tbody><tr><td><strong>Categoría</strong></td><td>Compliance/Legal</td></tr><tr><td><strong>Probabilidad</strong></td><td>Alta (70%)</td></tr><tr><td><strong>Impacto</strong></td><td>Crítico</td></tr><tr><td><strong>Risk Score</strong></td><td>🔴 <strong>21 (Alto)</strong></td></tr><tr><td><strong>Owner</strong></td><td>Equipo Legal + Privacy Officer</td></tr></tbody></table>
<p><strong>Regulaciones aplicables:</strong></p>
<ul>
<li><strong>GDPR</strong>: Right to be forgotten, data portability</li>
<li><strong>Local Aviation Regulations</strong>: 7-year operational data retention</li>
<li><strong>SOX</strong>: Financial audit trail requirements</li>
<li><strong>PCI DSS</strong>: Payment data protection (if applicable)</li>
</ul>
<p><strong>Compliance automation:</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ComplianceAutomationService</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Automated GDPR compliance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">GdprComplianceReport</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ProcessDataSubjectRequestAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">DataSubjectRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> report </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">GdprComplianceReport</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RequestId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RequestType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ProcessedAt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DateTimeOffset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UtcNow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> DataSubjectRequestType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Access</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                report</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExportedData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ExportPersonalDataAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubjectId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> DataSubjectRequestType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Deletion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Check legal hold status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> legalHolds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _legalHoldService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActiveLegalHoldsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubjectId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">legalHolds</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Any</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    report</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ComplianceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Blocked</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    report</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Reason </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:#e3116c">$&quot;Subject under legal hold: </span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">{</span><span class="token interpolation-string interpolation expression language-csharp keyword" style="color:#00009f">string</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">.</span><span class="token interpolation-string interpolation expression language-csharp function" style="color:#d73a49">Join</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">(</span><span class="token interpolation-string interpolation expression language-csharp string" style="color:#e3116c">&quot;, &quot;</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">,</span><span class="token interpolation-string interpolation expression language-csharp"> legalHolds</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">.</span><span class="token interpolation-string interpolation expression language-csharp function" style="color:#d73a49">Select</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">(</span><span class="token interpolation-string interpolation expression language-csharp">h </span><span class="token interpolation-string interpolation expression language-csharp operator" style="color:#393A34">=&gt;</span><span class="token interpolation-string interpolation expression language-csharp"> h</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">.</span><span class="token interpolation-string interpolation expression language-csharp">CaseNumber</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">)</span><span class="token interpolation-string interpolation expression language-csharp punctuation" style="color:#393A34">)</span><span class="token interpolation-string interpolation punctuation" style="color:#393A34">}</span><span class="token interpolation-string string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Pseudonymization instead of deletion for audit trail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PseudonymizePersonalDataAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubjectId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                report</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ComplianceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Completed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> DataSubjectRequestType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Rectification</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">UpdatePersonalDataAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubjectId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UpdatedData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                report</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ComplianceStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Completed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Audit log for compliance actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _auditLogger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LogComplianceActionAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ComplianceAuditEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Action </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Type</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SubjectId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubjectId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ProcessedBy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessedBy</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> report</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DateTimeOffset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UtcNow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> report</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Automated retention policy enforcement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">BackgroundService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IntervalHours </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">EnforceRetentionPoliciesAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> policies </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _policyService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActiveRetentionPoliciesAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> enforcementReport </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">RetentionEnforcementReport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> policy </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> policies</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> cutoffDate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DateTimeOffset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UtcNow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Subtract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">policy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RetentionPeriod</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> candidateEvents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetEventsOlderThanAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                cutoffDate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> policy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EventTypes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> eventBatch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> candidateEvents</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Chunk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// Check for legal holds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> eventsUnderHold </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _legalHoldService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FilterEventsUnderLegalHoldAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eventBatch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> deletionCandidates </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eventBatch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Except</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eventsUnderHold</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deletionCandidates</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Any</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// Archive before deletion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> archiveResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _archiveService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ArchiveEventsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deletionCandidates</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">archiveResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Success</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Secure deletion with verification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> deletionResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _eventStore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SecureDeleteAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deletionCandidates</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        enforcementReport</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DeletedEventsCount </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> deletionResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DeletedCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                enforcementReport</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProcessedEventsCount </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> eventBatch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                enforcementReport</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LegalHoldEventsCount </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> eventsUnderHold</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _complianceReportingService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SubmitRetentionReportAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">enforcementReport</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="112-plan-de-gestión-de-deuda-técnica">11.2 Plan de gestión de deuda técnica<a href="#112-plan-de-gestión-de-deuda-técnica" class="hash-link" aria-label="Enlace directo al 11.2 Plan de gestión de deuda técnica" title="Enlace directo al 11.2 Plan de gestión de deuda técnica">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1121-deuda-técnica-identificada">11.2.1 Deuda técnica identificada<a href="#1121-deuda-técnica-identificada" class="hash-link" aria-label="Enlace directo al 11.2.1 Deuda técnica identificada" title="Enlace directo al 11.2.1 Deuda técnica identificada">​</a></h3>
<table><thead><tr><th>ID</th><th>Descripción</th><th>Impacto</th><th>Esfuerzo</th><th>Prioridad</th><th>Timeline</th></tr></thead><tbody><tr><td><strong>TD-001</strong></td><td>Event Store query optimization</td><td>Alto</td><td>8 SP</td><td>Alta</td><td>Q1 2025</td></tr><tr><td><strong>TD-002</strong></td><td>Read model rebuild automation</td><td>Medio</td><td>5 SP</td><td>Media</td><td>Q2 2025</td></tr><tr><td><strong>TD-003</strong></td><td>Event versioning framework</td><td>Alto</td><td>13 SP</td><td>Alta</td><td>Q1-Q2 2025</td></tr><tr><td><strong>TD-004</strong></td><td>Monitoring dashboard enhancement</td><td>Medio</td><td>3 SP</td><td>Baja</td><td>Q3 2025</td></tr><tr><td><strong>TD-005</strong></td><td>Compliance automation tools</td><td>Crítico</td><td>21 SP</td><td>Alta</td><td>Q1-Q2 2025</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1122-estrategia-de-remediación">11.2.2 Estrategia de remediación<a href="#1122-estrategia-de-remediación" class="hash-link" aria-label="Enlace directo al 11.2.2 Estrategia de remediación" title="Enlace directo al 11.2.2 Estrategia de remediación">​</a></h3>
<p><strong>Q1 2025 - Prioridad Crítica:</strong></p>
<ul>
<li>✅ Implementar optimizaciones de performance del Event Store</li>
<li>✅ Desarrollar framework de versionado de eventos</li>
<li>✅ Iniciar herramientas de compliance automation</li>
</ul>
<p><strong>Q2 2025 - Estabilización:</strong></p>
<ul>
<li>🔄 Completar framework de versionado</li>
<li>🔄 Finalizar compliance automation</li>
<li>🔄 Implementar rebuild automation para read models</li>
</ul>
<p><strong>Q3 2025 - Mejoras:</strong></p>
<ul>
<li>📋 Dashboard enhancements</li>
<li>📋 Advanced monitoring capabilities</li>
<li>📋 Performance optimization phase 2</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1123-métricas-de-deuda-técnica">11.2.3 Métricas de deuda técnica<a href="#1123-métricas-de-deuda-técnica" class="hash-link" aria-label="Enlace directo al 11.2.3 Métricas de deuda técnica" title="Enlace directo al 11.2.3 Métricas de deuda técnica">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">TechnicalDebtMetrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Code quality metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">CodeQualityReport</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GenerateCodeQualityReportAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">CodeQualityReport</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TestCoverage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _testMetrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetCoveragePercentageAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CyclomaticComplexity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _codeAnalysis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAverageComplexityAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CodeDuplication </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _codeAnalysis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetDuplicationPercentageAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TechnicalDebtRatio </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CalculateTechnicalDebtRatioAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SecurityVulnerabilities </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _securityScanner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetVulnerabilityCountAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Performance debt tracking</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">PerformanceDebtReport</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TrackPerformanceDebtAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> metrics </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _performanceMonitor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetMetricsAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromDays</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">PerformanceDebtReport</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SlowQueries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Queries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">q </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AvgLatency </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromMilliseconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MemoryLeaks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DetectMemoryLeaksAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DatabaseLockContention </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DatabaseLocks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Duration </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromSeconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UnoptimizedEndpoints </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Endpoints</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">P95Latency </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> TimeSpan</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">FromMilliseconds</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ul>
<li><strong>Probabilidad</strong>: Baja</li>
<li><strong>Impacto</strong>: Alto</li>
<li><strong>Mitigación</strong>:<!-- -->
<ul>
<li>Event Bus cluster redundante multi-AZ</li>
<li>Dead letter queues para mensajes fallidos</li>
<li>Circuit breaker para Event Bus producers</li>
<li>Fallback a polling directo del Event Store</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ri-002-integración-con-múltiples-sistemas-externos">RI-002: Integración con múltiples sistemas externos<a href="#ri-002-integración-con-múltiples-sistemas-externos" class="hash-link" aria-label="Enlace directo al RI-002: Integración con múltiples sistemas externos" title="Enlace directo al RI-002: Integración con múltiples sistemas externos">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Cada integración introduce puntos de falla adicionales</li>
<li><strong>Probabilidad</strong>: Media</li>
<li><strong>Impacto</strong>: Medio</li>
<li><strong>Mitigación</strong>:<!-- -->
<ul>
<li>Adapter pattern para aislamiento</li>
<li>Circuit breakers por sistema externo</li>
<li>Retry policies configurables</li>
<li>Monitoreo específico por integración</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1113-riesgos-operacionales">11.1.3 Riesgos operacionales<a href="#1113-riesgos-operacionales" class="hash-link" aria-label="Enlace directo al 11.1.3 Riesgos operacionales" title="Enlace directo al 11.1.3 Riesgos operacionales">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ro-001-escalabilidad-de-multi-tenancy">RO-001: Escalabilidad de multi-tenancy<a href="#ro-001-escalabilidad-de-multi-tenancy" class="hash-link" aria-label="Enlace directo al RO-001: Escalabilidad de multi-tenancy" title="Enlace directo al RO-001: Escalabilidad de multi-tenancy">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Crecimiento exponencial de tenants puede saturar recursos</li>
<li><strong>Probabilidad</strong>: Alta</li>
<li><strong>Impacto</strong>: Alto</li>
<li><strong>Mitigación</strong>:<!-- -->
<ul>
<li>Auto-scaling basado en métricas por tenant</li>
<li>Resource quotas configurables</li>
<li>Sharding strategy para tenant grandes</li>
<li>Monitoring predictivo de capacidad</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ro-002-complejidad-de-debugging">RO-002: Complejidad de debugging<a href="#ro-002-complejidad-de-debugging" class="hash-link" aria-label="Enlace directo al RO-002: Complejidad de debugging" title="Enlace directo al RO-002: Complejidad de debugging">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Event Sourcing hace más complejo el debugging de issues</li>
<li><strong>Probabilidad</strong>: Media</li>
<li><strong>Impacto</strong>: Medio</li>
<li><strong>Mitigación</strong>:<!-- -->
<ul>
<li>Herramientas especializadas de debugging</li>
<li>Event replay capabilities</li>
<li>Correlation IDs consistentes</li>
<li>Dashboards específicos para resolución de problemas</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ro-003-compliance-y-auditoría">RO-003: Compliance y auditoría<a href="#ro-003-compliance-y-auditoría" class="hash-link" aria-label="Enlace directo al RO-003: Compliance y auditoría" title="Enlace directo al RO-003: Compliance y auditoría">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Requisitos regulatorios pueden cambiar impactando diseño</li>
<li><strong>Probabilidad</strong>: Media</li>
<li><strong>Impacto</strong>: Alto</li>
<li><strong>Mitigación</strong>:<!-- -->
<ul>
<li>Diseño flexible para nuevos requisitos</li>
<li>Immutable audit trail por defecto</li>
<li>Legal review de compliance requirements</li>
<li>Regular compliance assessments</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="112-deuda-técnica-1">11.2 Deuda técnica<a href="#112-deuda-técnica-1" class="hash-link" aria-label="Enlace directo al 11.2 Deuda técnica" title="Enlace directo al 11.2 Deuda técnica">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1121-deuda-de-arquitectura">11.2.1 Deuda de arquitectura<a href="#1121-deuda-de-arquitectura" class="hash-link" aria-label="Enlace directo al 11.2.1 Deuda de arquitectura" title="Enlace directo al 11.2.1 Deuda de arquitectura">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-001-read-model-synchronization">DT-001: Read model synchronization<a href="#dt-001-read-model-synchronization" class="hash-link" aria-label="Enlace directo al DT-001: Read model synchronization" title="Enlace directo al DT-001: Read model synchronization">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Lógica de sincronización distribuida en múltiples handlers</li>
<li><strong>Impacto</strong>: Dificultad para mantener consistency y debuggear issues</li>
<li><strong>Plan de resolución</strong>: Centralizar en projection engine unificado</li>
<li><strong>Prioridad</strong>: Alta</li>
<li><strong>Estimación</strong>: 4 sprints</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-002-event-versioning-inconsistente">DT-002: Event versioning inconsistente<a href="#dt-002-event-versioning-inconsistente" class="hash-link" aria-label="Enlace directo al DT-002: Event versioning inconsistente" title="Enlace directo al DT-002: Event versioning inconsistente">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Diferentes estrategias de versioning entre tipos de eventos</li>
<li><strong>Impacto</strong>: Complejidad en evolución de esquemas</li>
<li><strong>Plan de resolución</strong>: Estandarizar con event migration framework</li>
<li><strong>Prioridad</strong>: Media</li>
<li><strong>Estimación</strong>: 3 sprints</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-003-snapshot-strategy-no-optimizada">DT-003: Snapshot strategy no optimizada<a href="#dt-003-snapshot-strategy-no-optimizada" class="hash-link" aria-label="Enlace directo al DT-003: Snapshot strategy no optimizada" title="Enlace directo al DT-003: Snapshot strategy no optimizada">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Snapshots manuales sin criterios claros de cuando crear</li>
<li><strong>Impacto</strong>: Performance degradada para entidades con muchos eventos</li>
<li><strong>Plan de resolución</strong>: Snapshot automático basado en métricas</li>
<li><strong>Prioridad</strong>: Media</li>
<li><strong>Estimación</strong>: 2 sprints</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1122-deuda-de-código">11.2.2 Deuda de código<a href="#1122-deuda-de-código" class="hash-link" aria-label="Enlace directo al 11.2.2 Deuda de código" title="Enlace directo al 11.2.2 Deuda de código">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-004-duplicación-en-event-handlers">DT-004: Duplicación en event handlers<a href="#dt-004-duplicación-en-event-handlers" class="hash-link" aria-label="Enlace directo al DT-004: Duplicación en event handlers" title="Enlace directo al DT-004: Duplicación en event handlers">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Lógica similar repetida en múltiples projection handlers</li>
<li><strong>Impacto</strong>: Mantenimiento complejo y riesgo de inconsistencias</li>
<li><strong>Plan de resolución</strong>: Abstraer en base classes y utilities compartidas</li>
<li><strong>Prioridad</strong>: Baja</li>
<li><strong>Estimación</strong>: 2 sprints</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-005-testing-insuficiente-de-scenarios-de-concurrencia">DT-005: Testing insuficiente de scenarios de concurrencia<a href="#dt-005-testing-insuficiente-de-scenarios-de-concurrencia" class="hash-link" aria-label="Enlace directo al DT-005: Testing insuficiente de scenarios de concurrencia" title="Enlace directo al DT-005: Testing insuficiente de scenarios de concurrencia">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Falta de tests para race conditions y optimistic concurrency</li>
<li><strong>Impacto</strong>: Bugs potenciales en producción bajo alta carga</li>
<li><strong>Plan de resolución</strong>: Test suite especializada en concurrency</li>
<li><strong>Prioridad</strong>: Alta</li>
<li><strong>Estimación</strong>: 3 sprints</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-006-logging-no-estructurado-en-algunos-componentes">DT-006: Logging no estructurado en algunos componentes<a href="#dt-006-logging-no-estructurado-en-algunos-componentes" class="hash-link" aria-label="Enlace directo al DT-006: Logging no estructurado en algunos componentes" title="Enlace directo al DT-006: Logging no estructurado en algunos componentes">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Componentes legacy con logging text-based</li>
<li><strong>Impacto</strong>: Dificultad en observability y debugging</li>
<li><strong>Plan de resolución</strong>: Migración gradual a registro estructurado</li>
<li><strong>Prioridad</strong>: Baja</li>
<li><strong>Estimación</strong>: 1 sprint</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1123-deuda-de-infraestructura">11.2.3 Deuda de infraestructura<a href="#1123-deuda-de-infraestructura" class="hash-link" aria-label="Enlace directo al 11.2.3 Deuda de infraestructura" title="Enlace directo al 11.2.3 Deuda de infraestructura">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-007-configuración-manual-de-partitions">DT-007: Configuración manual de partitions<a href="#dt-007-configuración-manual-de-partitions" class="hash-link" aria-label="Enlace directo al DT-007: Configuración manual de partitions" title="Enlace directo al DT-007: Configuración manual de partitions">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Partitions de Event Bus y PostgreSQL creadas manualmente</li>
<li><strong>Impacto</strong>: Inconsistencias entre entornos y scaling manual</li>
<li><strong>Plan de resolución</strong>: Infrastructure as Code para todo el setup</li>
<li><strong>Prioridad</strong>: Media</li>
<li><strong>Estimación</strong>: 2 sprints</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dt-008-monitoring-gaps">DT-008: Monitoring gaps<a href="#dt-008-monitoring-gaps" class="hash-link" aria-label="Enlace directo al DT-008: Monitoring gaps" title="Enlace directo al DT-008: Monitoring gaps">​</a></h4>
<ul>
<li><strong>Descripción</strong>: Métricas de negocio no centralizadas ni estandarizadas</li>
<li><strong>Impacto</strong>: Dificultad en identificar trends y issues de negocio</li>
<li><strong>Plan de resolución</strong>: Dashboard unificado con métricas estándar</li>
<li><strong>Prioridad</strong>: Media</li>
<li><strong>Estimación</strong>: 2 sprints</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="113-plan-de-mitigación">11.3 Plan de mitigación<a href="#113-plan-de-mitigación" class="hash-link" aria-label="Enlace directo al 11.3 Plan de mitigación" title="Enlace directo al 11.3 Plan de mitigación">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1131-cronograma-de-resolución">11.3.1 Cronograma de resolución<a href="#1131-cronograma-de-resolución" class="hash-link" aria-label="Enlace directo al 11.3.1 Cronograma de resolución" title="Enlace directo al 11.3.1 Cronograma de resolución">​</a></h3>
<table><thead><tr><th>Elemento</th><th>Tipo</th><th>Prioridad</th><th>Sprint Target</th><th>Responsable</th><th>Estado</th></tr></thead><tbody><tr><td>DT-005</td><td>Testing</td><td>Alta</td><td>Sprint 24.3</td><td>QA Team</td><td>🟡 En progreso</td></tr><tr><td>DT-001</td><td>Arquitectura</td><td>Alta</td><td>Sprint 24.4</td><td>Backend Team</td><td>📅 Planificado</td></tr><tr><td>RT-003</td><td>Performance</td><td>Alta</td><td>Sprint 24.5</td><td>Infrastructure Team</td><td>📅 Planificado</td></tr><tr><td>DT-002</td><td>Event versioning</td><td>Media</td><td>Sprint 24.6</td><td>Backend Team</td><td>📋 Backlog</td></tr><tr><td>DT-007</td><td>IaC</td><td>Media</td><td>Sprint 24.7</td><td>Equipo DevOps</td><td>📋 Backlog</td></tr><tr><td>DT-003</td><td>Snapshots</td><td>Media</td><td>Sprint 24.8</td><td>Backend Team</td><td>📋 Backlog</td></tr><tr><td>DT-008</td><td>Monitoring</td><td>Media</td><td>Sprint 24.9</td><td>Equipo DevOps</td><td>📋 Backlog</td></tr><tr><td>DT-004</td><td>Refactoring</td><td>Baja</td><td>Sprint 24.10</td><td>Backend Team</td><td>📋 Backlog</td></tr><tr><td>DT-006</td><td>Logging</td><td>Baja</td><td>Sprint 24.11</td><td>Backend Team</td><td>📋 Backlog</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1132-métricas-de-seguimiento">11.3.2 Métricas de seguimiento<a href="#1132-métricas-de-seguimiento" class="hash-link" aria-label="Enlace directo al 11.3.2 Métricas de seguimiento" title="Enlace directo al 11.3.2 Métricas de seguimiento">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="riesgos-técnicos">Riesgos técnicos<a href="#riesgos-técnicos" class="hash-link" aria-label="Enlace directo al Riesgos técnicos" title="Enlace directo al Riesgos técnicos">​</a></h4>
<ul>
<li><strong>Event Store latency</strong>: Meta P95 &lt; 50ms (actual 45ms) ✅</li>
<li><strong>Read model lag</strong>: Meta &lt; 3s (actual 2.1s) ✅</li>
<li><strong>Error rate</strong>: Meta &lt; 0.1% (actual 0.05%) ✅</li>
<li><strong>Team velocity</strong>: Mantener &gt; 80% durante refactoring</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deuda-técnica">Deuda técnica<a href="#deuda-técnica" class="hash-link" aria-label="Enlace directo al Deuda técnica" title="Enlace directo al Deuda técnica">​</a></h4>
<ul>
<li><strong>Code coverage</strong>: Meta 90% (actual 87%) 🟡</li>
<li><strong>Cyclomatic complexity</strong>: Meta &lt; 8 (actual 9.2) 🔴</li>
<li><strong>Duplication rate</strong>: Meta &lt; 3% (actual 5.1%) 🔴</li>
<li><strong>Technical debt ratio</strong>: Meta &lt; 5% (actual 7.3%) 🔴</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1133-proceso-de-revisión">11.3.3 Proceso de revisión<a href="#1133-proceso-de-revisión" class="hash-link" aria-label="Enlace directo al 11.3.3 Proceso de revisión" title="Enlace directo al 11.3.3 Proceso de revisión">​</a></h3>
<p><strong>Governance</strong>:</p>
<ul>
<li><strong>Frecuencia</strong>: Weekly risk review en standup, monthly deep-dive</li>
<li><strong>Stakeholders</strong>: Tech Lead, Product Owner, Senior Developers</li>
<li><strong>Escalación</strong>: CTO para riesgos críticos o deuda &gt; 10% del capacity</li>
</ul>
<p><strong>Criterios de priorización</strong>:</p>
<ol>
<li><strong>Riesgo crítico</strong>: Probabilidad alta + impacto alto</li>
<li><strong>Deuda que bloquea features</strong>: Impacto directo en roadmap</li>
<li><strong>Security/compliance risks</strong>: Impacto regulatorio</li>
<li><strong>Performance degradation</strong>: Impacto en SLAs</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="114-indicadores-de-alarma">11.4 Indicadores de alarma<a href="#114-indicadores-de-alarma" class="hash-link" aria-label="Enlace directo al 11.4 Indicadores de alarma" title="Enlace directo al 11.4 Indicadores de alarma">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1141-métricas-críticas">11.4.1 Métricas críticas<a href="#1141-métricas-críticas" class="hash-link" aria-label="Enlace directo al 11.4.1 Métricas críticas" title="Enlace directo al 11.4.1 Métricas críticas">​</a></h3>
<p><strong>Technical Health</strong>:</p>
<ul>
<li><strong>Event Store latency P99</strong> &gt; 200ms → Investigación inmediata</li>
<li><strong>Read model lag</strong> &gt; 10 segundos → Escalación automática</li>
<li><strong>Error rate</strong> &gt; 0.5% por 10 minutos → Alerta crítica</li>
<li><strong>Disk usage</strong> &gt; 85% → Planning de scaling urgente</li>
</ul>
<p><strong>Business Impact</strong>:</p>
<ul>
<li><strong>Event ingestion rate</strong> decline &gt; 20% → Business escalation</li>
<li><strong>Query timeout rate</strong> &gt; 2% → Performance review</li>
<li><strong>Tenant onboarding</strong> blocked → Process review</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1142-debt-accumulation-thresholds">11.4.2 Debt Accumulation Thresholds<a href="#1142-debt-accumulation-thresholds" class="hash-link" aria-label="Enlace directo al 11.4.2 Debt Accumulation Thresholds" title="Enlace directo al 11.4.2 Debt Accumulation Thresholds">​</a></h3>
<p><strong>Code Quality</strong>:</p>
<ul>
<li><strong>Complexity increase</strong> &gt; 15% en 1 sprint → Mandatory refactoring</li>
<li><strong>Coverage decrease</strong> &gt; 5% → Block deployment</li>
<li><strong>Duplication increase</strong> &gt; 2% → Technical debt sprint</li>
</ul>
<p><strong>Architecture Erosion</strong>:</p>
<ul>
<li><strong>Cross-layer dependencies</strong> detected → Architecture review</li>
<li><strong>Event schema violations</strong> → Immediate fix required</li>
<li><strong>Performance regression</strong> &gt; 10% → Rollback consideration</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1143-acciones-automáticas-1">11.4.3 Acciones automáticas<a href="#1143-acciones-automáticas-1" class="hash-link" aria-label="Enlace directo al 11.4.3 Acciones automáticas" title="Enlace directo al 11.4.3 Acciones automáticas">​</a></h3>
<p><strong>Preventive Actions</strong>:</p>
<ul>
<li><strong>Auto-scaling</strong>: Trigger en 70% CPU/Memory por 5 minutos</li>
<li><strong>Circuit breaker</strong>: Abrir en 50% error rate por 1 minuto</li>
<li><strong>Snapshot creation</strong>: Trigger en 1000 events por stream</li>
<li><strong>Partition creation</strong>: Trigger en 80% capacidad</li>
</ul>
<p><strong>Remediation Actions</strong>:</p>
<ul>
<li><strong>Event replay</strong>: Automático para corruption detection</li>
<li><strong>Read model rebuild</strong>: Trigger en consistency SLA breach</li>
<li><strong>Failover</strong>: Automático para Event Store unavailability</li>
<li><strong>Alert escalation</strong>: PagerDuty para P1 incidents después de 5 min</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="115-investment-strategy-1">11.5 Investment Strategy<a href="#115-investment-strategy-1" class="hash-link" aria-label="Enlace directo al 11.5 Investment Strategy" title="Enlace directo al 11.5 Investment Strategy">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1151-continuous-investment-20-capacity-1">11.5.1 Continuous Investment (20% capacity)<a href="#1151-continuous-investment-20-capacity-1" class="hash-link" aria-label="Enlace directo al 11.5.1 Continuous Investment (20% capacity)" title="Enlace directo al 11.5.1 Continuous Investment (20% capacity)">​</a></h3>
<ul>
<li>Event Sourcing tooling improvements</li>
<li>Performance optimizations</li>
<li>Developer experience enhancements</li>
<li>Monitoring and observability</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1152-planned-deuda-técnica-sprints-q2-2024">11.5.2 Planned Deuda Técnica Sprints (Q2 2024)<a href="#1152-planned-deuda-técnica-sprints-q2-2024" class="hash-link" aria-label="Enlace directo al 11.5.2 Planned Deuda Técnica Sprints (Q2 2024)" title="Enlace directo al 11.5.2 Planned Deuda Técnica Sprints (Q2 2024)">​</a></h3>
<ul>
<li><strong>Sprint 24.6</strong>: Event versioning standardization</li>
<li><strong>Sprint 24.8</strong>: Projection engine refactoring</li>
<li><strong>Sprint 24.10</strong>: Testing infrastructure improvements</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1153-architecture-evolution-2024-roadmap-1">11.5.3 Architecture Evolution (2024 Roadmap)<a href="#1153-architecture-evolution-2024-roadmap-1" class="hash-link" aria-label="Enlace directo al 11.5.3 Architecture Evolution (2024 Roadmap)" title="Enlace directo al 11.5.3 Architecture Evolution (2024 Roadmap)">​</a></h3>
<ul>
<li><strong>Q2</strong>: Sharding strategy implementation</li>
<li><strong>Q3</strong>: Multi-region deployment</li>
<li><strong>Q4</strong>: ML-based anomaly detection</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-track-trace/11-riesgos-deuda-tecnica.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Editar esta página</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Página del documento"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/servicios-corporativos/servicio-track-trace/requisitos-calidad"><div class="pagination-nav__sublabel">Anterior</div><div class="pagination-nav__label">10. Requisitos de calidad</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/servicios-corporativos/servicio-track-trace/glosario"><div class="pagination-nav__sublabel">Siguiente</div><div class="pagination-nav__label">12. Glosario</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#111-riesgos-identificados" class="table-of-contents__link toc-highlight">11.1 Riesgos identificados</a></li><li><a href="#112-deuda-técnica" class="table-of-contents__link toc-highlight">11.2 Deuda técnica</a></li><li><a href="#113-acciones-recomendadas" class="table-of-contents__link toc-highlight">11.3 Acciones recomendadas</a></li><li><a href="#111-matriz-de-riesgos" class="table-of-contents__link toc-highlight">11.1 Matriz de riesgos</a><ul><li><a href="#1111-riesgos-técnicos-de-alta-prioridad" class="table-of-contents__link toc-highlight">11.1.1 Riesgos técnicos de alta prioridad</a></li><li><a href="#1112-riesgos-operacionales" class="table-of-contents__link toc-highlight">11.1.2 Riesgos operacionales</a></li><li><a href="#1113-riesgos-de-compliance" class="table-of-contents__link toc-highlight">11.1.3 Riesgos de compliance</a></li></ul></li><li><a href="#112-deuda-técnica-identificada" class="table-of-contents__link toc-highlight">11.2 Deuda técnica identificada</a><ul><li><a href="#1121-deuda-de-alto-impacto" class="table-of-contents__link toc-highlight">11.2.1 Deuda de alto impacto</a></li><li><a href="#1122-deuda-de-impacto-medio" class="table-of-contents__link toc-highlight">11.2.2 Deuda de impacto medio</a></li></ul></li><li><a href="#113-plan-de-gestión-de-riesgos" class="table-of-contents__link toc-highlight">11.3 Plan de gestión de riesgos</a><ul><li><a href="#1131-governance-framework" class="table-of-contents__link toc-highlight">11.3.1 Governance Framework</a></li><li><a href="#1132-mitigation-budget-allocation" class="table-of-contents__link toc-highlight">11.3.2 Mitigation Budget Allocation</a></li><li><a href="#1133-success-metrics" class="table-of-contents__link toc-highlight">11.3.3 Success Metrics</a></li></ul></li><li><a href="#114-monitoring-y-alertas-de-riesgos" class="table-of-contents__link toc-highlight">11.4 Monitoring y alertas de riesgos</a><ul><li><a href="#1141-early-warning-indicators" class="table-of-contents__link toc-highlight">11.4.1 Early Warning Indicators</a></li><li><a href="#1142-automated-risk-response" class="table-of-contents__link toc-highlight">11.4.2 Automated Risk Response</a></li><li><a href="#1143-acciones-automáticas" class="table-of-contents__link toc-highlight">11.4.3 Acciones automáticas</a></li></ul></li><li><a href="#115-investment-strategy" class="table-of-contents__link toc-highlight">11.5 Investment Strategy</a><ul><li><a href="#1151-continuous-investment-20-capacity" class="table-of-contents__link toc-highlight">11.5.1 Continuous Investment (20% capacity)</a></li><li><a href="#1152-planned-deuda-técnica-sprints-2024" class="table-of-contents__link toc-highlight">11.5.2 Planned Deuda Técnica Sprints (2024)</a></li><li><a href="#1153-architecture-evolution-2024-roadmap" class="table-of-contents__link toc-highlight">11.5.3 Architecture Evolution (2024 Roadmap)</a></li><li><a href="#1154-roi-expectations" class="table-of-contents__link toc-highlight">11.5.4 ROI Expectations</a></li><li><a href="#1112-riesgos-operacionales-1" class="table-of-contents__link toc-highlight">11.1.2 Riesgos operacionales</a></li><li><a href="#1113-riesgos-de-compliance-y-seguridad" class="table-of-contents__link toc-highlight">11.1.3 Riesgos de compliance y seguridad</a></li></ul></li><li><a href="#112-plan-de-gestión-de-deuda-técnica" class="table-of-contents__link toc-highlight">11.2 Plan de gestión de deuda técnica</a><ul><li><a href="#1121-deuda-técnica-identificada" class="table-of-contents__link toc-highlight">11.2.1 Deuda técnica identificada</a></li><li><a href="#1122-estrategia-de-remediación" class="table-of-contents__link toc-highlight">11.2.2 Estrategia de remediación</a></li><li><a href="#1123-métricas-de-deuda-técnica" class="table-of-contents__link toc-highlight">11.2.3 Métricas de deuda técnica</a></li><li><a href="#1113-riesgos-operacionales" class="table-of-contents__link toc-highlight">11.1.3 Riesgos operacionales</a></li></ul></li><li><a href="#112-deuda-técnica-1" class="table-of-contents__link toc-highlight">11.2 Deuda técnica</a><ul><li><a href="#1121-deuda-de-arquitectura" class="table-of-contents__link toc-highlight">11.2.1 Deuda de arquitectura</a></li><li><a href="#1122-deuda-de-código" class="table-of-contents__link toc-highlight">11.2.2 Deuda de código</a></li><li><a href="#1123-deuda-de-infraestructura" class="table-of-contents__link toc-highlight">11.2.3 Deuda de infraestructura</a></li></ul></li><li><a href="#113-plan-de-mitigación" class="table-of-contents__link toc-highlight">11.3 Plan de mitigación</a><ul><li><a href="#1131-cronograma-de-resolución" class="table-of-contents__link toc-highlight">11.3.1 Cronograma de resolución</a></li><li><a href="#1132-métricas-de-seguimiento" class="table-of-contents__link toc-highlight">11.3.2 Métricas de seguimiento</a></li><li><a href="#1133-proceso-de-revisión" class="table-of-contents__link toc-highlight">11.3.3 Proceso de revisión</a></li></ul></li><li><a href="#114-indicadores-de-alarma" class="table-of-contents__link toc-highlight">11.4 Indicadores de alarma</a><ul><li><a href="#1141-métricas-críticas" class="table-of-contents__link toc-highlight">11.4.1 Métricas críticas</a></li><li><a href="#1142-debt-accumulation-thresholds" class="table-of-contents__link toc-highlight">11.4.2 Debt Accumulation Thresholds</a></li><li><a href="#1143-acciones-automáticas-1" class="table-of-contents__link toc-highlight">11.4.3 Acciones automáticas</a></li></ul></li><li><a href="#115-investment-strategy-1" class="table-of-contents__link toc-highlight">11.5 Investment Strategy</a><ul><li><a href="#1151-continuous-investment-20-capacity-1" class="table-of-contents__link toc-highlight">11.5.1 Continuous Investment (20% capacity)</a></li><li><a href="#1152-planned-deuda-técnica-sprints-q2-2024" class="table-of-contents__link toc-highlight">11.5.2 Planned Deuda Técnica Sprints (Q2 2024)</a></li><li><a href="#1153-architecture-evolution-2024-roadmap-1" class="table-of-contents__link toc-highlight">11.5.3 Architecture Evolution (2024 Roadmap)</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentación</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Comunidad</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://pe.linkedin.com/company/talma-servicios-aeroportuarios" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC-LkTBWGU2aSh-00bv83OlA" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/talmaperu/?ref=br_rs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Más</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jclemente-tlm/tlm-doc-architecture" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Talma. Documentación construida con Docusaurus.</div></div></div></footer></div>
</body>
</html>