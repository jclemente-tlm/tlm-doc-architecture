"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[4853],{5307:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"servicios-corporativos/servicio-notificacion/vista-implementacion","title":"7. Vista de implementaci\xf3n","description":"Vista de implementaci\xf3n del Sistema de Notificaci\xf3n","source":"@site/docs/servicios-corporativos/servicio-notificacion/07-vista-implementacion.md","sourceDirName":"servicios-corporativos/servicio-notificacion","slug":"/servicios-corporativos/servicio-notificacion/vista-implementacion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/vista-implementacion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-notificacion/07-vista-implementacion.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"6. Vista de tiempo de ejecuci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/vista-tiempo-ejecucion"},"next":{"title":"8. Conceptos transversales","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/conceptos-transversales"}}');var c=n(74848),r=n(28453);const d={},o="7. Vista de implementaci\xf3n",l={},a=[{value:"7.1 Estructura del proyecto",id:"71-estructura-del-proyecto",level:2},{value:"7.2 Dependencias principales",id:"72-dependencias-principales",level:2},{value:"7.3 Infraestructura de despliegue",id:"73-infraestructura-de-despliegue",level:2},{value:"Contenedores principales",id:"contenedores-principales",level:3},{value:"Ejemplo de despliegue (kubernetes)",id:"ejemplo-de-despliegue-kubernetes",level:4},{value:"Mensajer\xeda y almacenamiento",id:"mensajer\xeda-y-almacenamiento",level:3},{value:"7.4 Entornos de despliegue",id:"74-entornos-de-despliegue",level:2},{value:"7.5 Integraci\xf3n con proveedores",id:"75-integraci\xf3n-con-proveedores",level:2},{value:"Abstracci\xf3n de proveedores",id:"abstracci\xf3n-de-proveedores",level:3},{value:"7.6 Seguridad",id:"76-seguridad",level:2},{value:"7.7 Observabilidad y monitoreo",id:"77-observabilidad-y-monitoreo",level:2},{value:"7.8 CI/CD pipeline",id:"78-cicd-pipeline",level:2},{value:"7.9 Estrategia de escalado",id:"79-estrategia-de-escalado",level:2},{value:"Referencias",id:"referencias",level:2}];function t(e){const i={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.header,{children:(0,c.jsx)(i.h1,{id:"7-vista-de-implementaci\xf3n",children:"7. Vista de implementaci\xf3n"})}),"\n",(0,c.jsxs)(i.p,{children:[(0,c.jsx)(i.img,{alt:"Vista de implementaci\xf3n del Sistema de Notificaci\xf3n",src:n(43182).A+"",width:"8645",height:"3949"}),"\n",(0,c.jsx)(i.em,{children:"Figura 7.1: Implementaci\xf3n de Componentes de principales del sistema"})]}),"\n",(0,c.jsx)(i.h2,{id:"71-estructura-del-proyecto",children:"7.1 Estructura del proyecto"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Componente"}),(0,c.jsx)(i.th,{children:"Ubicaci\xf3n"}),(0,c.jsx)(i.th,{children:"Tecnolog\xeda"})]})}),(0,c.jsxs)(i.tbody,{children:[(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"Notification API"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"/src/NotificationApi"})}),(0,c.jsxs)(i.td,{children:[(0,c.jsx)(i.code,{children:".NET 8 Web API"}),", ",(0,c.jsx)(i.code,{children:"YARP"})]})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"PostgreSQL"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"AWS RDS"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"PostgreSQL 15+"})})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"Redis"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"AWS ElastiCache"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"Redis 7+"})})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"File Storage"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"AWS EFS"})}),(0,c.jsx)(i.td,{children:"Sistema de archivos"})]})]})]}),"\n",(0,c.jsx)(i.h2,{id:"72-dependencias-principales",children:"7.2 Dependencias principales"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Dependencia"}),(0,c.jsx)(i.th,{children:"Versi\xf3n"}),(0,c.jsx)(i.th,{children:"Prop\xf3sito"})]})}),(0,c.jsxs)(i.tbody,{children:[(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"Entity Framework"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"8.0+"})}),(0,c.jsx)(i.td,{children:"ORM"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"FluentValidation"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"11.0+"})}),(0,c.jsx)(i.td,{children:"Validaci\xf3n"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"Mapster"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"7.0+"})}),(0,c.jsx)(i.td,{children:"Mapeo objetos"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"RazorEngine"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"4.0+"})}),(0,c.jsx)(i.td,{children:"Plantillas"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"Serilog"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"3.0+"})}),(0,c.jsx)(i.td,{children:"Logging"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"OpenTelemetry"})}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"1.7+"})}),(0,c.jsx)(i.td,{children:"Trazas"})]})]})]}),"\n",(0,c.jsx)(i.h2,{id:"73-infraestructura-de-despliegue",children:"7.3 Infraestructura de despliegue"}),"\n",(0,c.jsx)(i.h3,{id:"contenedores-principales",children:"Contenedores principales"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"Notification API"}),": expuesto v\xeda ",(0,c.jsx)(i.code,{children:"YARP"})," y ",(0,c.jsx)(i.code,{children:"ALB"}),", escalable, acceso a base de datos y colas de mensajes."]}),"\n"]}),"\n",(0,c.jsx)(i.h4,{id:"ejemplo-de-despliegue-kubernetes",children:"Ejemplo de despliegue (kubernetes)"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: notification-api\nspec:\n  replicas: 3\n  template:\n    spec:\n      containers:\n      - name: notification-api\n        image: corporativo/notification-api:latest\n        ports:\n        - containerPort: 8080\n        env:\n        - name: DATABASE_URL\n          valueFrom:\n            secretKeyRef:\n              name: db-secret\n              key: url\n        - name: KAFKA_BROKERS\n          value: "eventbus-cluster:9092"\n        resources:\n          requests:\n            memory: "512Mi"\n            cpu: "250m"\n          limits:\n            memory: "1Gi"\n            cpu: "500m"\n'})}),"\n",(0,c.jsx)(i.h3,{id:"mensajer\xeda-y-almacenamiento",children:"Mensajer\xeda y almacenamiento"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["Event Bus agn\xf3stico (",(0,c.jsx)(i.code,{children:"Kafka"}),"): 3 brokers, 12 particiones por t\xf3pico, retenci\xf3n 7 d\xedas."]}),"\n",(0,c.jsxs)(i.li,{children:["T\xf3picos principales: ",(0,c.jsx)(i.code,{children:"notification-requests"})," (delete, 7 d\xedas), ",(0,c.jsx)(i.code,{children:"notification-status"})," (compact, 30 d\xedas)."]}),"\n",(0,c.jsxs)(i.li,{children:["Almacenamiento de archivos: ",(0,c.jsx)(i.code,{children:"AWS EFS"}),"."]}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"74-entornos-de-despliegue",children:"7.4 Entornos de despliegue"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"Desarrollo:"})," ",(0,c.jsx)(i.code,{children:"minikube"}),", ",(0,c.jsx)(i.code,{children:"PostgreSQL"})," local, ",(0,c.jsx)(i.code,{children:"Kafka"})," y ",(0,c.jsx)(i.code,{children:"Redis"})," single instance, ",(0,c.jsx)(i.code,{children:"Mailhog"}),", logs locales."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"Staging:"})," ",(0,c.jsx)(i.code,{children:"AWS EKS"}),", ",(0,c.jsx)(i.code,{children:"RDS"}),", ",(0,c.jsx)(i.code,{children:"MSK"}),", ",(0,c.jsx)(i.code,{children:"ElastiCache"}),", ",(0,c.jsx)(i.code,{children:"SendGrid"}),"/",(0,c.jsx)(i.code,{children:"Twilio"})," test, ",(0,c.jsx)(i.code,{children:"Prometheus"}),", ",(0,c.jsx)(i.code,{children:"Grafana"}),", ",(0,c.jsx)(i.code,{children:"Loki"}),", ",(0,c.jsx)(i.code,{children:"Jaeger"}),", ",(0,c.jsx)(i.code,{children:"CloudWatch"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.strong,{children:"Producci\xf3n:"})," ",(0,c.jsx)(i.code,{children:"AWS EKS"})," multi-AZ, ",(0,c.jsx)(i.code,{children:"RDS"})," multi-AZ, ",(0,c.jsx)(i.code,{children:"MSK"}),", ",(0,c.jsx)(i.code,{children:"ElastiCache"})," cluster, ",(0,c.jsx)(i.code,{children:"CloudFront"}),", ",(0,c.jsx)(i.code,{children:"SendGrid+SES+Mailgun"}),", ",(0,c.jsx)(i.code,{children:"Twilio+SNS+360dialog"}),", ",(0,c.jsx)(i.code,{children:"FCM+APNS"}),", ",(0,c.jsx)(i.code,{children:"WhatsApp Business API"}),"."]}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"75-integraci\xf3n-con-proveedores",children:"7.5 Integraci\xf3n con proveedores"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"Email"}),": ",(0,c.jsx)(i.code,{children:"SendGrid"})," (primario), ",(0,c.jsx)(i.code,{children:"SES"})," (secundario), ",(0,c.jsx)(i.code,{children:"Mailgun"})," (emergencia)."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"SMS"}),": ",(0,c.jsx)(i.code,{children:"Twilio"})," (primario), ",(0,c.jsx)(i.code,{children:"SNS"})," (secundario), ",(0,c.jsx)(i.code,{children:"360dialog"})," (",(0,c.jsx)(i.code,{children:"WhatsApp"}),")."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"Push"}),": ",(0,c.jsx)(i.code,{children:"Firebase Cloud Messaging (FCM)"}),", ",(0,c.jsx)(i.code,{children:"Apple Push Notification Service (APNS)"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"WhatsApp"}),": ",(0,c.jsx)(i.code,{children:"360dialog"}),", ",(0,c.jsx)(i.code,{children:"WhatsApp Business API"}),"."]}),"\n"]}),"\n",(0,c.jsx)(i.h3,{id:"abstracci\xf3n-de-proveedores",children:"Abstracci\xf3n de proveedores"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{className:"language-csharp",children:"public interface INotificationProvider\n{\n    Task<DeliveryResult> SendAsync(NotificationMessage message);\n    NotificationChannel SupportedChannel { get; }\n}\n\npublic class EmailProviderFactory\n{\n    public IEmailProvider GetProvider(EmailProviderType type)\n    {\n        return type switch\n        {\n            EmailProviderType.SendGrid => new SendGridProvider(),\n            EmailProviderType.SES => new SesProvider(),\n            EmailProviderType.Mailgun => new MailgunProvider(),\n            _ => throw new NotSupportedException()\n        };\n    }\n}\n"})}),"\n",(0,c.jsx)(i.h2,{id:"76-seguridad",children:"7.6 Seguridad"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["Autenticaci\xf3n y autorizaci\xf3n: ",(0,c.jsx)(i.code,{children:"Keycloak"}),", validaci\xf3n ",(0,c.jsx)(i.code,{children:"JWT"}),", control de roles y claims."]}),"\n",(0,c.jsxs)(i.li,{children:["Pol\xedticas de red: acceso restringido por capa (",(0,c.jsx)(i.code,{children:"API"}),", procesamiento, base de datos, cache)."]}),"\n",(0,c.jsx)(i.li,{children:"Grupos de seguridad: control de puertos y or\xedgenes."}),"\n",(0,c.jsxs)(i.li,{children:["Gesti\xf3n de secretos: ",(0,c.jsx)(i.code,{children:"AWS Secrets Manager"})," para credenciales de proveedores."]}),"\n",(0,c.jsxs)(i.li,{children:["Cifrado: ",(0,c.jsx)(i.code,{children:"AES-256"})," en reposo, ",(0,c.jsx)(i.code,{children:"TLS 1.3"})," en tr\xe1nsito, ",(0,c.jsx)(i.code,{children:"mTLS"})," interno, protecci\xf3n de ",(0,c.jsx)(i.code,{children:"PII"})," (hash, cifrado)."]}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"77-observabilidad-y-monitoreo",children:"7.7 Observabilidad y monitoreo"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["M\xe9tricas: ",(0,c.jsx)(i.code,{children:"Prometheus"})," (notificaciones enviadas, entregadas, fallidas, tiempos de entrega, uso de API, profundidad de cola, tiempos de respuesta de proveedores, cache hit ratio)."]}),"\n",(0,c.jsxs)(i.li,{children:["Logging: ",(0,c.jsx)(i.code,{children:"Serilog"})," + ",(0,c.jsx)(i.code,{children:"Loki"})," (",(0,c.jsx)(i.code,{children:"JSON"}),", ",(0,c.jsx)(i.code,{children:"correlationId"}),", niveles ",(0,c.jsx)(i.code,{children:"DEBUG"}),"/",(0,c.jsx)(i.code,{children:"INFO"}),"/",(0,c.jsx)(i.code,{children:"WARN"}),"/",(0,c.jsx)(i.code,{children:"ERROR"}),"/",(0,c.jsx)(i.code,{children:"FATAL"}),")."]}),"\n",(0,c.jsxs)(i.li,{children:["Trazas: ",(0,c.jsx)(i.code,{children:"OpenTelemetry"})," + ",(0,c.jsx)(i.code,{children:"Jaeger"})," (",(0,c.jsx)(i.code,{children:"API"}),", procesamiento, proveedores, base de datos; sampling adaptativo por entorno)."]}),"\n",(0,c.jsxs)(i.li,{children:["Visualizaci\xf3n: ",(0,c.jsx)(i.code,{children:"Grafana"}),"."]}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"78-cicd-pipeline",children:"7.8 CI/CD pipeline"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["Build: ",(0,c.jsx)(i.code,{children:"GitHub Actions"}),", ",(0,c.jsx)(i.code,{children:".NET 8"}),", tests, cobertura, ",(0,c.jsx)(i.code,{children:"SonarQube"}),", ",(0,c.jsx)(i.code,{children:"Docker"}),", ",(0,c.jsx)(i.code,{children:"Trivy"}),", push a registry."]}),"\n",(0,c.jsx)(i.li,{children:"Deploy: validaci\xf3n de manifiestos, despliegue a staging, pruebas de integraci\xf3n, carga y seguridad, aprobaci\xf3n manual, blue-green, smoke tests."}),"\n",(0,c.jsxs)(i.li,{children:["Configuraci\xf3n: ",(0,c.jsx)(i.code,{children:"ConfigMap"})," y ",(0,c.jsx)(i.code,{children:"Secrets"})," por entorno."]}),"\n",(0,c.jsxs)(i.li,{children:["Infraestructura como c\xf3digo: ",(0,c.jsx)(i.code,{children:"Terraform"}),"."]}),"\n",(0,c.jsxs)(i.li,{children:["Migraciones: ",(0,c.jsx)(i.code,{children:"Liquibase"}),", cambios compatibles, rollback, pipeline validado y automatizado."]}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"79-estrategia-de-escalado",children:"7.9 Estrategia de escalado"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["Autoescalado horizontal por canal y tipo de notificaci\xf3n (",(0,c.jsx)(i.code,{children:"Kubernetes HPA"}),", ",(0,c.jsx)(i.code,{children:"AWS ASG"}),")."]}),"\n",(0,c.jsx)(i.li,{children:"Umbrales de CPU, profundidad de cola y latencia para disparar escalado."}),"\n",(0,c.jsx)(i.li,{children:"Estrategia blue-green y zero-downtime para despliegues cr\xedticos."}),"\n"]}),"\n",(0,c.jsx)(i.hr,{}),"\n",(0,c.jsx)(i.p,{children:(0,c.jsx)(i.strong,{children:"Notas:"})}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"La infraestructura prioriza la resiliencia, la observabilidad, la seguridad y la entrega \xfanica."}),"\n",(0,c.jsx)(i.li,{children:"La gesti\xf3n de secretos y la automatizaci\xf3n de CI/CD son obligatorias para todos los entornos."}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"referencias",children:"Referencias"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://kubernetes.io/docs/concepts/configuration/overview/",children:"Kubernetes Mejores Pr\xe1cticas"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://microservices.io/patterns/deployment/",children:"Microservices Deployment Patterns"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://kafka.apache.org/documentation/#operations",children:"Event Bus agn\xf3stico Operations"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://docs.arc42.org/section-7/",children:"Arc42 Deployment View"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,c.jsx)(i,{...e,children:(0,c.jsx)(t,{...e})}):t(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>d,x:()=>o});var s=n(96540);const c={},r=s.createContext(c);function d(e){const i=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:d(e.components),s.createElement(r.Provider,{value:i},e.children)}},43182:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/notification_system_deployment-93b5774370025d68998d044c76d8ceb6.png"}}]);