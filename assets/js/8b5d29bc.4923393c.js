"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[3788],{28453:(e,i,s)=>{s.d(i,{R:()=>t,x:()=>l});var r=s(96540);const n={},d=r.createContext(n);function t(e){const i=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),r.createElement(d.Provider,{value:i},e.children)}},86006:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"adrs/adr-015-manejo-errores-cola","title":"ADR-015: Manejo de Errores en Cola","description":"\u2705 ESTADO","source":"@site/docs/adrs/adr-015-manejo-errores-cola.md","sourceDirName":"adrs","slug":"/adrs/adr-015-manejo-errores-cola","permalink":"/tlm-doc-architecture/docs/adrs/adr-015-manejo-errores-cola","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/adrs/adr-015-manejo-errores-cola.md","tags":[],"version":"current","sidebarPosition":15,"frontMatter":{"title":"ADR-015: Manejo de Errores en Cola","sidebar_position":15},"sidebar":"tutorialSidebar","previous":{"title":"ADR-014: Almacenamiento de Objetos Empresarial","permalink":"/tlm-doc-architecture/docs/adrs/adr-014-almacenamiento-objetos"},"next":{"title":"ADR-016: Logging Estructurado","permalink":"/tlm-doc-architecture/docs/adrs/adr-016-logging-estructurado"}}');var n=s(74848),d=s(28453);const t={title:"ADR-015: Manejo de Errores en Cola",sidebar_position:15},l=void 0,a={},c=[{value:"\u2705 ESTADO",id:"-estado",level:2},{value:"\ud83d\uddfa\ufe0f CONTEXTO",id:"\ufe0f-contexto",level:2},{value:"\ud83d\udd0d COMPARATIVA DE ALTERNATIVAS",id:"-comparativa-de-alternativas",level:2},{value:"Comparativa Cualitativa",id:"comparativa-cualitativa",level:3},{value:"Matriz de Decisi\xf3n",id:"matriz-de-decisi\xf3n",level:3},{value:"\ud83d\udcb0 AN\xc1LISIS DE COSTOS (TCO 3 a\xf1os)",id:"-an\xe1lisis-de-costos-tco-3-a\xf1os",level:2},{value:"Consideraciones t\xe9cnicas y riesgos",id:"consideraciones-t\xe9cnicas-y-riesgos",level:2},{value:"L\xedmites clave",id:"l\xedmites-clave",level:3},{value:"Riesgos y mitigaci\xf3n",id:"riesgos-y-mitigaci\xf3n",level:3},{value:"\u2714\ufe0f DECISI\xd3N",id:"\ufe0f-decisi\xf3n",level:2},{value:"Justificaci\xf3n",id:"justificaci\xf3n",level:2},{value:"Alternativas descartadas",id:"alternativas-descartadas",level:2},{value:"\u26a0\ufe0f CONSECUENCIAS",id:"\ufe0f-consecuencias",level:2},{value:"\ud83d\udcda REFERENCIAS",id:"-referencias",level:2}];function o(e){const i={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h2,{id:"-estado",children:"\u2705 ESTADO"}),"\n",(0,n.jsx)(i.p,{children:"Aceptada \u2013 Agosto 2025"}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"\ufe0f-contexto",children:"\ud83d\uddfa\ufe0f CONTEXTO"}),"\n",(0,n.jsx)(i.p,{children:"Los servicios corporativos distribuidos requieren una estrategia robusta para el manejo de errores en colas de mensajer\xeda as\xedncrona, considerando:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Mensajes fallidos"})," tras m\xfaltiples reintentos"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Poison messages"})," que generan errores recurrentes"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Recuperaci\xf3n y reprocesamiento"})," manual o automatizado"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Auditor\xeda y trazabilidad"})," de fallos"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Aislamiento de errores"})," para evitar bloqueos"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Alertas proactivas"})," ante patrones de fallo"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Retenci\xf3n configurable"})," seg\xfan criticidad"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Compatibilidad multi-tenant"})," y multipa\xeds"]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["La estrategia prioriza ",(0,n.jsx)(i.strong,{children:"resiliencia, observabilidad y simplicidad operativa"})," usando tecnolog\xedas y patrones aprobados."]}),"\n",(0,n.jsx)(i.p,{children:"Alternativas evaluadas:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Dead Letter Queue (DLQ)"})," con AWS SQS, Azure Service Bus, RabbitMQ"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Reintentos exponenciales"})," sin DLQ"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Circuit Breaker"})," complementario"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Manual retry"})," con almacenamiento persistente"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Event Store"})," con replay"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Enfoque h\xedbrido"})," (DLQ + Circuit Breaker)"]}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"-comparativa-de-alternativas",children:"\ud83d\udd0d COMPARATIVA DE ALTERNATIVAS"}),"\n",(0,n.jsx)(i.h3,{id:"comparativa-cualitativa",children:"Comparativa Cualitativa"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Criterio"}),(0,n.jsx)(i.th,{children:"DLQ"}),(0,n.jsx)(i.th,{children:"Reintentos"}),(0,n.jsx)(i.th,{children:"Circuit Breaker"}),(0,n.jsx)(i.th,{children:"Manual Retry"}),(0,n.jsx)(i.th,{children:"Event Store"}),(0,n.jsx)(i.th,{children:"H\xedbrido (DLQ+CB)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Resiliencia"})}),(0,n.jsx)(i.td,{children:"\u2705 Completa"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Limitada"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Temporal"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Parcial"}),(0,n.jsx)(i.td,{children:"\u2705 Completa"}),(0,n.jsx)(i.td,{children:"\u2705 M\xe1xima"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Observabilidad"})}),(0,n.jsx)(i.td,{children:"\u2705 Alta"}),(0,n.jsx)(i.td,{children:"\u274c Muy limitada"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 B\xe1sica"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Manual"}),(0,n.jsx)(i.td,{children:"\u2705 Completa"}),(0,n.jsx)(i.td,{children:"\u2705 Total"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Operaci\xf3n"})}),(0,n.jsx)(i.td,{children:"\u2705 Automatizada"}),(0,n.jsx)(i.td,{children:"\u2705 Simple"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Config. compleja"}),(0,n.jsx)(i.td,{children:"\u274c Manual"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Compleja"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Moderada"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Agnosticidad"})}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Depende del broker"}),(0,n.jsx)(i.td,{children:"\u2705 Total"}),(0,n.jsx)(i.td,{children:"\u2705 Universal"}),(0,n.jsx)(i.td,{children:"\u2705 Total"}),(0,n.jsx)(i.td,{children:"\u2705 Total"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Parcial"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Prevenci\xf3n p\xe9rdida"})}),(0,n.jsx)(i.td,{children:"\u2705 Cero p\xe9rdida"}),(0,n.jsx)(i.td,{children:"\u274c Alta probabilidad"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Parcial"}),(0,n.jsx)(i.td,{children:"\u2705 Persistencia"}),(0,n.jsx)(i.td,{children:"\u2705 Cero p\xe9rdida"}),(0,n.jsx)(i.td,{children:"\u2705 Cero p\xe9rdida"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Automatizaci\xf3n"})}),(0,n.jsx)(i.td,{children:"\u2705 Total"}),(0,n.jsx)(i.td,{children:"\u2705 Total"}),(0,n.jsx)(i.td,{children:"\u2705 Total"}),(0,n.jsx)(i.td,{children:"\u274c Manual"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Parcial"}),(0,n.jsx)(i.td,{children:"\u2705 Total"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Costos"})}),(0,n.jsx)(i.td,{children:"\u2705 Moderados"}),(0,n.jsx)(i.td,{children:"\u2705 Bajos"}),(0,n.jsx)(i.td,{children:"\u2705 Moderados"}),(0,n.jsx)(i.td,{children:"\u2705 Bajos"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Altos"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Moderados-altos"})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"matriz-de-decisi\xf3n",children:"Matriz de Decisi\xf3n"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Soluci\xf3n"}),(0,n.jsx)(i.th,{children:"Resiliencia"}),(0,n.jsx)(i.th,{children:"Observabilidad"}),(0,n.jsx)(i.th,{children:"Operaci\xf3n"}),(0,n.jsx)(i.th,{children:"Prevenci\xf3n P\xe9rdida"}),(0,n.jsx)(i.th,{children:"Recomendaci\xf3n"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"H\xedbrido (DLQ + CB)"})}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsx)(i.td,{children:"Moderada"}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsxs)(i.td,{children:["\u2705 ",(0,n.jsx)(i.strong,{children:"Seleccionada"})]})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Dead Letter Queue"})}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsx)(i.td,{children:"Autom\xe1tica"}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Alternativa"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Event Store"})}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsx)(i.td,{children:"Compleja"}),(0,n.jsx)(i.td,{children:"Excelente"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Considerada"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Circuit Breaker"})}),(0,n.jsx)(i.td,{children:"Moderada"}),(0,n.jsx)(i.td,{children:"B\xe1sica"}),(0,n.jsx)(i.td,{children:"Compleja"}),(0,n.jsx)(i.td,{children:"Moderada"}),(0,n.jsx)(i.td,{children:"\ud83d\udfe1 Complementaria"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Manual Retry"})}),(0,n.jsx)(i.td,{children:"Moderada"}),(0,n.jsx)(i.td,{children:"Limitada"}),(0,n.jsx)(i.td,{children:"Manual"}),(0,n.jsx)(i.td,{children:"Buena"}),(0,n.jsx)(i.td,{children:"\u274c Descartada"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.strong,{children:"Reintentos sin DLQ"})}),(0,n.jsx)(i.td,{children:"B\xe1sica"}),(0,n.jsx)(i.td,{children:"Muy limitada"}),(0,n.jsx)(i.td,{children:"Simple"}),(0,n.jsx)(i.td,{children:"Mala"}),(0,n.jsx)(i.td,{children:"\u274c Descartada"})]})]})]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"-an\xe1lisis-de-costos-tco-3-a\xf1os",children:"\ud83d\udcb0 AN\xc1LISIS DE COSTOS (TCO 3 a\xf1os)"}),"\n",(0,n.jsxs)(i.blockquote,{children:["\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Supuesto:"})," Uso de AWS SQS con DLQ, 5 colas principales, 4 pa\xedses, 1 mill\xf3n de mensajes/mes por cola. Costos estimados para almacenamiento, transferencias y monitoreo."]}),"\n"]}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Soluci\xf3n"}),(0,n.jsx)(i.th,{children:"Licenciamiento"}),(0,n.jsx)(i.th,{children:"Infraestructura"}),(0,n.jsx)(i.th,{children:"Operaci\xf3n"}),(0,n.jsx)(i.th,{children:"TCO 3 a\xf1os"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"AWS SQS + DLQ"}),(0,n.jsx)(i.td,{children:"Pago por uso"}),(0,n.jsx)(i.td,{children:"US$0"}),(0,n.jsx)(i.td,{children:"US$0"}),(0,n.jsx)(i.td,{children:"US$7,200"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"Azure Service Bus"}),(0,n.jsx)(i.td,{children:"Pago por uso"}),(0,n.jsx)(i.td,{children:"US$0"}),(0,n.jsx)(i.td,{children:"US$0"}),(0,n.jsx)(i.td,{children:"US$8,400"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"RabbitMQ"}),(0,n.jsx)(i.td,{children:"OSS"}),(0,n.jsx)(i.td,{children:"US$4,800"}),(0,n.jsx)(i.td,{children:"US$12,000"}),(0,n.jsx)(i.td,{children:"US$50,400"})]})]})]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"consideraciones-t\xe9cnicas-y-riesgos",children:"Consideraciones t\xe9cnicas y riesgos"}),"\n",(0,n.jsx)(i.h3,{id:"l\xedmites-clave",children:"L\xedmites clave"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"AWS SQS/Azure Service Bus:"})," l\xedmites por tama\xf1o de mensaje, retenci\xf3n y throughput"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"RabbitMQ:"})," depende de infraestructura propia, requiere operaci\xf3n"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"riesgos-y-mitigaci\xf3n",children:"Riesgos y mitigaci\xf3n"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Lock-in cloud:"})," mitigado con interfaces desacopladas"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Complejidad operativa RabbitMQ:"})," mitigada con automatizaci\xf3n y monitoreo"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"P\xe9rdida de mensajes:"})," mitigada con DLQ y alertas"]}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"\ufe0f-decisi\xf3n",children:"\u2714\ufe0f DECISI\xd3N"}),"\n",(0,n.jsxs)(i.p,{children:["Se selecciona un ",(0,n.jsx)(i.strong,{children:"enfoque h\xedbrido"}),": uso de ",(0,n.jsx)(i.code,{children:"Dead Letter Queues (DLQ)"})," en las colas de mensajer\xeda (AWS SQS, Azure Service Bus) complementado con ",(0,n.jsx)(i.code,{children:"Circuit Breaker"})," para m\xe1xima resiliencia y observabilidad."]}),"\n",(0,n.jsx)(i.h2,{id:"justificaci\xf3n",children:"Justificaci\xf3n"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Aislamiento y an\xe1lisis de mensajes fallidos"}),"\n",(0,n.jsx)(i.li,{children:"Recuperaci\xf3n y reprocesamiento flexible"}),"\n",(0,n.jsx)(i.li,{children:"Observabilidad y auditor\xeda completas"}),"\n",(0,n.jsx)(i.li,{children:"Integraci\xf3n nativa con ecosistema .NET y herramientas de monitoreo"}),"\n",(0,n.jsx)(i.li,{children:"Reducci\xf3n de riesgo de p\xe9rdida de informaci\xf3n"}),"\n",(0,n.jsx)(i.li,{children:"Cumplimiento de requisitos multi-tenant y multipa\xeds"}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"alternativas-descartadas",children:"Alternativas descartadas"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Reintentos sin DLQ:"})," alto riesgo de p\xe9rdida y baja trazabilidad"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Manual Retry:"})," operaci\xf3n manual y poca escalabilidad"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"RabbitMQ puro:"})," mayor complejidad operativa"]}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"\ufe0f-consecuencias",children:"\u26a0\ufe0f CONSECUENCIAS"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Todos los servicios deben implementar DLQ y monitoreo de errores en colas"}),"\n",(0,n.jsx)(i.li,{children:"Se deben definir pol\xedticas de reprocesamiento y alertas autom\xe1ticas"}),"\n",(0,n.jsx)(i.li,{children:"El c\xf3digo debe desacoplarse del broker mediante interfaces"}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h2,{id:"-referencias",children:"\ud83d\udcda REFERENCIAS"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html",children:"AWS SQS DLQ"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://learn.microsoft.com/es-es/azure/service-bus-messaging/service-bus-dead-letter-queues",children:"Azure Service Bus DLQ"})}),"\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.a,{href:"https://arc42.org/decision/",children:"arc42: Decisiones de arquitectura"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,d.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}}}]);