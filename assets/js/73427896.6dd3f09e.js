"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[7155],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var a=s(96540);const r={},i=a.createContext(r);function l(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),a.createElement(i.Provider,{value:n},e.children)}},95081:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"lineamientos/estandares-de-codigo/04-sql","title":"SQL","description":"Lineamientos de estilo, buenas pr\xe1cticas y seguridad para SQL, PostgreSQL y Oracle.","source":"@site/docs/lineamientos/estandares-de-codigo/04-sql.md","sourceDirName":"lineamientos/estandares-de-codigo","slug":"/lineamientos/estandares-de-codigo/04-sql","permalink":"/tlm-doc-architecture/docs/lineamientos/estandares-de-codigo/04-sql","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/lineamientos/estandares-de-codigo/04-sql.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"SQL","description":"Lineamientos de estilo, buenas pr\xe1cticas y seguridad para SQL, PostgreSQL y Oracle.","id":"04-sql","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"JavaScript","permalink":"/tlm-doc-architecture/docs/lineamientos/estandares-de-codigo/03-javascript"},"next":{"title":"Est\xe1ndares de Documentaci\xf3n","permalink":"/tlm-doc-architecture/docs/lineamientos/estandares-de-documentacion"}}');var r=s(74848),i=s(28453);const l={title:"SQL",description:"Lineamientos de estilo, buenas pr\xe1cticas y seguridad para SQL, PostgreSQL y Oracle.",id:"04-sql",sidebar_position:4},c=void 0,o={},d=[{value:"Introducci\xf3n",id:"introducci\xf3n",level:2},{value:"Objetivo",id:"objetivo",level:2},{value:"Alcance",id:"alcance",level:2},{value:"Principios clave para SQL",id:"principios-clave-para-sql",level:2},{value:"Ejemplos generales",id:"ejemplos-generales",level:3},{value:"Buenas pr\xe1cticas generales",id:"buenas-pr\xe1cticas-generales",level:2},{value:"Lineamientos para PostgreSQL",id:"lineamientos-para-postgresql",level:2},{value:"Lineamientos para Oracle",id:"lineamientos-para-oracle",level:2},{value:"Lineamiento clave: l\xf3gica de negocio en la aplicaci\xf3n",id:"lineamiento-clave-l\xf3gica-de-negocio-en-la-aplicaci\xf3n",level:2},{value:"Ejemplos de l\xf3gica en la aplicaci\xf3n (C# .NET 8)",id:"ejemplos-de-l\xf3gica-en-la-aplicaci\xf3n-c-net-8",level:3},{value:"1. Separaci\xf3n de l\xf3gica de negocio y acceso a datos",id:"1-separaci\xf3n-de-l\xf3gica-de-negocio-y-acceso-a-datos",level:4},{value:"2. Entity Framework con SQL raw para PostgreSQL",id:"2-entity-framework-con-sql-raw-para-postgresql",level:4},{value:"3. Entity Framework con SQL raw para Oracle",id:"3-entity-framework-con-sql-raw-para-oracle",level:4},{value:"Seguridad",id:"seguridad",level:2},{value:"Referencias",id:"referencias",level:2},{value:"\xdaltima revisi\xf3n",id:"\xfaltima-revisi\xf3n",level:2}];function t(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"introducci\xf3n",children:"Introducci\xf3n"}),"\n",(0,r.jsx)(n.p,{children:"Este documento define los lineamientos para escribir c\xf3digo SQL en Talma, incluyendo recomendaciones espec\xedficas para PostgreSQL y Oracle."}),"\n",(0,r.jsx)(n.h2,{id:"objetivo",children:"Objetivo"}),"\n",(0,r.jsx)(n.p,{children:"Promover consultas SQL legibles, eficientes y seguras, aplicando buenas pr\xe1cticas para cada motor. Fomentar que la l\xf3gica de negocio resida en las aplicaciones y que las bases de datos sean solo repositorios de datos."}),"\n",(0,r.jsx)(n.h2,{id:"alcance",children:"Alcance"}),"\n",(0,r.jsx)(n.p,{children:"Aplica a todos los desarrolladores que trabajen con SQL, PostgreSQL u Oracle en la organizaci\xf3n."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"principios-clave-para-sql",children:"Principios clave para SQL"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Nombres descriptivos y consistentes para tablas, columnas y objetos. Consulta la ",(0,r.jsx)(n.a,{href:"/tlm-doc-architecture/docs/lineamientos/convenciones-de-nombres/objetos-de-base-de-datos",children:"gu\xeda de convenciones de nombres"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Usa MAY\xdaSCULAS para palabras reservadas."}),"\n",(0,r.jsx)(n.li,{children:"Indenta consultas para mejorar la legibilidad."}),"\n",(0,r.jsx)(n.li,{children:"Evita SELECT * y usa solo las columnas necesarias."}),"\n",(0,r.jsx)(n.li,{children:"Documenta procedimientos, funciones y vistas."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ejemplos-generales",children:"Ejemplos generales"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Correcto"}),(0,r.jsx)(n.th,{children:"Incorrecto"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SELECT user_id, created_at FROM users;"}),(0,r.jsx)(n.td,{children:"select * from users;"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"UPDATE orders SET status = 'paid';"}),(0,r.jsx)(n.td,{children:"update Orders set Status='paid';"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"buenas-pr\xe1cticas-generales",children:"Buenas pr\xe1cticas generales"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Usa transacciones para operaciones cr\xedticas."}),"\n",(0,r.jsx)(n.li,{children:"Indexa columnas usadas en b\xfasquedas frecuentes."}),"\n",(0,r.jsx)(n.li,{children:"Prefiere consultas simples y evita subconsultas innecesarias."}),"\n",(0,r.jsx)(n.li,{children:"Usa par\xe1metros en consultas para evitar SQL Injection."}),"\n",(0,r.jsx)(n.li,{children:"Valida y normaliza datos antes de insertarlos."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"lineamientos-para-postgresql",children:"Lineamientos para PostgreSQL"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Nombres descriptivos y consistentes para tablas, columnas y objetos. Consulta la ",(0,r.jsx)(n.a,{href:"/tlm-doc-architecture/docs/lineamientos/convenciones-de-nombres/objetos-de-base-de-datos",children:"gu\xeda de convenciones de nombres"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Usa tipos de datos nativos de Postgres (ej: ",(0,r.jsx)(n.code,{children:"SERIAL"}),", ",(0,r.jsx)(n.code,{children:"UUID"}),", ",(0,r.jsx)(n.code,{children:"JSONB"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Prefiere ",(0,r.jsx)(n.code,{children:"RETURNING"})," para obtener valores tras un ",(0,r.jsx)(n.code,{children:"INSERT"})," o ",(0,r.jsx)(n.code,{children:"UPDATE"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Aprovecha funciones y operadores avanzados (",(0,r.jsx)(n.code,{children:"ARRAY"}),", ",(0,r.jsx)(n.code,{children:"COALESCE"}),", ",(0,r.jsx)(n.code,{children:"ILIKE"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Usa ",(0,r.jsx)(n.code,{children:"EXPLAIN ANALYZE"})," para optimizar consultas complejas."]}),"\n",(0,r.jsx)(n.li,{children:"Evita funciones y extensiones no est\xe1ndar si se busca portabilidad."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ejemplo de uso de RETURNING:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO users (name, email) VALUES ('Ana', 'ana@mail.com') RETURNING user_id;\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"lineamientos-para-oracle",children:"Lineamientos para Oracle"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Usa secuencias (",(0,r.jsx)(n.code,{children:"SEQUENCE"}),") para claves primarias autoincrementales."]}),"\n",(0,r.jsxs)(n.li,{children:["Prefiere ",(0,r.jsx)(n.code,{children:"NVL"})," para manejo de valores nulos."]}),"\n",(0,r.jsxs)(n.li,{children:["Usa ",(0,r.jsx)(n.code,{children:"MERGE"})," para operaciones upsert."]}),"\n",(0,r.jsxs)(n.li,{children:["Aprovecha ",(0,r.jsx)(n.code,{children:"PL/SQL"})," para l\xf3gica compleja y procedimientos almacenados."]}),"\n",(0,r.jsxs)(n.li,{children:["Usa ",(0,r.jsx)(n.code,{children:"EXPLAIN PLAN"})," para analizar el rendimiento de las consultas."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ejemplo de uso de SEQUENCE:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO users (user_id, name) VALUES (user_seq.NEXTVAL, 'Ana');\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"danger",children:(0,r.jsx)(n.p,{children:"Evita el uso de DBLINKS en Oracle. Su uso est\xe1 prohibido por razones de seguridad y mantenibilidad."})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"lineamiento-clave-l\xf3gica-de-negocio-en-la-aplicaci\xf3n",children:"Lineamiento clave: l\xf3gica de negocio en la aplicaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"La l\xf3gica de negocio debe implementarse en la aplicaci\xf3n, no en la base de datos."}),"\n",(0,r.jsx)(n.li,{children:"Evita procedimientos almacenados, triggers y l\xf3gica compleja en la base de datos, salvo casos justificados y documentados."}),"\n",(0,r.jsx)(n.li,{children:"Mantener los queries embebidos en la aplicaci\xf3n permite versionarlos junto al c\xf3digo, facilitando trazabilidad, revisiones y despliegues controlados."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"ejemplos-de-l\xf3gica-en-la-aplicaci\xf3n-c-net-8",children:"Ejemplos de l\xf3gica en la aplicaci\xf3n (C# .NET 8)"}),"\n",(0,r.jsx)(n.h4,{id:"1-separaci\xf3n-de-l\xf3gica-de-negocio-y-acceso-a-datos",children:"1. Separaci\xf3n de l\xf3gica de negocio y acceso a datos"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Servicio de dominio (l\xf3gica de negocio):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class OrderService\n{\n    private readonly IOrderRepository _orderRepository;\n    public OrderService(IOrderRepository orderRepository)\n    {\n        _orderRepository = orderRepository;\n    }\n\n    public async Task<bool> PagarPedidoAsync(int orderId)\n    {\n        var order = await _orderRepository.GetByIdAsync(orderId);\n        if (order == null || order.Status == "paid")\n            return false;\n        order.Status = "paid";\n        await _orderRepository.UpdateAsync(order);\n        return true;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Acceso a datos (repository):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public class OrderRepository : IOrderRepository\n{\n    private readonly DbContext _dbContext;\n    public OrderRepository(DbContext dbContext)\n    {\n        _dbContext = dbContext;\n    }\n\n    public async Task<Order?> GetByIdAsync(int orderId)\n    {\n        return await _dbContext.Orders.FindAsync(orderId);\n    }\n\n    public async Task UpdateAsync(Order order)\n    {\n        _dbContext.Orders.Update(order);\n        await _dbContext.SaveChangesAsync();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"2-entity-framework-con-sql-raw-para-postgresql",children:"2. Entity Framework con SQL raw para PostgreSQL"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'// Usando interpolaci\xf3n segura con FromSqlInterpolated (Npgsql)\nvar users = await dbContext.Users\n    .FromSqlInterpolated($@"SELECT user_id, name, email FROM users WHERE is_active = {true}")\n    .ToListAsync();\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Los par\xe1metros se pasan con interpolaci\xf3n segura (",(0,r.jsx)(n.code,{children:'$@"...{param}"'}),")."]}),"\n",(0,r.jsx)(n.li,{children:"Nombres de columnas y tablas en min\xfasculas y snake_case."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"3-entity-framework-con-sql-raw-para-oracle",children:"3. Entity Framework con SQL raw para Oracle"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'// Usando par\xe1metros con nombre y OracleParameter\nvar statusParam = new OracleParameter("status", "PENDING");\nvar orders = await dbContext.Orders\n    .FromSqlRaw("SELECT ORDER_ID, STATUS FROM ORDERS WHERE STATUS = :status", statusParam)\n    .ToListAsync();\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Los par\xe1metros se definen expl\xedcitamente con ",(0,r.jsx)(n.code,{children:"OracleParameter"})," y se referencian con ",(0,r.jsx)(n.code,{children:":nombre"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Nombres de columnas y tablas en may\xfasculas."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"seguridad",children:"Seguridad"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Usa siempre par\xe1metros en consultas para evitar SQL Injection."}),"\n",(0,r.jsx)(n.li,{children:"Limita privilegios de usuarios y roles en la base de datos."}),"\n",(0,r.jsx)(n.li,{children:"No expongas informaci\xf3n sensible en mensajes de error."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"referencias",children:"Referencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.sqlstyle.guide/es/",children:"Gu\xeda de estilo SQL"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/",children:"Documentaci\xf3n oficial de PostgreSQL"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.oracle.com/en/database/",children:"Documentaci\xf3n oficial de Oracle"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.microsoft.com/es-es/sql/",children:"Documentaci\xf3n oficial de SQL Server"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\xfaltima-revisi\xf3n",children:"\xdaltima revisi\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Fecha: 2025-08-08"}),"\n",(0,r.jsx)(n.li,{children:"Responsable: Equipo de Arquitectura"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}}}]);