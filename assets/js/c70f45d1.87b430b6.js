"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[9383],{28102:(e,i,r)=>{r.r(i),r.d(i,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"servicios-corporativos/servicio-identidad/vista-tiempo-ejecucion","title":"6. Vista de tiempo de ejecuci\xf3n","description":"6.1 Escenarios principales","source":"@site/docs/servicios-corporativos/servicio-identidad/06-vista-tiempo-ejecucion.md","sourceDirName":"servicios-corporativos/servicio-identidad","slug":"/servicios-corporativos/servicio-identidad/vista-tiempo-ejecucion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-identidad/vista-tiempo-ejecucion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-identidad/06-vista-tiempo-ejecucion.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"5. Vista de bloques de construcci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-identidad/vista-bloques-construccion"},"next":{"title":"7. Vista de implementaci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-identidad/vista-implementacion"}}');var c=r(74848),s=r(28453);const t={},d="6. Vista de tiempo de ejecuci\xf3n",a={},o=[{value:"6.1 Escenarios principales",id:"61-escenarios-principales",level:2},{value:"6.2 Patrones de interacci\xf3n",id:"62-patrones-de-interacci\xf3n",level:2},{value:"6.3 Escenario: autenticaci\xf3n de usuario con MFA",id:"63-escenario-autenticaci\xf3n-de-usuario-con-mfa",level:2},{value:"Participantes",id:"participantes",level:3},{value:"Flujo de ejecuci\xf3n",id:"flujo-de-ejecuci\xf3n",level:3},{value:"M\xe9tricas de performance",id:"m\xe9tricas-de-performance",level:3},{value:"Manejo de errores y resiliencia",id:"manejo-de-errores-y-resiliencia",level:3},{value:"6.4 Escenario: federaci\xf3n con IdP SAML",id:"64-escenario-federaci\xf3n-con-idp-saml",level:2},{value:"Participantes",id:"participantes-1",level:3},{value:"Flujo de ejecuci\xf3n",id:"flujo-de-ejecuci\xf3n-1",level:3},{value:"6.5 M\xe9tricas y monitoreo de escenarios",id:"65-m\xe9tricas-y-monitoreo-de-escenarios",level:2},{value:"6.6 Referencias",id:"66-referencias",level:2}];function l(e){const i={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.header,{children:(0,c.jsx)(i.h1,{id:"6-vista-de-tiempo-de-ejecuci\xf3n",children:"6. Vista de tiempo de ejecuci\xf3n"})}),"\n",(0,c.jsx)(i.h2,{id:"61-escenarios-principales",children:"6.1 Escenarios principales"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Escenario"}),(0,c.jsx)(i.th,{children:"Flujo"}),(0,c.jsx)(i.th,{children:"Componentes"})]})}),(0,c.jsxs)(i.tbody,{children:[(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Autenticaci\xf3n"}),(0,c.jsxs)(i.td,{children:["Usuario \u2192 ",(0,c.jsx)(i.code,{children:"Keycloak"})," \u2192 ",(0,c.jsx)(i.code,{children:"JWT"})]}),(0,c.jsx)(i.td,{children:"Keycloak Core"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Validaci\xf3n Token"}),(0,c.jsxs)(i.td,{children:["Servicio \u2192 ",(0,c.jsx)(i.code,{children:"Keycloak"})," \u2192 Validaci\xf3n"]}),(0,c.jsx)(i.td,{children:"JWT Validation"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Federaci\xf3n"}),(0,c.jsxs)(i.td,{children:["IdP externo \u2192 ",(0,c.jsx)(i.code,{children:"Keycloak"})," \u2192 Usuario"]}),(0,c.jsx)(i.td,{children:"Federation Connectors"})]})]})]}),"\n",(0,c.jsx)(i.h2,{id:"62-patrones-de-interacci\xf3n",children:"6.2 Patrones de interacci\xf3n"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Patr\xf3n"}),(0,c.jsx)(i.th,{children:"Descripci\xf3n"}),(0,c.jsx)(i.th,{children:"Tecnolog\xeda"})]})}),(0,c.jsxs)(i.tbody,{children:[(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"OAuth2/OIDC"}),(0,c.jsx)(i.td,{children:"Flujo de autenticaci\xf3n"}),(0,c.jsx)(i.td,{children:"Est\xe1ndar"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"JWT"}),(0,c.jsx)(i.td,{children:"Tokens de acceso"}),(0,c.jsx)(i.td,{children:"RS256"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"SAML"}),(0,c.jsx)(i.td,{children:"Federaci\xf3n legacy"}),(0,c.jsx)(i.td,{children:"SAML 2.0"})]})]})]}),"\n",(0,c.jsx)(i.h2,{id:"63-escenario-autenticaci\xf3n-de-usuario-con-mfa",children:"6.3 Escenario: autenticaci\xf3n de usuario con MFA"}),"\n",(0,c.jsx)(i.h3,{id:"participantes",children:"Participantes"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"User Browser"}),"\n",(0,c.jsxs)(i.li,{children:["API Gateway (",(0,c.jsx)(i.code,{children:"YARP"}),")"]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"Keycloak"})," (",(0,c.jsx)(i.code,{children:"tenant"}),"/",(0,c.jsx)(i.code,{children:"realm"}),")"]}),"\n",(0,c.jsx)(i.li,{children:"Identity Management API"}),"\n",(0,c.jsx)(i.li,{children:"Token Validation Service"}),"\n",(0,c.jsx)(i.li,{children:"Audit Service"}),"\n",(0,c.jsx)(i.li,{children:"Notification Service"}),"\n"]}),"\n",(0,c.jsx)(i.h3,{id:"flujo-de-ejecuci\xf3n",children:"Flujo de ejecuci\xf3n"}),"\n",(0,c.jsx)(i.mermaid,{value:"sequenceDiagram\n    participant User as Usuario\n    participant Browser as Browser\n    participant Gateway as API Gateway\n    participant KC as Keycloak\n    participant IdAPI as Identity API\n    participant TokenSvc as Token Service\n    participant AuditSvc as Audit Service\n    participant NotifSvc as Notification\n    User->>Browser: Accede a aplicaci\xf3n\n    Browser->>Gateway: GET /app/dashboard\n    Gateway->>Gateway: Verificar Authorization header\n    Gateway->>Browser: HTTP 401 + WWW-Authenticate\n    Browser->>KC: GET /auth/realms/tenant/protocol/openid-connect/auth\n    KC->>KC: Verificar sesi\xf3n\n    KC->>Browser: Render login form\n    Browser->>User: Mostrar login\n    User->>Browser: Ingresa credenciales\n    Browser->>KC: POST /auth/realms/tenant/login-actions/authenticate\n    KC->>KC: Validar credenciales\n    KC->>AuditSvc: LOG: LOGIN_ATTEMPT\n    KC->>Browser: Render MFA challenge\n    Browser->>User: Solicitar c\xf3digo TOTP\n    User->>Browser: Ingresa c\xf3digo\n    Browser->>KC: POST /auth/realms/tenant/login-actions/required-action\n    KC->>KC: Validar TOTP\n    KC->>AuditSvc: LOG: MFA_SUCCESS\n    KC->>IdAPI: GET /api/v1/users/{userId}/profile\n    IdAPI->>KC: Enhanced user profile\n    KC->>KC: Crear sesi\xf3n + generar tokens JWT\n    KC->>AuditSvc: LOG: LOGIN_SUCCESS\n    KC->>Browser: HTTP 302 redirect + authorization_code\n    Browser->>KC: POST /auth/realms/tenant/protocol/openid-connect/token\n    KC->>Browser: JWT tokens\n    Browser->>Gateway: GET /app/dashboard + Bearer token\n    Gateway->>TokenSvc: gRPC ValidateToken(jwt)\n    TokenSvc->>TokenSvc: Verificar firma + claims\n    TokenSvc->>Gateway: Token v\xe1lido\n    Gateway->>Gateway: Aplicar pol\xedticas\n    Gateway->>Browser: HTTP 200 + dashboard\n    Browser->>User: Mostrar aplicaci\xf3n\n    alt Login desde nueva ubicaci\xf3n/dispositivo\n        KC->>NotifSvc: Send security alert\n        NotifSvc->>User: Email de alerta\n    end"}),"\n",(0,c.jsx)(i.h3,{id:"m\xe9tricas-de-performance",children:"M\xe9tricas de performance"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Fase"}),(0,c.jsx)(i.th,{children:"Target"}),(0,c.jsx)(i.th,{children:"Medici\xf3n"}),(0,c.jsx)(i.th,{children:"Monitoreo"})]})}),(0,c.jsxs)(i.tbody,{children:[(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Redirecci\xf3n inicial"}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"< 50ms"})}),(0,c.jsx)(i.td,{children:"Gateway latency"}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"Prometheus"})})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Render login form"}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"< 200ms"})}),(0,c.jsx)(i.td,{children:"Keycloak response"}),(0,c.jsx)(i.td,{children:"Application metrics"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Validaci\xf3n credenciales"}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"< 300ms"})}),(0,c.jsx)(i.td,{children:"LDAP/DB query"}),(0,c.jsx)(i.td,{children:"Custom metrics"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Validaci\xf3n MFA"}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"< 100ms"})}),(0,c.jsx)(i.td,{children:"TOTP algorithm"}),(0,c.jsx)(i.td,{children:"Auth metrics"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Token generation"}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"< 200ms"})}),(0,c.jsx)(i.td,{children:"JWT creation"}),(0,c.jsx)(i.td,{children:"Session metrics"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Token validation"}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"< 10ms"})}),(0,c.jsx)(i.td,{children:"gRPC/cache"}),(0,c.jsx)(i.td,{children:"Token metrics"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Flujo completo"}),(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"< 2s"})}),(0,c.jsx)(i.td,{children:"End-to-end"}),(0,c.jsx)(i.td,{children:"Synthetic monitoring"})]})]})]}),"\n",(0,c.jsx)(i.h3,{id:"manejo-de-errores-y-resiliencia",children:"Manejo de errores y resiliencia"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Escenario Error"}),(0,c.jsx)(i.th,{children:"Respuesta"}),(0,c.jsx)(i.th,{children:"Acci\xf3n De Recuperaci\xf3n"})]})}),(0,c.jsxs)(i.tbody,{children:[(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"LDAP Unavailable"}),(0,c.jsx)(i.td,{children:"HTTP 503"}),(0,c.jsx)(i.td,{children:"Fallback a usuarios locales"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"MFA Failure (3x)"}),(0,c.jsx)(i.td,{children:"Lockout"}),(0,c.jsx)(i.td,{children:"Email de desbloqueo + notificaci\xf3n"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Token Service Down"}),(0,c.jsx)(i.td,{children:"HTTP 503"}),(0,c.jsx)(i.td,{children:"Circuit breaker + validaci\xf3n local"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Audit Service Down"}),(0,c.jsx)(i.td,{children:"Continuar"}),(0,c.jsx)(i.td,{children:"Store local + replay posterior"})]})]})]}),"\n",(0,c.jsx)(i.h2,{id:"64-escenario-federaci\xf3n-con-idp-saml",children:"6.4 Escenario: federaci\xf3n con IdP SAML"}),"\n",(0,c.jsx)(i.h3,{id:"participantes-1",children:"Participantes"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Usuario Corporativo"}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"Keycloak"})," (SP)"]}),"\n",(0,c.jsx)(i.li,{children:"IdP Externo (IdP)"}),"\n",(0,c.jsx)(i.li,{children:"Procesador SAML"}),"\n",(0,c.jsx)(i.li,{children:"Servicio de Auditor\xeda"}),"\n"]}),"\n",(0,c.jsx)(i.h3,{id:"flujo-de-ejecuci\xf3n-1",children:"Flujo de ejecuci\xf3n"}),"\n",(0,c.jsx)(i.mermaid,{value:'sequenceDiagram\n    participant User as Usuario\n    participant Browser as Browser\n    participant KC as Keycloak (SP)\n    participant IdP as IdP Externo (IdP)\n    participant SAMLProc as Procesador SAML\n    participant AuditSvc as Servicio de Auditor\xeda\n    User->>Browser: Click "Login with IdP"\n    Browser->>KC: GET /auth/realms/tenant/broker/idp-saml/login\n    KC->>KC: Generar SAML AuthnRequest\n    KC->>Browser: Redirect a IdP SAML\n    Browser->>IdP: POST SAML AuthnRequest\n    IdP->>IdP: Validar dominio/usuario\n    IdP->>User: Autenticaci\xf3n (seg\xfan IdP)\n    User->>IdP: Autorizar acceso\n    IdP->>IdP: Generar SAML Response\n    IdP->>Browser: SAML Response\n    Browser->>KC: POST SAML Response\n    KC->>SAMLProc: Procesar assertion\n    SAMLProc->>KC: Validar assertion\n    KC->>KC: Mapear usuario, crear sesi\xf3n\n    KC->>AuditSvc: LOG: FEDERATED_LOGIN\n    KC->>Browser: HTTP 302 redirect + authorization_code\n    Browser->>KC: POST /auth/realms/tenant/protocol/openid-connect/token\n    KC->>Browser: JWT tokens\n    Browser->>User: Acceso a aplicaci\xf3n'}),"\n",(0,c.jsxs)(i.blockquote,{children:["\n",(0,c.jsxs)(i.p,{children:["Este escenario describe la federaci\xf3n SAML entre un IdP externo corporativo y ",(0,c.jsx)(i.code,{children:"Keycloak"})," en arquitectura multi-tenant. El flujo refleja la integraci\xf3n real, trazabilidad y auditor\xeda, sin pasos ni componentes ajenos."]}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"65-m\xe9tricas-y-monitoreo-de-escenarios",children:"6.5 M\xe9tricas y monitoreo de escenarios"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:["Todas las fases instrumentadas con ",(0,c.jsx)(i.code,{children:"Prometheus"}),", ",(0,c.jsx)(i.code,{children:"Grafana"})," y logs estructurados."]}),"\n",(0,c.jsxs)(i.li,{children:["Trazas distribuidas para flujos cr\xedticos (",(0,c.jsx)(i.code,{children:"OpenTelemetry"}),", ",(0,c.jsx)(i.code,{children:"Jaeger"}),")."]}),"\n",(0,c.jsx)(i.li,{children:"Alertas autom\xe1ticas ante degradaci\xf3n de performance o fallos de integraci\xf3n."}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"66-referencias",children:"6.6 Referencias"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://www.keycloak.org/docs/latest/server_admin/",children:"Keycloak Server Administration Guide"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://tools.ietf.org/html/rfc6749",children:"OAuth 2.0 RFC 6749"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect Core 1.0"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://docs.arc42.org/section-6/",children:"Arc42 Runtime View"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://c4model.com/",children:"C4 Model for Software Architecture"})}),"\n"]}),"\n",(0,c.jsx)(i.hr,{})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,c.jsx)(i,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},28453:(e,i,r)=>{r.d(i,{R:()=>t,x:()=>d});var n=r(96540);const c={},s=n.createContext(c);function t(e){const i=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),n.createElement(s.Provider,{value:i},e.children)}}}]);