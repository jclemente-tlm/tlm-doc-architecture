"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[4503],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>d});var s=i(96540);const a={},t=s.createContext(a);function r(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(t.Provider,{value:n},e.children)}},86708:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"lineamientos/desarrollo-de-apis/seguridad","title":"Seguridad de APIs","description":"Esta gu\xeda establece los est\xe1ndares de seguridad esenciales para APIs REST, cubriendo autenticaci\xf3n, autorizaci\xf3n, comunicaci\xf3n segura y protecci\xf3n de datos.","source":"@site/docs/lineamientos/desarrollo-de-apis/02-seguridad.md","sourceDirName":"lineamientos/desarrollo-de-apis","slug":"/lineamientos/desarrollo-de-apis/seguridad","permalink":"/tlm-doc-architecture/docs/lineamientos/desarrollo-de-apis/seguridad","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/lineamientos/desarrollo-de-apis/02-seguridad.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Seguridad de APIs","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Dise\xf1o y arquitectura de APIs","permalink":"/tlm-doc-architecture/docs/lineamientos/desarrollo-de-apis/diseno-y-arquitectura"},"next":{"title":"Validaci\xf3n y manejo de errores","permalink":"/tlm-doc-architecture/docs/lineamientos/desarrollo-de-apis/validacion-y-errores"}}');var a=i(74848),t=i(28453);const r={title:"Seguridad de APIs",sidebar_position:2},d=void 0,c={},l=[{value:"\ud83d\udd10 Autenticaci\xf3n",id:"-autenticaci\xf3n",level:2},{value:"JWT (JSON Web Tokens)",id:"jwt-json-web-tokens",level:3},{value:"OAuth 2.0 / OpenID Connect",id:"oauth-20--openid-connect",level:3},{value:"API Keys",id:"api-keys",level:3},{value:"\ud83d\udee1\ufe0f Autorizaci\xf3n",id:"\ufe0f-autorizaci\xf3n",level:2},{value:"Pol\xedticas basadas en roles",id:"pol\xedticas-basadas-en-roles",level:3},{value:"\ud83d\udd12 Comunicaci\xf3n segura",id:"-comunicaci\xf3n-segura",level:2},{value:"TLS/HTTPS",id:"tlshttps",level:3},{value:"CORS",id:"cors",level:3},{value:"\ud83d\udd27 Protecci\xf3n de datos",id:"-protecci\xf3n-de-datos",level:2},{value:"Validaci\xf3n de entrada",id:"validaci\xf3n-de-entrada",level:3},{value:"Rate Limiting",id:"rate-limiting",level:3},{value:"\u2699\ufe0f Configuraci\xf3n recomendada",id:"\ufe0f-configuraci\xf3n-recomendada",level:2},{value:"appsettings.json",id:"appsettingsjson",level:3},{value:"Variables de entorno",id:"variables-de-entorno",level:3},{value:"\ud83d\udea8 Respuestas de seguridad",id:"-respuestas-de-seguridad",level:2},{value:"Autenticaci\xf3n fallida",id:"autenticaci\xf3n-fallida",level:3},{value:"Acceso no autorizado",id:"acceso-no-autorizado",level:3},{value:"\u2705 Checklist de seguridad",id:"-checklist-de-seguridad",level:2},{value:"B\xe1sico",id:"b\xe1sico",level:3},{value:"Autenticaci\xf3n",id:"autenticaci\xf3n",level:3},{value:"Autorizaci\xf3n",id:"autorizaci\xf3n",level:3},{value:"Monitoreo",id:"monitoreo",level:3},{value:"\ud83d\udcd6 Referencias",id:"-referencias",level:2},{value:"ADRs relacionados",id:"adrs-relacionados",level:3},{value:"Est\xe1ndares de la industria",id:"est\xe1ndares-de-la-industria",level:3}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Esta gu\xeda establece los est\xe1ndares de seguridad esenciales para APIs REST, cubriendo autenticaci\xf3n, autorizaci\xf3n, comunicaci\xf3n segura y protecci\xf3n de datos."}),"\n",(0,a.jsx)(n.h2,{id:"-autenticaci\xf3n",children:"\ud83d\udd10 Autenticaci\xf3n"}),"\n",(0,a.jsx)(n.h3,{id:"jwt-json-web-tokens",children:"JWT (JSON Web Tokens)"}),"\n",(0,a.jsx)(n.p,{children:"Est\xe1ndar principal para autenticaci\xf3n stateless en APIs REST."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)\n    .AddJwtBearer(options =>\n    {\n        options.TokenValidationParameters = new TokenValidationParameters\n        {\n            ValidateIssuer = true,\n            ValidateAudience = true,\n            ValidateLifetime = true,\n            ValidateIssuerSigningKey = true,\n            ValidIssuer = builder.Configuration["Jwt:Issuer"],\n            ValidAudience = builder.Configuration["Jwt:Audience"],\n            IssuerSigningKey = new SymmetricSecurityKey(\n                Encoding.UTF8.GetBytes(builder.Configuration["Jwt:Key"])),\n            ClockSkew = TimeSpan.FromMinutes(5)\n        };\n    });\n'})}),"\n",(0,a.jsx)(n.h3,{id:"oauth-20--openid-connect",children:"OAuth 2.0 / OpenID Connect"}),"\n",(0,a.jsx)(n.p,{children:"Para integraci\xf3n con proveedores de identidad externos y SSO corporativo."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'// Azure AD\nbuilder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)\n    .AddMicrosoftIdentityWebApi(builder.Configuration.GetSection("AzureAd"));\n'})}),"\n",(0,a.jsx)(n.h3,{id:"api-keys",children:"API Keys"}),"\n",(0,a.jsx)(n.p,{children:"Para servicios a servicios y integraciones espec\xedficas."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method)]\npublic class ApiKeyAttribute : Attribute, IAsyncActionFilter\n{\n    private const string API_KEY_HEADER = "X-API-Key";\n\n    public async Task OnActionExecutionAsync(ActionExecutingContext context, ActionExecutionDelegate next)\n    {\n        if (!context.HttpContext.Request.Headers.TryGetValue(API_KEY_HEADER, out var extractedApiKey))\n        {\n            context.Result = new UnauthorizedObjectResult("API Key requerida");\n            return;\n        }\n\n        var configuration = context.HttpContext.RequestServices.GetRequiredService<IConfiguration>();\n        var validApiKey = configuration.GetValue<string>("ApiKeys:Service");\n\n        if (!validApiKey.Equals(extractedApiKey))\n        {\n            context.Result = new UnauthorizedObjectResult("API Key inv\xe1lida");\n            return;\n        }\n\n        await next();\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-autorizaci\xf3n",children:"\ud83d\udee1\ufe0f Autorizaci\xf3n"}),"\n",(0,a.jsx)(n.h3,{id:"pol\xedticas-basadas-en-roles",children:"Pol\xedticas basadas en roles"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'builder.Services.AddAuthorization(options =>\n{\n    options.AddPolicy("AdminOnly", policy =>\n        policy.RequireRole("Admin"));\n\n    options.AddPolicy("ManagerOrAdmin", policy =>\n        policy.RequireRole("Manager", "Admin"));\n\n    options.AddPolicy("CountryAccess", policy =>\n        policy.RequireClaim("country"));\n});\n'})}),"\n",(0,a.jsx)(n.h2,{id:"-comunicaci\xf3n-segura",children:"\ud83d\udd12 Comunicaci\xf3n segura"}),"\n",(0,a.jsx)(n.h3,{id:"tlshttps",children:"TLS/HTTPS"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Requisitos obligatorios:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"TLS 1.2 m\xednimo, TLS 1.3 recomendado"}),"\n",(0,a.jsx)(n.li,{children:"Certificados v\xe1lidos y actualizados"}),"\n",(0,a.jsx)(n.li,{children:"HTTPS redirect autom\xe1tico"}),"\n",(0,a.jsx)(n.li,{children:"HSTS habilitado"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'if (!app.Environment.IsDevelopment())\n{\n    app.UseHttpsRedirection();\n    app.UseHsts();\n}\n\n// Headers de seguridad\napp.Use(async (context, next) =>\n{\n    context.Response.Headers.Add("X-Content-Type-Options", "nosniff");\n    context.Response.Headers.Add("X-Frame-Options", "DENY");\n    context.Response.Headers.Add("Strict-Transport-Security",\n        "max-age=31536000; includeSubDomains");\n\n    await next();\n});\n'})}),"\n",(0,a.jsx)(n.h3,{id:"cors",children:"CORS"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'builder.Services.AddCors(options =>\n{\n    options.AddPolicy("TalmaPolicy", policy =>\n    {\n        policy.WithOrigins("https://app.talma.pe", "https://admin.talma.pe")\n              .AllowAnyMethod()\n              .AllowAnyHeader()\n              .AllowCredentials();\n    });\n});\n'})}),"\n",(0,a.jsx)(n.h2,{id:"-protecci\xf3n-de-datos",children:"\ud83d\udd27 Protecci\xf3n de datos"}),"\n",(0,a.jsx)(n.h3,{id:"validaci\xf3n-de-entrada",children:"Validaci\xf3n de entrada"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'public class SecureUserRequest\n{\n    [Required]\n    [StringLength(100, MinimumLength = 2)]\n    [RegularExpression(@"^[a-zA-Z0-9\\s._-]+$")]\n    public string Name { get; set; }\n\n    [Required]\n    [EmailAddress]\n    public string Email { get; set; }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'builder.Services.AddMemoryCache();\nbuilder.Services.Configure<IpRateLimitOptions>(\n    builder.Configuration.GetSection("IpRateLimit"));\nbuilder.Services.AddSingleton<IIpPolicyStore, MemoryCacheIpPolicyStore>();\nbuilder.Services.AddSingleton<IRateLimitCounterStore, MemoryCacheRateLimitCounterStore>();\n\napp.UseIpRateLimiting();\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-configuraci\xf3n-recomendada",children:"\u2699\ufe0f Configuraci\xf3n recomendada"}),"\n",(0,a.jsx)(n.h3,{id:"appsettingsjson",children:"appsettings.json"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "Jwt": {\n    "Issuer": "https://api.talma.pe",\n    "Audience": "https://app.talma.pe",\n    "Key": "your-256-bit-secret-key-here",\n    "ExpiryInHours": 24\n  },\n  "ApiKeys": {\n    "Service": "your-service-api-key-here"\n  },\n  "IpRateLimit": {\n    "EnableEndpointRateLimiting": true,\n    "GeneralRules": [\n      {\n        "Endpoint": "*",\n        "Period": "1m",\n        "Limit": 60\n      }\n    ]\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"variables-de-entorno",children:"Variables de entorno"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Nunca hardcodear secrets en c\xf3digo\nJWT_KEY=your-production-jwt-key-256-bits-long\nAPI_SERVICE_KEY=your-production-api-key\nAZURE_CLIENT_SECRET=your-azure-app-secret\n"})}),"\n",(0,a.jsx)(n.h2,{id:"-respuestas-de-seguridad",children:"\ud83d\udea8 Respuestas de seguridad"}),"\n",(0,a.jsx)(n.h3,{id:"autenticaci\xf3n-fallida",children:"Autenticaci\xf3n fallida"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "status": "error",\n  "error": {\n    "code": "AUTHENTICATION_FAILED",\n    "message": "Token inv\xe1lido o expirado",\n    "details": []\n  },\n  "meta": {\n    "timestamp": "2025-09-22T10:30:00Z"\n  },\n  "trace_id": "sec_abc123-def456-789012"\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"acceso-no-autorizado",children:"Acceso no autorizado"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "status": "error",\n  "error": {\n    "code": "INSUFFICIENT_PERMISSIONS",\n    "message": "No tienes permisos para acceder a este recurso",\n    "details": []\n  },\n  "meta": {\n    "timestamp": "2025-09-22T10:30:00Z"\n  },\n  "trace_id": "sec_def456-ghi789-012345"\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"-checklist-de-seguridad",children:"\u2705 Checklist de seguridad"}),"\n",(0,a.jsx)(n.h3,{id:"b\xe1sico",children:"B\xe1sico"}),"\n",(0,a.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","HTTPS habilitado en todos los entornos"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Headers de seguridad configurados"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Validaci\xf3n de entrada implementada"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Rate limiting activo"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"autenticaci\xf3n",children:"Autenticaci\xf3n"}),"\n",(0,a.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","JWT configurado correctamente"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tokens con expiraci\xf3n apropiada"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","API Keys para servicios"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"autorizaci\xf3n",children:"Autorizaci\xf3n"}),"\n",(0,a.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Pol\xedticas de autorizaci\xf3n definidas"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Control de acceso por recursos"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Validaci\xf3n de permisos en endpoints"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"monitoreo",children:"Monitoreo"}),"\n",(0,a.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Logging de eventos de seguridad"]}),"\n",(0,a.jsxs)(n.li,{className:"task-list-item",children:[(0,a.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Alertas para intentos no autorizados"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-referencias",children:"\ud83d\udcd6 Referencias"}),"\n",(0,a.jsx)(n.h3,{id:"adrs-relacionados",children:"ADRs relacionados"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/adrs/adr-004-autenticacion-sso",children:"ADR-004: Autenticaci\xf3n SSO"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/adrs/adr-003-gestion-secretos",children:"ADR-003: Gesti\xf3n de secretos"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/adrs/adr-008-gateway-apis",children:"ADR-008: Gateway de APIs"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/adrs/adr-016-logging-estructurado",children:"ADR-016: Logging estructurado"})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"est\xe1ndares-de-la-industria",children:"Est\xe1ndares de la industria"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://tools.ietf.org/html/rfc6749",children:"OAuth 2.0 RFC 6749"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://tools.ietf.org/html/rfc7519",children:"JWT RFC 7519"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://owasp.org/www-project-api-security/",children:"OWASP API Security Top 10"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/active-directory/develop/",children:"Microsoft Identity Platform"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}}}]);