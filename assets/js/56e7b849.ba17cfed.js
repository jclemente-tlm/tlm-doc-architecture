"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[5145],{14447:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"adrs/adr-013-event-sourcing","title":"Event Sourcing","description":"\u2705 ESTADO","source":"@site/docs/adrs/adr-013-event-sourcing.md","sourceDirName":"adrs","slug":"/adrs/adr-013-event-sourcing","permalink":"/tlm-doc-architecture/docs/adrs/adr-013-event-sourcing","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/adrs/adr-013-event-sourcing.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"title":"Event Sourcing","sidebar_position":13},"sidebar":"tutorialSidebar","previous":{"title":"Mensajer\xeda As\xedncrona","permalink":"/tlm-doc-architecture/docs/adrs/adr-012-mensajeria-asincrona"},"next":{"title":"Almacenamiento de Objetos","permalink":"/tlm-doc-architecture/docs/adrs/adr-014-almacenamiento-objetos"}}');var r=i(74848),t=i(28453);const d={title:"Event Sourcing",sidebar_position:13},a=void 0,c={},l=[{value:"\u2705 ESTADO",id:"-estado",level:2},{value:"\ud83d\uddfa\ufe0f CONTEXTO",id:"\ufe0f-contexto",level:2},{value:"Comparativa Cualitativa",id:"comparativa-cualitativa",level:3},{value:"Matriz de Decisi\xf3n",id:"matriz-de-decisi\xf3n",level:3},{value:"Comparativa de costos estimados (2025)",id:"comparativa-de-costos-estimados-2025",level:3},{value:"\u2714\ufe0f DECISI\xd3N",id:"\ufe0f-decisi\xf3n",level:2},{value:"Justificaci\xf3n",id:"justificaci\xf3n",level:2},{value:"Limitaciones",id:"limitaciones",level:2},{value:"Alternativas descartadas",id:"alternativas-descartadas",level:2},{value:"\u26a0\ufe0f CONSECUENCIAS",id:"\ufe0f-consecuencias",level:2},{value:"\ud83d\udcda REFERENCIAS",id:"-referencias",level:2}];function o(e){const n={a:"a",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"-estado",children:"\u2705 ESTADO"}),"\n",(0,r.jsx)(n.p,{children:"Aceptada \u2013 Agosto 2025"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-contexto",children:"\ud83d\uddfa\ufe0f CONTEXTO"}),"\n",(0,r.jsx)(n.p,{children:"Los servicios corporativos distribuidos requieren una estrategia de Event Store que soporte:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Event Sourcing"})," para auditor\xeda completa y trazabilidad de cambios"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-tenancy"})," con segregaci\xf3n de eventos por pa\xeds/tenant"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-cloud portabilidad"})," sin vendor lock-in"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Escalabilidad horizontal"})," para alto volumen de eventos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consistencia transaccional"})," para integridad de datos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Snapshots autom\xe1ticos"})," para optimizaci\xf3n de performance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Proyecciones en tiempo real"})," para vistas materializadas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Replay de eventos"})," para debugging y migraci\xf3n de datos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compliance y auditor\xeda"})," con retenci\xf3n configurable"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Disaster recovery"})," con backup y replicaci\xf3n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["La intenci\xf3n estrat\xe9gica es ",(0,r.jsx)(n.strong,{children:"priorizar agnosticidad vs performance especializada"})," para Event Store empresarial."]}),"\n",(0,r.jsx)(n.p,{children:"Las alternativas evaluadas fueron:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PostgreSQL + Event Table"})," (RDBMS, JSON events, triggers)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"EventStoreDB"})," (Event Store nativo, especializado)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Apache Kafka"})," (Streaming platform, event log)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MongoDB"})," (Document store, event collections)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"AWS DynamoDB Streams"})," (NoSQL managed, AWS nativo)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Azure CosmosDB Change Feed"})," (Multi-model, Azure nativo)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"comparativa-cualitativa",children:"Comparativa Cualitativa"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Criterio"}),(0,r.jsx)(n.th,{children:"PostgreSQL"}),(0,r.jsx)(n.th,{children:"EventStoreDB"}),(0,r.jsx)(n.th,{children:"Apache Kafka"}),(0,r.jsx)(n.th,{children:"MongoDB"}),(0,r.jsx)(n.th,{children:"DynamoDB Streams"}),(0,r.jsx)(n.th,{children:"CosmosDB"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Agnosticidad"})}),(0,r.jsx)(n.td,{children:"\u2705 Totalmente agn\xf3stico"}),(0,r.jsx)(n.td,{children:"\u2705 Totalmente agn\xf3stico"}),(0,r.jsx)(n.td,{children:"\u2705 Totalmente agn\xf3stico"}),(0,r.jsx)(n.td,{children:"\u2705 Totalmente agn\xf3stico"}),(0,r.jsx)(n.td,{children:"\u274c Lock-in AWS"}),(0,r.jsx)(n.td,{children:"\u274c Lock-in Azure"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Event Sourcing"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Manual con JSON"}),(0,r.jsx)(n.td,{children:"\u2705 Nativo, especializado"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Log como eventos"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Collections"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Streams"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Change feed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Escalabilidad"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Vertical limitada"}),(0,r.jsx)(n.td,{children:"\u2705 Horizontal"}),(0,r.jsx)(n.td,{children:"\u2705 Masiva"}),(0,r.jsx)(n.td,{children:"\u2705 Horizontal"}),(0,r.jsx)(n.td,{children:"\u2705 Autom\xe1tica"}),(0,r.jsx)(n.td,{children:"\u2705 Global"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Ecosistema .NET"})}),(0,r.jsx)(n.td,{children:"\u2705 Npgsql excelente"}),(0,r.jsx)(n.td,{children:"\u2705 Cliente oficial"}),(0,r.jsx)(n.td,{children:"\u2705 Confluent.Kafka"}),(0,r.jsx)(n.td,{children:"\u2705 MongoDB.Driver"}),(0,r.jsx)(n.td,{children:"\u2705 AWS SDK"}),(0,r.jsx)(n.td,{children:"\u2705 Azure SDK"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Snapshots"})}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Manual"}),(0,r.jsx)(n.td,{children:"\u2705 Nativo"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Compactaci\xf3n"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Manual"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Manual"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Manual"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Consistencia"})}),(0,r.jsx)(n.td,{children:"\u2705 ACID fuerte"}),(0,r.jsx)(n.td,{children:"\u2705 Fuerte"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Eventual"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Eventual"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Eventual"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Configurable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Operaci\xf3n"})}),(0,r.jsx)(n.td,{children:"\u2705 Conocimiento existente"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Especializada"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Compleja"}),(0,r.jsx)(n.td,{children:"\u2705 Simple"}),(0,r.jsx)(n.td,{children:"\u2705 Gestionada"}),(0,r.jsx)(n.td,{children:"\u2705 Gestionada"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Costos"})}),(0,r.jsx)(n.td,{children:"\u2705 Gratuito OSS"}),(0,r.jsx)(n.td,{children:"\u2705 OSS + comercial"}),(0,r.jsx)(n.td,{children:"\u2705 Gratuito OSS"}),(0,r.jsx)(n.td,{children:"\u2705 Gratuito OSS"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Por uso"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Por uso"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"matriz-de-decisi\xf3n",children:"Matriz de Decisi\xf3n"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Soluci\xf3n"}),(0,r.jsx)(n.th,{children:"Agnosticidad"}),(0,r.jsx)(n.th,{children:"Event Sourcing"}),(0,r.jsx)(n.th,{children:"Escalabilidad"}),(0,r.jsx)(n.th,{children:"Ecosistema .NET"}),(0,r.jsx)(n.th,{children:"Recomendaci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"PostgreSQL + Event Table"})}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsx)(n.td,{children:"Manual"}),(0,r.jsx)(n.td,{children:"Limitada"}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsxs)(n.td,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Seleccionada"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"EventStoreDB"})}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsx)(n.td,{children:"Nativo"}),(0,r.jsx)(n.td,{children:"Buena"}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Alternativa"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Apache Kafka"})}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsx)(n.td,{children:"Como log"}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsx)(n.td,{children:"Buena"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Considerada"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"MongoDB"})}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsx)(n.td,{children:"Manual"}),(0,r.jsx)(n.td,{children:"Buena"}),(0,r.jsx)(n.td,{children:"Buena"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Considerada"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"DynamoDB Streams"})}),(0,r.jsx)(n.td,{children:"Mala"}),(0,r.jsx)(n.td,{children:"Streams"}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsx)(n.td,{children:"Buena"}),(0,r.jsx)(n.td,{children:"\u274c Descartada"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"CosmosDB Change Feed"})}),(0,r.jsx)(n.td,{children:"Mala"}),(0,r.jsx)(n.td,{children:"Change feed"}),(0,r.jsx)(n.td,{children:"Excelente"}),(0,r.jsx)(n.td,{children:"Buena"}),(0,r.jsx)(n.td,{children:"\u274c Descartada"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"comparativa-de-costos-estimados-2025",children:"Comparativa de costos estimados (2025)"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Soluci\xf3n"}),(0,r.jsx)(n.th,{children:"Costo mensual base*"}),(0,r.jsx)(n.th,{children:"Costos adicionales"}),(0,r.jsx)(n.th,{children:"Infra propia"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PostgreSQL"}),(0,r.jsx)(n.td,{children:"~US$30/mes (VM)"}),(0,r.jsx)(n.td,{children:"Backup, monitoreo"}),(0,r.jsx)(n.td,{children:"S\xed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"EventStoreDB"}),(0,r.jsx)(n.td,{children:"~US$50/mes (VM)"}),(0,r.jsx)(n.td,{children:"Licencia Enterprise opc."}),(0,r.jsx)(n.td,{children:"S\xed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"DynamoDB Streams"}),(0,r.jsx)(n.td,{children:"Pago por uso"}),(0,r.jsx)(n.td,{children:"Lecturas/escrituras"}),(0,r.jsx)(n.td,{children:"No"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CosmosDB"}),(0,r.jsx)(n.td,{children:"Pago por uso"}),(0,r.jsx)(n.td,{children:"Throughput, almacenamiento"}),(0,r.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"*Precios aproximados, sujetos a variaci\xf3n seg\xfan proveedor y volumen."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-decisi\xf3n",children:"\u2714\ufe0f DECISI\xd3N"}),"\n",(0,r.jsx)(n.p,{children:"Se recomienda abstraer el Event Store mediante interfaces y patrones (Repository, EventStoreAdapter) para permitir cambiar de backend sin impacto en la l\xf3gica de dominio. Inicialmente se usar\xe1 PostgreSQL por su bajo costo y portabilidad, pero la arquitectura soporta migraci\xf3n a EventStoreDB o servicios cloud seg\xfan necesidades futuras."}),"\n",(0,r.jsx)(n.h2,{id:"justificaci\xf3n",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Permite trazabilidad completa y reconstrucci\xf3n de estado a partir de eventos."}),"\n",(0,r.jsx)(n.li,{children:"Facilita auditor\xeda, debugging y patrones CQRS."}),"\n",(0,r.jsx)(n.li,{children:"El desacoplamiento del backend permite portabilidad y evita lock-in."}),"\n",(0,r.jsx)(n.li,{children:"PostgreSQL es suficiente para la mayor\xeda de escenarios, pero se puede evolucionar a soluciones especializadas si la carga o los requisitos lo demandan."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"limitaciones",children:"Limitaciones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"PostgreSQL requiere l\xf3gica adicional para snapshots y proyecciones."}),"\n",(0,r.jsx)(n.li,{children:"Las soluciones cloud pueden implicar lock-in y costos variables."}),"\n",(0,r.jsx)(n.li,{children:"EventStoreDB requiere operaci\xf3n y monitoreo especializado."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"alternativas-descartadas",children:"Alternativas descartadas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"DynamoDB Streams y CosmosDB: lock-in cloud, consistencia eventual, menos flexibilidad para despliegues h\xedbridos."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-consecuencias",children:"\u26a0\ufe0f CONSECUENCIAS"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"El c\xf3digo debe desacoplarse del proveedor concreto mediante interfaces."}),"\n",(0,r.jsx)(n.li,{children:"Se facilita la migraci\xf3n multi-cloud y despliegue h\xedbrido."}),"\n",(0,r.jsx)(n.li,{children:"Se requiere mantener pruebas de integraci\xf3n para cada backend soportado."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-referencias",children:"\ud83d\udcda REFERENCIAS"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://eventstore.com/",children:"EventStoreDB"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://eventstore.org/docs/",children:"Event Sourcing en PostgreSQL"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Streams.html",children:"DynamoDB Streams"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/cosmos-db/change-feed",children:"CosmosDB Change Feed"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>a});var s=i(96540);const r={},t=s.createContext(r);function d(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);