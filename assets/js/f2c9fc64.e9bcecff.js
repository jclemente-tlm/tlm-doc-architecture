"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[2116],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>d});var s=i(96540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},96573:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"servicios-corporativos/servicio-identidad/decisiones-arquitectura","title":"9. Decisiones de Arquitectura","description":"Esta secci\xf3n documenta las decisiones arquitect\xf3nicas clave del Sistema de Identidad, siguiendo el formato ADR (Architecture Decision Record) y alineando cada decisi\xf3n a los principios de portabilidad, est\xe1ndares abiertos, multi-tenant y operaci\xf3n cloud-agnostic.","source":"@site/docs/servicios-corporativos/servicio-identidad/09-decisiones-arquitectura.md","sourceDirName":"servicios-corporativos/servicio-identidad","slug":"/servicios-corporativos/servicio-identidad/decisiones-arquitectura","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-identidad/decisiones-arquitectura","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-identidad/09-decisiones-arquitectura.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"8. Conceptos Transversales","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-identidad/conceptos-transversales"},"next":{"title":"10. Requisitos De Calidad","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-identidad/requisitos-calidad"}}');var r=i(74848),t=i(28453);const l={},d="9. Decisiones de Arquitectura",c={},a=[{value:"9.1 Decisiones Principales",id:"91-decisiones-principales",level:2},{value:"9.2 Alternativas Evaluadas",id:"92-alternativas-evaluadas",level:2},{value:"9.3 Resumen de Decisiones",id:"93-resumen-de-decisiones",level:2},{value:"9.4 Principios Arquitect\xf3nicos",id:"94-principios-arquitect\xf3nicos",level:2},{value:"9.5 Referencias",id:"95-referencias",level:2},{value:"9.1 Decisiones principales",id:"91-decisiones-principales-1",level:2},{value:"9.2 Alternativas evaluadas",id:"92-alternativas-evaluadas-1",level:2},{value:"Resumen de Decisiones Arquitect\xf3nicas",id:"resumen-de-decisiones-arquitect\xf3nicas",level:2},{value:"Principios Arquitect\xf3nicos",id:"principios-arquitect\xf3nicos",level:3},{value:"ADR-001: Keycloak Containerizado como Identity Provider Central",id:"adr-001-keycloak-containerizado-como-identity-provider-central",level:2},{value:"Contexto",id:"contexto",level:3},{value:"Alternativas Consideradas",id:"alternativas-consideradas",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n",level:3},{value:"Arquitectura Containerizada",id:"arquitectura-containerizada",level:3},{value:"Configuraci\xf3n Multi-tenant (Realms)",id:"configuraci\xf3n-multi-tenant-realms",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n",level:3},{value:"Portabilidad y Vendor Independence",id:"portabilidad-y-vendor-independence",level:4},{value:"Zero Custom Development",id:"zero-custom-development",level:4},{value:"Operacional Simplicity",id:"operacional-simplicity",level:4},{value:"Implementaci\xf3n Cloud-Agnostic",id:"implementaci\xf3n-cloud-agnostic",level:3},{value:"Consecuencias",id:"consecuencias",level:3},{value:"Positivas",id:"positivas",level:4},{value:"Negativas",id:"negativas",level:4},{value:"Mitigaciones",id:"mitigaciones",level:4},{value:"ADR-002: JWT con RS256 como Formato de Token Est\xe1ndar",id:"adr-002-jwt-con-rs256-como-formato-de-token-est\xe1ndar",level:2},{value:"Contexto",id:"contexto-1",level:3},{value:"Alternativas Consideradas",id:"alternativas-consideradas-1",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-1",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-1",level:3},{value:"Seguridad",id:"seguridad",level:4},{value:"Rendimiento",id:"rendimiento",level:4},{value:"Operacional",id:"operacional",level:4},{value:"Token Structure",id:"token-structure",level:3},{value:"Key Management Strategy",id:"key-management-strategy",level:3},{value:"Consecuencias",id:"consecuencias-1",level:3},{value:"Positivas",id:"positivas-1",level:4},{value:"Negativas",id:"negativas-1",level:4},{value:"Mitigaciones",id:"mitigaciones-1",level:4},{value:"ADR-003: Multi-Realm Strategy para Aislamiento Multi-Tenant",id:"adr-003-multi-realm-strategy-para-aislamiento-multi-tenant",level:2},{value:"Contexto",id:"contexto-2",level:3},{value:"Alternativas Consideradas",id:"alternativas-consideradas-2",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-2",level:3},{value:"Arquitectura de Realms",id:"arquitectura-de-realms",level:3},{value:"Tenant Resolution Strategy",id:"tenant-resolution-strategy",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-2",level:3},{value:"Compliance",id:"compliance",level:4},{value:"Operational",id:"operational",level:4},{value:"Security",id:"security",level:4},{value:"Consecuencias",id:"consecuencias-2",level:3},{value:"Positivas",id:"positivas-2",level:4},{value:"Negativas",id:"negativas-2",level:4},{value:"Mitigaciones",id:"mitigaciones-2",level:4},{value:"ADR-004: Redis Cluster para Token Validation Caching",id:"adr-004-redis-cluster-para-token-validation-caching",level:2},{value:"Contexto",id:"contexto-3",level:3},{value:"Problema",id:"problema",level:3},{value:"Alternativas Consideradas",id:"alternativas-consideradas-3",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-3",level:3},{value:"Cache Strategy",id:"cache-strategy",level:3},{value:"Implementation",id:"implementation",level:3},{value:"Infrastructure Configuration",id:"infrastructure-configuration",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-3",level:3},{value:"Performance Impact",id:"performance-impact",level:4},{value:"Reliability",id:"reliability",level:4},{value:"Consecuencias",id:"consecuencias-3",level:3},{value:"Positivas",id:"positivas-3",level:4},{value:"Negativas",id:"negativas-3",level:4},{value:"Mitigaciones",id:"mitigaciones-3",level:4},{value:"ADR-005: Event Sourcing para Audit Trail Compliance",id:"adr-005-event-sourcing-para-audit-trail-compliance",level:2},{value:"Contexto",id:"contexto-4",level:3},{value:"Traditional vs Event Sourcing",id:"traditional-vs-event-sourcing",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-4",level:3},{value:"Event Store Architecture",id:"event-store-architecture",level:3},{value:"Event Schema Design",id:"event-schema-design",level:3},{value:"Event Store Implementation",id:"event-store-implementation",level:3},{value:"Real-time Event Processing",id:"real-time-event-processing",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-4",level:3},{value:"Compliance Benefits",id:"compliance-benefits",level:4},{value:"Security Benefits",id:"security-benefits",level:4},{value:"Operational Benefits",id:"operational-benefits",level:4},{value:"Consecuencias",id:"consecuencias-4",level:3},{value:"Positivas",id:"positivas-4",level:4},{value:"Negativas",id:"negativas-4",level:4},{value:"Mitigaciones",id:"mitigaciones-4",level:4},{value:"Resumen de Decisiones",id:"resumen-de-decisiones",level:2},{value:"Dependency Graph",id:"dependency-graph",level:3},{value:"Referencias",id:"referencias",level:2},{value:"ADR Format",id:"adr-format",level:3},{value:"Implementation References",id:"implementation-references",level:3},{value:"Compliance Standards",id:"compliance-standards",level:3},{value:"Contexto",id:"contexto-5",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-5",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-5",level:3},{value:"Consecuencias",id:"consecuencias-5",level:3},{value:"Resumen de Decisiones",id:"resumen-de-decisiones-1",level:2},{value:"Referencias",id:"referencias-1",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"9-decisiones-de-arquitectura",children:"9. Decisiones de Arquitectura"})}),"\n",(0,r.jsxs)(n.p,{children:["Esta secci\xf3n documenta las decisiones arquitect\xf3nicas clave del ",(0,r.jsx)(n.strong,{children:"Sistema de Identidad"}),", siguiendo el formato ADR (Architecture Decision Record) y alineando cada decisi\xf3n a los principios de portabilidad, est\xe1ndares abiertos, multi-tenant y operaci\xf3n cloud-agnostic."]}),"\n",(0,r.jsx)(n.h2,{id:"91-decisiones-principales",children:"9.1 Decisiones Principales"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"ADR"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"}),(0,r.jsx)(n.th,{children:"Estado"}),(0,r.jsx)(n.th,{children:"Justificaci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-001"}),(0,r.jsx)(n.td,{children:"Keycloak como IdP"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Open source maduro"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-002"}),(0,r.jsx)(n.td,{children:"Multi-tenant (realm) por pa\xeds"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Aislamiento total"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-003"}),(0,r.jsx)(n.td,{children:"PostgreSQL backend"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Robustez"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-004"}),(0,r.jsx)(n.td,{children:"Federaci\xf3n h\xedbrida"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Flexibilidad"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"92-alternativas-evaluadas",children:"9.2 Alternativas Evaluadas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Componente"}),(0,r.jsx)(n.th,{children:"Alternativas"}),(0,r.jsx)(n.th,{children:"Selecci\xf3n"}),(0,r.jsx)(n.th,{children:"Raz\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"IdP"}),(0,r.jsx)(n.td,{children:"Auth0, Okta, Keycloak"}),(0,r.jsx)(n.td,{children:"Keycloak"}),(0,r.jsx)(n.td,{children:"Control total"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Base de datos"}),(0,r.jsx)(n.td,{children:"MySQL, PostgreSQL"}),(0,r.jsx)(n.td,{children:"PostgreSQL"}),(0,r.jsx)(n.td,{children:"Compatibilidad"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Deployment"}),(0,r.jsx)(n.td,{children:"VM, Container, K8s"}),(0,r.jsx)(n.td,{children:"Container"}),(0,r.jsx)(n.td,{children:"Portabilidad"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Federaci\xf3n"}),(0,r.jsx)(n.td,{children:"Full, None, H\xedbrida"}),(0,r.jsx)(n.td,{children:"H\xedbrida"}),(0,r.jsx)(n.td,{children:"Gradual"})]})]})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Todas las decisiones siguen los principios: agn\xf3stico de nube, sin desarrollo personalizado, basado en est\xe1ndares, multi-tenant (realm), contenedores primero, sin dependencia de proveedor. Cada ADR documenta contexto, justificaci\xf3n y consecuencias."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"93-resumen-de-decisiones",children:"9.3 Resumen de Decisiones"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"#"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"}),(0,r.jsx)(n.th,{children:"Estado"}),(0,r.jsx)(n.th,{children:"Impacto"}),(0,r.jsx)(n.th,{children:"Fecha"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-001"}),(0,r.jsx)(n.td,{children:"Keycloak Containerizado"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"}),(0,r.jsx)(n.td,{children:"2024-01-15"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-002"}),(0,r.jsx)(n.td,{children:"Multi-tenant (realm)"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"}),(0,r.jsx)(n.td,{children:"2024-01-20"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-003"}),(0,r.jsx)(n.td,{children:"Database-backed Sessions"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Medio"}),(0,r.jsx)(n.td,{children:"2024-01-25"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-004"}),(0,r.jsx)(n.td,{children:"OAuth2 + OIDC Standard"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"}),(0,r.jsx)(n.td,{children:"2024-01-30"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"94-principios-arquitect\xf3nicos",children:"9.4 Principios Arquitect\xf3nicos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Portabilidad entre nubes:"})," Keycloak y PostgreSQL desplegables en AWS, Azure, GCP o on-premise"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sin desarrollo personalizado:"})," Uso de Keycloak y PostgreSQL listos para usar"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Est\xe1ndares abiertos:"})," OAuth2, OIDC, SAML 2.0 para m\xe1xima interoperabilidad"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-tenant (realm) por pa\xeds:"})," Aislamiento total de datos y configuraci\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Contenedores y orquestaci\xf3n:"})," Docker/Kubernetes como base de despliegue"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Independencia de proveedor:"})," Sin lock-in, migraci\xf3n sencilla"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"95-referencias",children:"9.5 Referencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.arc42.org/section-9/",children:"Arc42 ADR Template"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.keycloak.org/architecture/",children:"Keycloak Architecture"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://c4model.com/",children:"C4 Model for Software Architecture"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h1,{id:"9-decisiones-de-arquitectura-detalle-adr",children:"9. Decisiones de arquitectura (Detalle ADR)"}),"\n",(0,r.jsx)(n.h2,{id:"91-decisiones-principales-1",children:"9.1 Decisiones principales"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"ADR"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"}),(0,r.jsx)(n.th,{children:"Estado"}),(0,r.jsx)(n.th,{children:"Justificaci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ADR-001"})}),(0,r.jsx)(n.td,{children:"Keycloak como IdP"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Open source maduro"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ADR-002"})}),(0,r.jsx)(n.td,{children:"Multi-realm por pa\xeds"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Aislamiento completo"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ADR-003"})}),(0,r.jsx)(n.td,{children:"PostgreSQL backend"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Robustez"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ADR-004"})}),(0,r.jsx)(n.td,{children:"Federaci\xf3n h\xedbrida"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Flexibilidad"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"92-alternativas-evaluadas-1",children:"9.2 Alternativas evaluadas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Componente"}),(0,r.jsx)(n.th,{children:"Alternativas"}),(0,r.jsx)(n.th,{children:"Selecci\xf3n"}),(0,r.jsx)(n.th,{children:"Raz\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"IdP"})}),(0,r.jsx)(n.td,{children:"Auth0, Okta, Keycloak"}),(0,r.jsx)(n.td,{children:"Keycloak"}),(0,r.jsx)(n.td,{children:"Control total"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Base datos"})}),(0,r.jsx)(n.td,{children:"MySQL, PostgreSQL"}),(0,r.jsx)(n.td,{children:"PostgreSQL"}),(0,r.jsx)(n.td,{children:"Compatibilidad"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Deployment"})}),(0,r.jsx)(n.td,{children:"VM, Container, K8s"}),(0,r.jsx)(n.td,{children:"Container"}),(0,r.jsx)(n.td,{children:"Portabilidad"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Federaci\xf3n"})}),(0,r.jsx)(n.td,{children:"Full, None, H\xedbrida"}),(0,r.jsx)(n.td,{children:"H\xedbrida"}),(0,r.jsx)(n.td,{children:"Gradual"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Esta secci\xf3n documenta las decisiones arquitect\xf3nicas m\xe1s importantes del ",(0,r.jsx)(n.strong,{children:"Sistema de Identidad"})," utilizando el formato ADR (Architecture Decision Record), proporcionando contexto, justificaci\xf3n y consecuencias de cada decisi\xf3n."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"[INSERTAR AQU\xcd: Diagrama C4 - Architecture Decision Dependencies]"})}),"\n",(0,r.jsx)(n.h2,{id:"resumen-de-decisiones-arquitect\xf3nicas",children:"Resumen de Decisiones Arquitect\xf3nicas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"#"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"}),(0,r.jsx)(n.th,{children:"Estado"}),(0,r.jsx)(n.th,{children:"Impacto"}),(0,r.jsx)(n.th,{children:"Fecha"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-001"}),(0,r.jsx)(n.td,{children:"Keycloak Containerizado"}),(0,r.jsx)(n.td,{children:"\u2705 Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"}),(0,r.jsx)(n.td,{children:"2024-01-15"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-002"}),(0,r.jsx)(n.td,{children:"Multi-realm Strategy"}),(0,r.jsx)(n.td,{children:"\u2705 Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"}),(0,r.jsx)(n.td,{children:"2024-01-20"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-003"}),(0,r.jsx)(n.td,{children:"Database-backed Sessions"}),(0,r.jsx)(n.td,{children:"\u2705 Aprobado"}),(0,r.jsx)(n.td,{children:"Medio"}),(0,r.jsx)(n.td,{children:"2024-01-25"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ADR-004"}),(0,r.jsx)(n.td,{children:"OAuth2 + OIDC Standard"}),(0,r.jsx)(n.td,{children:"\u2705 Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"}),(0,r.jsx)(n.td,{children:"2024-01-30"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"principios-arquitect\xf3nicos",children:"Principios Arquitect\xf3nicos"}),"\n",(0,r.jsx)(n.p,{children:"Las decisiones arquitect\xf3nicas del Sistema de Identidad siguen los principios de:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agn\xf3stico de Nube:"})," Keycloak contenedorizado portable entre AWS, Azure y GCP"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cero Desarrollo Personalizado:"})," Uso de Keycloak listo para usar sin modificaciones"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Basado en Est\xe1ndares:"})," OAuth2, OIDC, SAML 2.0 para m\xe1xima interoperabilidad"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-tenant:"})," Realms separados por pa\xeds/tenant"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Contenedores Primero:"})," Optimizado para Kubernetes y Docker"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sin Dependencia de Proveedor:"})," Libertad completa para moverse entre proveedores de nube"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"adr-001-keycloak-containerizado-como-identity-provider-central",children:"ADR-001: Keycloak Containerizado como Identity Provider Central"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Valor"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Estado"})}),(0,r.jsx)(n.td,{children:"\u2705 Aprobado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Fecha"})}),(0,r.jsx)(n.td,{children:"2024-01-15"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Decidido por"})}),(0,r.jsx)(n.td,{children:"Equipo de Arquitectura + CISO"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Interesados"})}),(0,r.jsx)(n.td,{children:"Equipos de Desarrollo, Equipo de Seguridad, Operaciones"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"contexto",children:"Contexto"}),"\n",(0,r.jsxs)(n.p,{children:["La organizaci\xf3n requiere centralizar la gesti\xf3n de identidades para m\xfaltiples aplicaciones corporativas distribuidas en 4 pa\xedses (Per\xfa, Ecuador, Colombia, M\xe9xico), con enfoque en ",(0,r.jsx)(n.strong,{children:"portabilidad agn\xf3stica de nube"})," y sin desarrollo personalizado dentro del servicio de identidad."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Requisitos espec\xedficos:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Soluci\xf3n contenedorizada lista para usar"}),"\n",(0,r.jsx)(n.li,{children:"Soporte para OAuth2/OIDC y SAML 2.0"}),"\n",(0,r.jsx)(n.li,{children:"Multi-tenancy con aislamiento por pa\xeds"}),"\n",(0,r.jsx)(n.li,{children:"Federaci\xf3n con Google Workspace y Active Directory"}),"\n",(0,r.jsx)(n.li,{children:"Cumplimiento con GDPR, SOX y regulaciones locales"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Agn\xf3stico de nube:"})," Portable entre AWS, Azure, GCP"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cero desarrollo personalizado:"})," Usar Keycloak listo para usar"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas",children:"Alternativas Consideradas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Soluci\xf3n"}),(0,r.jsx)(n.th,{children:"Portabilidad"}),(0,r.jsx)(n.th,{children:"Desarrollo Custom"}),(0,r.jsx)(n.th,{children:"Costo/A\xf1o"}),(0,r.jsx)(n.th,{children:"Vendor Lock-in"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Keycloak Container"})}),(0,r.jsx)(n.td,{children:"\u2705 Full"}),(0,r.jsx)(n.td,{children:"\u274c None required"}),(0,r.jsx)(n.td,{children:"$50K"}),(0,r.jsx)(n.td,{children:"\u274c None"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Auth0"})}),(0,r.jsx)(n.td,{children:"\u26a0\ufe0f Limited"}),(0,r.jsx)(n.td,{children:"\u274c API only"}),(0,r.jsx)(n.td,{children:"$180K"}),(0,r.jsx)(n.td,{children:"\u2705 High"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"AWS Cognito"})}),(0,r.jsx)(n.td,{children:"\u274c AWS only"}),(0,r.jsx)(n.td,{children:"\u26a0\ufe0f Some custom"}),(0,r.jsx)(n.td,{children:"$120K"}),(0,r.jsx)(n.td,{children:"\u2705 Complete"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Azure AD B2C"})}),(0,r.jsx)(n.td,{children:"\u274c Azure only"}),(0,r.jsx)(n.td,{children:"\u26a0\ufe0f Some custom"}),(0,r.jsx)(n.td,{children:"$150K"}),(0,r.jsx)(n.td,{children:"\u2705 Complete"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Custom Identity Service"})}),(0,r.jsx)(n.td,{children:"\u2705 Full"}),(0,r.jsx)(n.td,{children:"\u2705 Extensive"}),(0,r.jsx)(n.td,{children:"$200K+"}),(0,r.jsx)(n.td,{children:"\u274c None"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Adoptar Keycloak containerizado como proveedor de identidad central"})," con deployment cloud-agnostic usando Docker/Kubernetes."]}),"\n",(0,r.jsx)(n.h3,{id:"arquitectura-containerizada",children:"Arquitectura Containerizada"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Keycloak Container Stack\nversion: '3.8'\nservices:\n  keycloak:\n    image: quay.io/keycloak/keycloak:23.0\n    environment:\n      - KEYCLOAK_ADMIN=admin\n      - KEYCLOAK_ADMIN_PASSWORD=${ADMIN_PASSWORD}\n      - KC_DB=postgres\n      - KC_DB_URL=${DATABASE_URL}\n      - KC_DB_USERNAME=${DB_USERNAME}\n      - KC_DB_PASSWORD=${DB_PASSWORD}\n      - KC_HOSTNAME=${KEYCLOAK_HOSTNAME}\n      - KC_PROXY=edge\n    command:\n      - start\n      - --optimized\n      - --spi-theme-static-max-age=-1\n      - --spi-theme-cache-themes=false\n    ports:\n      - \"8080:8080\"\n    depends_on:\n      - postgres\n    volumes:\n      - ./themes:/opt/keycloak/themes\n      - ./providers:/opt/keycloak/providers\n\n  postgres:\n    image: postgres:15-alpine\n    environment:\n      - POSTGRES_DB=keycloak\n      - POSTGRES_USER=${DB_USERNAME}\n      - POSTGRES_PASSWORD=${DB_PASSWORD}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\nvolumes:\n  postgres_data:\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configuraci\xf3n-multi-tenant-realms",children:"Configuraci\xf3n Multi-tenant (Realms)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Realm Configuration per Country\nRealms:\n  peru-realm:\n    enabled: true\n    users: 15000\n    external_idp: google-workspace-peru\n    compliance: GDPR, Local Peruvian Regulations\n\n  ecuador-realm:\n    enabled: true\n    users: 8000\n    external_idp: google-workspace-ecuador\n    compliance: GDPR, Local Ecuadorian Regulations\n\n  colombia-realm:\n    enabled: true\n    users: 12000\n    external_idp: microsoft-ad-colombia\n    compliance: GDPR, Local Colombian Regulations\n\n  mexico-realm:\n    enabled: true\n    users: 20000\n    external_idp: google-workspace-mexico\n    compliance: GDPR, Local Mexican Regulations\n"})}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n",children:"Justificaci\xf3n"}),"\n",(0,r.jsx)(n.h4,{id:"portabilidad-y-vendor-independence",children:"Portabilidad y Vendor Independence"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cloud Agnostic:"})," Funciona en cualquier plataforma de containers"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Zero Lock-in:"})," Open source, migratable a cualquier cloud"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Standard Protocols:"})," OAuth2, OIDC, SAML - ampliamente soportados"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Container-first:"})," Deploy en Kubernetes, Docker Swarm, o ECS"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"zero-custom-development",children:"Zero Custom Development"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Out-of-the-box Features:"})," Todo lo requerido est\xe1 incluido"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configuration-only:"})," Solo archivos YAML y environment variables"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Theme Customization:"})," Branding via templates, no c\xf3digo"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"SPI Plugins:"})," Extensiones disponibles sin desarrollo"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"operacional-simplicity",children:"Operacional Simplicity"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Infraestructura como C\xf3digo:"})," Reproducible deployments"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Health Checks:"})," Built-in readiness/liveness probes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring:"})," Metrics endpoint para Prometheus"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backup/Restore:"})," Database backup strategy"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementaci\xf3n-cloud-agnostic",children:"Implementaci\xf3n Cloud-Agnostic"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Kubernetes Deployment (portable across clouds)\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: keycloak\n  namespace: identity\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: keycloak\n  template:\n    metadata:\n      labels:\n        app: keycloak\n    spec:\n      containers:\n      - name: keycloak\n        image: quay.io/keycloak/keycloak:23.0\n        env:\n        - name: KEYCLOAK_ADMIN\n          valueFrom:\n            secretKeyRef:\n              name: keycloak-secrets\n              key: admin-username\n        - name: KEYCLOAK_ADMIN_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: keycloak-secrets\n              key: admin-password\n        - name: KC_DB\n          value: "postgres"\n        - name: KC_DB_URL\n          valueFrom:\n            configMapKeyRef:\n              name: keycloak-config\n              key: database-url\n        ports:\n        - containerPort: 8080\n        readinessProbe:\n          httpGet:\n            path: /health/ready\n            port: 8080\n          initialDelaySeconds: 30\n          periodSeconds: 10\n        livenessProbe:\n          httpGet:\n            path: /health/live\n            port: 8080\n          initialDelaySeconds: 60\n          periodSeconds: 30\n'})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias",children:"Consecuencias"}),"\n",(0,r.jsx)(n.h4,{id:"positivas",children:"Positivas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Cero desarrollo:"})," No se requiere c\xf3digo personalizado"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Portabilidad de nube:"})," Ejecutar donde sea que se soporten contenedores"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Rentable:"})," $50K/a\xf1o vs $180K+ soluciones administradas"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Control completo:"})," Flexibilidad de configuraci\xf3n completa"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Basado en est\xe1ndares:"})," Cumplimiento OAuth2, OIDC, SAML"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Listo para empresa:"})," Multi-tenancy, federaci\xf3n, rastros de auditor\xeda"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"negativas",children:"Negativas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Responsabilidad operacional:"})," Infraestructura auto-administrada"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Expertise requerido:"})," El equipo necesita conocimiento de Keycloak"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Overhead de mantenimiento:"})," Actualizaciones, parches, monitoreo"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Sin soporte de proveedor:"})," Solo soporte de comunidad (a menos que suscripci\xf3n Red Hat)"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"mitigaciones",children:"Mitigaciones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Automatizaci\xf3n de infraestructura:"})," Terraform, Helm charts para despliegue"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Stack de monitoreo:"})," Prometheus, Grafana para observabilidad"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Estrategia de respaldo:"})," Respaldos autom\xe1ticos de base de datos"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Capacitaci\xf3n del equipo:"})," Certificaci\xf3n de administraci\xf3n de Keycloak"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Opci\xf3n de soporte:"})," Suscripci\xf3n Red Hat para soporte de producci\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Documentaci\xf3n:"})," Manuales operacionales completos"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"adr-002-jwt-con-rs256-como-formato-de-token-est\xe1ndar",children:"ADR-002: JWT con RS256 como Formato de Token Est\xe1ndar"}),"\n",(0,r.jsx)(n.table,{children:(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Valor"})]})})}),"\n",(0,r.jsxs)(n.p,{children:["| ",(0,r.jsx)(n.strong,{children:"Estado"})," | \u2705 Aprobado |\n| ",(0,r.jsx)(n.strong,{children:"Fecha"})," | 2024-01-20 |\n| ",(0,r.jsx)(n.strong,{children:"Decidido por"})," | Equipo de Seguridad + Engineering Lead |\n| ",(0,r.jsx)(n.strong,{children:"Relacionado con"})," | ADR-001 (Keycloak), ADR-004 (Token Caching) |"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-1",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Los microservicios requieren un mecanismo de autenticaci\xf3n/autorizaci\xf3n que sea:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stateless:"})," Sin dependency en session storage"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performant:"})," Validaci\xf3n r\xe1pida sin round-trips"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secure:"})," Integridad y no-repudiation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standard:"})," Amplio soporte en librer\xedas"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-1",children:"Alternativas Consideradas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Formato"}),(0,r.jsx)(n.th,{children:"Pros"}),(0,r.jsx)(n.th,{children:"Contras"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"JWT RS256"})}),(0,r.jsx)(n.td,{children:"Stateless, signature verification, standard"}),(0,r.jsx)(n.td,{children:"Larger size, key management"}),(0,r.jsxs)(n.td,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Seleccionado"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Opaque Tokens"})}),(0,r.jsx)(n.td,{children:"Small size, easy revocation"}),(0,r.jsx)(n.td,{children:"Requires introspection endpoint"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"JWT HS256"})}),(0,r.jsx)(n.td,{children:"Smaller, symmetric"}),(0,r.jsx)(n.td,{children:"Shared secret distribution"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"PASETO"})}),(0,r.jsx)(n.td,{children:"Modern, secure by default"}),(0,r.jsx)(n.td,{children:"Limited library support"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-1",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Utilizar JWT (JSON Web Tokens) con algoritmo de firma RS256"})," para todos los access tokens."]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-1",children:"Justificaci\xf3n"}),"\n",(0,r.jsx)(n.h4,{id:"seguridad",children:"Seguridad"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Firmas asim\xe9tricas:"})," Verificaci\xf3n de clave p\xfablica, firma de clave privada"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"No repudio:"})," Prueba criptogr\xe1fica de autenticidad del token"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sin secretos compartidos:"})," Elimina problemas de distribuci\xf3n de secretos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cumplimiento de est\xe1ndares:"})," RFC 7519, mejores pr\xe1cticas de la industria"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"rendimiento",children:"Rendimiento"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validaci\xf3n sin estado:"})," No se requiere b\xfasqueda en base de datos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verificaci\xf3n local:"})," Cada servicio valida independientemente"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Amigable con cach\xe9:"})," Claves p\xfablicas cacheadas con TTL largo"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"operacional",children:"Operacional"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Herramientas est\xe1ndar:"})," Amplio soporte de bibliotecas (.NET, Java, Node.js)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Amigable para debugging:"})," Payload legible para humanos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Basado en claims:"})," Contexto rico en payload del token"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"token-structure",children:"Token Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "header": {\n    "alg": "RS256",\n    "typ": "JWT",\n    "kid": "realm-key-id"\n  },\n  "payload": {\n    "iss": "https://identity.talma.pe/auth/realms/peru",\n    "sub": "user-uuid",\n    "aud": ["notification-api", "track-trace-api"],\n    "exp": 1640995200,\n    "iat": 1640991600,\n    "jti": "token-uuid",\n    "tenant": "peru",\n    "roles": ["employee", "notification-user"],\n    "scope": "openid profile email",\n    "department": "IT",\n    "country": "PE"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"key-management-strategy",children:"Key Management Strategy"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"Key Rotation Policy:\n  Primary Key:\n    - Lifetime: 90 days\n    - Algorithm: RSA-2048\n    - Auto-rotation: Yes\n\n  Secondary Key:\n    - Lifetime: 30 days overlap\n    - Purpose: Validation during rotation\n\n  Emergency Key:\n    - Purpose: Security incident response\n    - Manual activation only\n"})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-1",children:"Consecuencias"}),"\n",(0,r.jsx)(n.h4,{id:"positivas-1",children:"Positivas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Alto rendimiento:"})," Tiempos de validaci\xf3n sub-10ms"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Escalabilidad:"})," Sin cuello de botella central de validaci\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Seguridad:"})," Protecci\xf3n criptogr\xe1fica est\xe1ndar de la industria"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Experiencia del desarrollador:"})," Contexto rico disponible localmente"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"negativas-1",children:"Negativas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Tama\xf1o de token:"})," ~2KB vs 32 bytes para tokens opacos"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Complejidad de revocaci\xf3n:"})," Sin capacidad de revocaci\xf3n inmediata"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Gesti\xf3n de claves:"})," Complejidad de rotaci\xf3n de claves RSA"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"mitigaciones-1",children:"Mitigaciones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Compresi\xf3n:"})," Compresi\xf3n gzip para transporte HTTP"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"TTL corto:"})," Tiempo de vida del token de 15 minutos"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Cach\xe9 de lista negra:"})," Redis lista negra para tokens revocados"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Rotaci\xf3n automatizada:"})," AWS KMS para gesti\xf3n de claves"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"adr-003-multi-realm-strategy-para-aislamiento-multi-tenant",children:"ADR-003: Multi-Realm Strategy para Aislamiento Multi-Tenant"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Valor"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Estado"})}),(0,r.jsx)(n.td,{children:"\u2705 Aprobado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Fecha"})}),(0,r.jsx)(n.td,{children:"2024-02-01"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Decidido por"})}),(0,r.jsx)(n.td,{children:"Product Team + Compliance Officer"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Impacto"})}),(0,r.jsx)(n.td,{children:"High - Affects all tenant operations"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-2",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"La organizaci\xf3n opera en 4 pa\xedses con requisitos espec\xedficos:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data residency:"})," Regulaciones locales de protecci\xf3n de datos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom branding:"})," Identidad visual por pa\xeds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Different integrations:"})," LDAP/AD espec\xedficos por regi\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Isolated user management:"})," Administradores locales por pa\xeds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compliance:"})," Auditor\xedas independientes por jurisdicci\xf3n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-2",children:"Alternativas Consideradas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Estrategia"}),(0,r.jsx)(n.th,{children:"Isolation Level"}),(0,r.jsx)(n.th,{children:"Pros"}),(0,r.jsx)(n.th,{children:"Contras"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Single Realm + Groups"})}),(0,r.jsx)(n.td,{children:"Logical"}),(0,r.jsx)(n.td,{children:"Simple management"}),(0,r.jsx)(n.td,{children:"Limited isolation"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Multiple Realms"})}),(0,r.jsx)(n.td,{children:"Complete"}),(0,r.jsx)(n.td,{children:"Full isolation"}),(0,r.jsx)(n.td,{children:"Complex operations"}),(0,r.jsxs)(n.td,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Seleccionado"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Separate Keycloak Instances"})}),(0,r.jsx)(n.td,{children:"Physical"}),(0,r.jsx)(n.td,{children:"Ultimate isolation"}),(0,r.jsx)(n.td,{children:"High operational cost"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Hybrid (Master + Country realms)"})}),(0,r.jsx)(n.td,{children:"Mixed"}),(0,r.jsx)(n.td,{children:"Balanced approach"}),(0,r.jsx)(n.td,{children:"Complex design"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-2",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Implementar un realm Keycloak separado por tenant/pa\xeds"})," con configuraci\xf3n independiente."]}),"\n",(0,r.jsx)(n.h3,{id:"arquitectura-de-realms",children:"Arquitectura de Realms"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'Keycloak Realm Structure:\n  master:\n    purpose: "Administrative realm only"\n    users: "System administrators"\n    access: "Super-admin operations"\n\n  peru-realm:\n    display_name: "Talma Per\xfa"\n    users: 2000\n    integrations: ["peru-ad.talma.pe", "Google Workspace @talma.pe"]\n    locale: "es-PE"\n    currency: "PEN"\n\n  ecuador-realm:\n    display_name: "Talma Ecuador"\n    users: 800\n    integrations: ["ecuador-ad.talma.ec"]\n    locale: "es-EC"\n    currency: "USD"\n\n  colombia-realm:\n    display_name: "Talma Colombia"\n    users: 1500\n    integrations: ["colombia-ad.talma.co"]\n    locale: "es-CO"\n    currency: "COP"\n\n  mexico-realm:\n    display_name: "Talma M\xe9xico"\n    users: 1200\n    integrations: ["mexico-ad.talma.mx"]\n    locale: "es-MX"\n    currency: "MXN"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"tenant-resolution-strategy",children:"Tenant Resolution Strategy"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class TenantResolver\n{\n    public string ResolveTenant(HttpContext context)\n    {\n        // Priority: JWT claim > Header > Subdomain > Default\n        var jwtTenant = context.User?.FindFirst("tenant")?.Value;\n        if (!string.IsNullOrEmpty(jwtTenant)) return jwtTenant;\n\n        var headerTenant = context.Request.Headers["X-Tenant-ID"].FirstOrDefault();\n        if (!string.IsNullOrEmpty(headerTenant)) return headerTenant;\n\n        var host = context.Request.Host.Host;\n        if (host.StartsWith("peru.")) return "peru";\n        if (host.StartsWith("ecuador.")) return "ecuador";\n        if (host.StartsWith("colombia.")) return "colombia";\n\n        if (host.StartsWith("mexico.")) return "mexico";\n\n        return "default";\n    }\n}\n\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-2",children:"Justificaci\xf3n"}),"\n",(0,r.jsx)(n.h4,{id:"compliance",children:"Compliance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data residency:"})," Complete data isolation per country"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Audit trails:"})," Independent audit logs per jurisdiction"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Local administration:"})," Country-specific admin privileges"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Regulatory compliance:"})," GDPR, local data protection laws"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"operational",children:"Operational"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Independent configuration:"})," Separate authentication policies"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom branding:"})," Country-specific themes and localization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Isolated failures:"})," Issues in one realm don't affect others"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Scalable management:"})," Dedicated administrators per country"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"security",children:"Security"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Blast radius limitation:"})," Security incidents contained per realm"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Independent credentials:"})," No cross-tenant credential sharing"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Separate certificates:"})," Country-specific SSL certificates"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Isolated integrations:"})," Different LDAP/AD per country"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-2",children:"Consecuencias"}),"\n",(0,r.jsx)(n.h4,{id:"positivas-2",children:"Positivas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Perfect isolation:"})," Zero data cross-contamination"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Compliance ready:"})," Meets all regulatory requirements"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Customization freedom:"})," Independent configuration per tenant"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Scalable growth:"})," Linear scaling per country"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"negativas-2",children:"Negativas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Operational complexity:"})," 4x management overhead"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Resource overhead:"})," Separate connection pools, caches"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Cross-tenant queries:"})," Complex reporting across realms"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Configuration drift:"})," Potential inconsistencies"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"mitigaciones-2",children:"Mitigaciones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Automation:"})," Terraform modules for realm provisioning"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Configuration templates:"})," Standardized base configurations"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Monitoring:"})," Unified monitoring across all realms"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Documentation:"})," Comprehensive operational procedures"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"adr-004-redis-cluster-para-token-validation-caching",children:"ADR-004: Redis Cluster para Token Validation Caching"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Valor"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Estado"})}),(0,r.jsx)(n.td,{children:"\u2705 Aprobado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Fecha"})}),(0,r.jsx)(n.td,{children:"2024-02-10"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Decidido por"})}),(0,r.jsx)(n.td,{children:"Performance Team + Site Reliability"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Relacionado con"})}),(0,r.jsx)(n.td,{children:"ADR-002 (JWT Tokens)"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-3",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Initial performance testing revel\xf3:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JWT validation:"})," 45-60ms per token (RSA signature verification)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Target latency:"})," ",(0,r.jsx)(n.code,{children:"<10ms"})," for token validation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Peak load:"})," 10,000 validations/second"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Disponibilidad requirement:"})," 99.9% uptime"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"problema",children:"Problema"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Without caching:\n- CPU intensive: RSA signature verification\n- Network latency: JWKS endpoint calls\n- Scalability issue: Linear degradation with load\n- Cost impact: Higher compute requirements\n"})}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-3",children:"Alternativas Consideradas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Solution"}),(0,r.jsx)(n.th,{children:"Pros"}),(0,r.jsx)(n.th,{children:"Contras"}),(0,r.jsx)(n.th,{children:"Performance"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"No caching"})}),(0,r.jsx)(n.td,{children:"Simple"}),(0,r.jsx)(n.td,{children:"Poor performance"}),(0,r.jsx)(n.td,{children:"60ms"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"In-memory cache"})}),(0,r.jsx)(n.td,{children:"Fast"}),(0,r.jsx)(n.td,{children:"No sharing across instances"}),(0,r.jsx)(n.td,{children:"5ms"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Redis single"})}),(0,r.jsx)(n.td,{children:"Distributed"}),(0,r.jsx)(n.td,{children:"Single point of failure"}),(0,r.jsx)(n.td,{children:"8ms"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Redis Cluster"})}),(0,r.jsx)(n.td,{children:"HA + distributed"}),(0,r.jsx)(n.td,{children:"Complex setup"}),(0,r.jsx)(n.td,{children:"7ms"}),(0,r.jsxs)(n.td,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Seleccionado"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"DynamoDB"})}),(0,r.jsx)(n.td,{children:"Managed"}),(0,r.jsx)(n.td,{children:"Higher latency"}),(0,r.jsx)(n.td,{children:"15ms"}),(0,r.jsx)(n.td,{children:"\u274c Rechazado"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-3",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Implementar Redis Cluster para distributed caching"})," de metadatos de validaci\xf3n de tokens."]}),"\n",(0,r.jsx)(n.h3,{id:"cache-strategy",children:"Cache Strategy"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"Caching Layers:\n  L1_Local_Memory:\n    - Technology: .NET MemoryCache\n    - TTL: 5 minutes\n    - Size: 100MB per instance\n    - Purpose: Hot token validation\n\n  L2_Distributed_Redis:\n    - Technology: Redis Cluster (3 masters, 3 replicas)\n    - TTL: Token expiration time\n    - Size: 2GB total\n    - Purpose: Cross-instance sharing\n\nCache Keys:\n  - jwt_signature:{token_hash} -> validation_result\n  - jwks_keys:{realm}:{kid} -> public_key\n  - user_context:{user_id} -> enriched_claims\n"})}),"\n",(0,r.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class TokenValidationCache\n{\n    private readonly IMemoryCache _localCache;\n    private readonly IDistributedCache _distributedCache;\n\n    public async Task<ValidationResult> GetValidationResultAsync(string tokenHash)\n    {\n        // L1 Cache\n        if (_localCache.TryGetValue($"jwt:{tokenHash}", out ValidationResult localResult))\n        {\n            return localResult;\n        }\n\n        // L2 Cache\n        var serializedResult = await _distributedCache.GetStringAsync($"jwt:{tokenHash}");\n        if (serializedResult != null)\n        {\n            var distributedResult = JsonSerializer.Deserialize<ValidationResult>(serializedResult);\n\n            // Populate L1\n            _localCache.Set($"jwt:{tokenHash}", distributedResult, TimeSpan.FromMinutes(5));\n\n            return distributedResult;\n        }\n\n        return null; // Cache miss\n    }\n\n    public async Task SetValidationResultAsync(string tokenHash, ValidationResult result, TimeSpan ttl)\n    {\n        var serialized = JsonSerializer.Serialize(result);\n\n        // Set in both caches\n        await _distributedCache.SetStringAsync($"jwt:{tokenHash}", serialized, new DistributedCacheEntryOptions\n        {\n            AbsoluteExpirationRelativeToNow = ttl\n        });\n\n        _localCache.Set($"jwt:{tokenHash}", result, TimeSpan.FromMinutes(5));\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"infrastructure-configuration",children:"Infrastructure Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'Redis Cluster:\n  Masters: 3\n\n  Replicas: 3\n  Instance_Type: cache.r6g.large\n  Memory: 12.93 GB per node\n\n  Configuration:\n    maxmemory-policy: allkeys-lru\n\n    tcp-keepalive: 60\n    timeout: 300\n\n  Backup:\n    automatic_backup: true\n    backup_retention: 5 days\n\n    backup_window: "03:00-05:00"\n\n\n  Monitoring:\n    cloudwatch_metrics: enabled\n    slowlog_enabled: true\n    cpu_threshold: 80%\n\n\n    memory_threshold: 85%\n'})}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-3",children:"Justificaci\xf3n"}),"\n",(0,r.jsx)(n.h4,{id:"performance-impact",children:"Performance Impact"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Latency improvement:"})," 60ms \u2192 7ms (88% reduction)"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Capacidad de procesamiento increase:"})," 10x higher req/sec capacity"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CPU savings:"})," 70% reduction in validation CPU usage"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cost optimization:"})," Smaller instance types needed"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"reliability",children:"Reliability"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"High disponibilidad:"})," Redis Cluster automatic failover"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data persistence:"})," AOF + RDB backup strategies"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Graceful degradation:"})," Fallback to direct validation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring:"})," Comprehensive CloudWatch metrics"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-3",children:"Consecuencias"}),"\n",(0,r.jsx)(n.h4,{id:"positivas-3",children:"Positivas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Dramatic performance improvement:"})," Sub-10ms validation"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Cost optimization:"})," Reduced compute requirements"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Scalability:"})," Handles peak loads efficiently"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"High disponibilidad:"})," Cluster resilience"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"negativas-3",children:"Negativas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Additional complexity:"})," Cache invalidation logic"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Operational overhead:"})," Redis cluster management"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Dependency risk:"})," Cache unavailability impact"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Memory costs:"})," Additional infrastructure costs"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"mitigaciones-3",children:"Mitigaciones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Fallback logic:"})," Direct validation when cache unavailable"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Health checks:"})," Proactive cache monitoreo de salud"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Automated scaling:"})," Auto-scaling based on memory usage"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Runbooks:"})," Detailed operational procedures"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"adr-005-event-sourcing-para-audit-trail-compliance",children:"ADR-005: Event Sourcing para Audit Trail Compliance"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Valor"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Estado"})}),(0,r.jsx)(n.td,{children:"\u2705 Aprobado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Fecha"})}),(0,r.jsx)(n.td,{children:"2024-02-15"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Decidido por"})}),(0,r.jsx)(n.td,{children:"Compliance Officer + Data Architect"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Regulatory drivers"})}),(0,r.jsx)(n.td,{children:"GDPR, SOX, ISO 27001"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-4",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Compliance requirements demandan:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Complete audit trail:"})," Every identity operation must be logged"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Immutable records:"})," Audit logs cannot be modified"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Long-term retention:"})," 7 years for financial compliance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Real-time monitoring:"})," Immediate security event detection"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Forensic analysis:"})," Detailed investigation capabilities"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"traditional-vs-event-sourcing",children:"Traditional vs Event Sourcing"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Aspect"}),(0,r.jsx)(n.th,{children:"Traditional Logging"}),(0,r.jsx)(n.th,{children:"Event Sourcing"}),(0,r.jsx)(n.th,{children:"Decision"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Immutability"})}),(0,r.jsx)(n.td,{children:"Files can be modified"}),(0,r.jsx)(n.td,{children:"Events are immutable"}),(0,r.jsx)(n.td,{children:"\u2705 Event Sourcing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Completeness"})}),(0,r.jsx)(n.td,{children:"Limited to what's logged"}),(0,r.jsx)(n.td,{children:"Complete state changes"}),(0,r.jsx)(n.td,{children:"\u2705 Event Sourcing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Time travel"})}),(0,r.jsx)(n.td,{children:"Not possible"}),(0,r.jsx)(n.td,{children:"Full history replay"}),(0,r.jsx)(n.td,{children:"\u2705 Event Sourcing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Compliance"})}),(0,r.jsx)(n.td,{children:"Basic"}),(0,r.jsx)(n.td,{children:"Full auditability"}),(0,r.jsx)(n.td,{children:"\u2705 Event Sourcing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Complexity"})}),(0,r.jsx)(n.td,{children:"Simple"}),(0,r.jsx)(n.td,{children:"More complex"}),(0,r.jsx)(n.td,{children:"Acceptable trade-off"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-4",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Implementar Event Sourcing pattern"})," para audit trail y compliance reporting."]}),"\n",(0,r.jsx)(n.h3,{id:"event-store-architecture",children:"Event Store Architecture"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"Event Store:\n  Primary: PostgreSQL with JSONB events\n  Stream: Event Bus agn\xf3stico para procesamiento en tiempo real\n  Archive: AWS S3 for long-term storage\n  Analytics: AWS Athena for querying archived events\n\nEvent Categories:\n  Authentication:\n    - UserLoginAttempted\n    - UserLoggedIn\n    - UserLogoutInitiated\n    - MfaChallengeSent\n    - MfaChallengeCompleted\n\n  Authorization:\n    - PermissionGranted\n    - PermissionDenied\n    - RoleAssigned\n    - RoleRevoked\n\n  Administration:\n    - UserCreated\n    - UserModified\n    - UserDeactivated\n    - ConfigurationChanged\n\n  Compliance:\n    - DataExported\n    - DataDeleted\n    - ConsentGranted\n    - ConsentRevoked\n"})}),"\n",(0,r.jsx)(n.h3,{id:"event-schema-design",children:"Event Schema Design"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public abstract class IdentityEvent\n{\n    public Guid EventId { get; init; } = Guid.NewGuid();\n    public string StreamId { get; init; } // User ID or Admin ID\n    public string EventType { get; init; }\n    public DateTime Timestamp { get; init; } = DateTime.UtcNow;\n    public string TenantId { get; init; }\n    public string UserId { get; init; }\n    public string SessionId { get; init; }\n    public string ClientIP { get; init; }\n    public string UserAgent { get; init; }\n    public object Metadata { get; init; }\n    public object Data { get; init; }\n}\n\n// Specific event example\npublic class UserLoggedInEvent : IdentityEvent\n{\n    public string AuthenticationMethod { get; init; } // password, mfa, federated\n    public bool MfaUsed { get; init; }\n    public TimeSpan LoginDuration { get; init; }\n    public string DeviceFingerprint { get; init; }\n    public GeoLocation Location { get; init; }\n}\n\npublic class RoleAssignedEvent : IdentityEvent\n{\n    public string RoleName { get; init; }\n    public string AssignedByUserId { get; init; }\n    public DateTime? ExpiresAt { get; init; }\n    public string Justification { get; init; }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"event-store-implementation",children:"Event Store Implementation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class PostgreSQLEventStore : IEventStore\n{\n    private readonly NpgsqlConnection _connection;\n\n    public async Task AppendEventsAsync(string streamId, IEnumerable<IdentityEvent> events)\n    {\n        using var transaction = await _connection.BeginTransactionAsync();\n\n        try\n        {\n            foreach (var @event in events)\n            {\n                await _connection.ExecuteAsync(\n                    @"INSERT INTO event_store (\n                        event_id, stream_id, event_type, event_version,\n                        timestamp, tenant_id, user_id, session_id,\n                        client_ip, user_agent, event_data, metadata\n                    ) VALUES (\n                        @EventId, @StreamId, @EventType, @EventVersion,\n                        @Timestamp, @TenantId, @UserId, @SessionId,\n                        @ClientIP, @UserAgent, @EventData::jsonb, @Metadata::jsonb\n                    )",\n                    new\n                    {\n                        @event.EventId,\n                        StreamId = streamId,\n                        @event.EventType,\n                        EventVersion = GetNextVersion(streamId),\n                        @event.Timestamp,\n                        @event.TenantId,\n                        @event.UserId,\n                        @event.SessionId,\n                        @event.ClientIP,\n                        @event.UserAgent,\n                        EventData = JsonSerializer.Serialize(@event.Data),\n                        Metadata = JsonSerializer.Serialize(@event.Metadata)\n                    });\n            }\n\n            await transaction.CommitAsync();\n        }\n        catch\n        {\n            await transaction.RollbackAsync();\n            throw;\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"real-time-event-processing",children:"Real-time Event Processing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class SecurityEventProcessor\n{\n    private readonly IKafkaProducer _producer;\n\n    private readonly ISecurityAnalyzer _analyzer;\n\n    public async Task ProcessEventAsync(IdentityEvent @event)\n    {\n        // Immediate security analysis\n        var threatLevel = await _analyzer.AnalyzeThreatLevelAsync(@event);\n\n\n        if (threatLevel >= ThreatLevel.High)\n        {\n            await SendSecurityAlertAsync(@event, threatLevel);\n        }\n\n\n        // Stream to Kafka for downstream processing\n\n        await _producer.ProduceAsync("identity-events", new Message<string, string>\n        {\n            Key = @event.StreamId,\n            Value = JsonSerializer.Serialize(@event)\n\n        });\n\n\n        // Update dashboards en tiempo real\n        await UpdateSecurityDashboardAsync(@event);\n    }\n}\n\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-4",children:"Justificaci\xf3n"}),"\n",(0,r.jsx)(n.h4,{id:"compliance-benefits",children:"Compliance Benefits"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Immutable audit trail:"})," Events cannot be modified or deleted"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Complete history:"})," Every state change is captured"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Temporal queries:"})," Point-in-time system state reconstruction"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Regulatory compliance:"})," Meets SOX, GDPR, ISO 27001 requirements"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"security-benefits",children:"Security Benefits"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Real-time monitoring:"})," Immediate security event detection"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Forensic analysis:"})," Detailed investigation capabilities"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Anomaly detection:"})," Pattern analysis across event streams"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Incident response:"})," Complete attack timeline reconstruction"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"operational-benefits",children:"Operational Benefits"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"System debugging:"})," Event replay for resoluci\xf3n de problemas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Business analytics:"})," User behavior analysis"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance monitoring:"})," System usage patterns"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data recovery:"})," State reconstruction from events"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-4",children:"Consecuencias"}),"\n",(0,r.jsx)(n.h4,{id:"positivas-4",children:"Positivas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Regulatory compliance:"})," Full audit trail compliance"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Security enhancement:"})," Real-time threat detection"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Forensic capabilities:"})," Complete investigation data"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"System reliability:"})," Event replay for debugging"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"negativas-4",children:"Negativas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Storage costs:"})," Long-term event storage requirements"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Complexity increase:"})," Event sourcing learning curve"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Query complexity:"})," Event-based queries vs traditional SQL"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Performance overhead:"})," Event append latency"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"mitigaciones-4",children:"Mitigaciones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Tiered storage:"})," Hot/warm/cold storage strategy"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Training program:"})," Team education on event sourcing"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"CQRS pattern:"})," Separate read models for queries"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\ud83d\udd27 ",(0,r.jsx)(n.strong,{children:"Async processing:"})," Non-blocking event append operations"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"resumen-de-decisiones",children:"Resumen de Decisiones"}),"\n",(0,r.jsx)(n.p,{children:"| ADR | Decisi\xf3n | Impacto | Estado |"}),"\n",(0,r.jsxs)(n.p,{children:["|-----|----------|---------|--------|\n| ",(0,r.jsx)(n.strong,{children:"ADR-001"})," | Keycloak como IdP | Alto | \u2705 Implementado |"]}),"\n",(0,r.jsxs)(n.p,{children:["| ",(0,r.jsx)(n.strong,{children:"ADR-002"})," | JWT RS256 tokens | Alto | \u2705 Implementado |\n| ",(0,r.jsx)(n.strong,{children:"ADR-003"})," | Multi-realm multi-tenancy | Alto | \u2705 Implementado |"]}),"\n",(0,r.jsxs)(n.p,{children:["| ",(0,r.jsx)(n.strong,{children:"ADR-004"})," | Redis caching | Medio | \u2705 Implementado |\n| ",(0,r.jsx)(n.strong,{children:"ADR-005"})," | Event sourcing audit | Alto | \u2705 Implementado |"]}),"\n",(0,r.jsx)(n.h3,{id:"dependency-graph",children:"Dependency Graph"}),"\n",(0,r.jsx)(n.mermaid,{value:"graph TD\n    ADR001[ADR-001: Keycloak] --\x3e ADR002[ADR-002: JWT Tokens]\n    ADR001 --\x3e ADR003[ADR-003: Multi-Realm]\n    ADR002 --\x3e ADR004[ADR-004: Redis Cache]\n\n\n    ADR001 --\x3e ADR005[ADR-005: Event Sourcing]\n    ADR003 --\x3e ADR005"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"[INSERTAR AQU\xcd: Diagrama C4 - ADR Implementation Overview]"})}),"\n",(0,r.jsx)(n.h2,{id:"referencias",children:"Referencias"}),"\n",(0,r.jsx)(n.h3,{id:"adr-format",children:"ADR Format"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://adr.github.io/",children:"Architecture Decision Records (ADRs)"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions",children:"Documenting Decisiones de Arquitectura"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementation-references",children:"Implementation References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.keycloak.org/documentation",children:"Keycloak Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://tools.ietf.org/html/rfc8725",children:"JWT Mejores Pr\xe1cticas"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://martinfowler.com/eaaDev/EventSourcing.html",children:"Event Sourcing Pattern"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"compliance-standards",children:"Compliance Standards"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://gdpr.eu/compliance/",children:"GDPR Compliance Guide"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.sox-online.com/sox_it_controls.html",children:"SOX IT Controls"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.iso.org/isoiec-27001-information-security.html",children:"ISO 27001 Information Security"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-5",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Requerimientos regulatorios exigen trazabilidad completa de eventos de seguridad."}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-5",children:"Decisi\xf3n"}),"\n",(0,r.jsx)(n.p,{children:"Implementar Event Sourcing con Event Store agn\xf3stico para audit trail."}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-5",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Immutability:"})," Eventos inmutables para compliance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Completeness:"})," Captura de todos los eventos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Scalability:"})," Kafka maneja alto volumen"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Real-time:"})," Procesamiento en tiempo real"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-5",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas:"})," Compliance total, analytics avanzados"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas:"})," Complejidad de implementaci\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaciones:"})," Bibliotecas de abstracci\xf3n, tooling"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"resumen-de-decisiones-1",children:"Resumen de Decisiones"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Decisi\xf3n"}),(0,r.jsx)(n.th,{children:"Alternativas Evaluadas"}),(0,r.jsx)(n.th,{children:"Estado"}),(0,r.jsx)(n.th,{children:"Impacto"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Keycloak"}),(0,r.jsx)(n.td,{children:"Auth0, AWS Cognito, Azure AD B2C"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"JWT Tokens"}),(0,r.jsx)(n.td,{children:"SAML, Opaque tokens"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Multi-Realm"}),(0,r.jsx)(n.td,{children:"Shared realm con atributos"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Medio"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Redis Cache"}),(0,r.jsx)(n.td,{children:"In-memory, Database cache"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Medio"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Event Sourcing"}),(0,r.jsx)(n.td,{children:"Traditional auditing"}),(0,r.jsx)(n.td,{children:"Aprobado"}),(0,r.jsx)(n.td,{children:"Alto"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"referencias-1",children:"Referencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://adr.github.io/",children:"Architecture Decision Records"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.keycloak.org/docs/latest/server_development/",children:"Keycloak Architecture Guide"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://tools.ietf.org/html/rfc8725",children:"JWT Mejores Pr\xe1cticas"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.arc42.org/section-9/",children:"Arc42 Decisiones de Arquitectura"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);