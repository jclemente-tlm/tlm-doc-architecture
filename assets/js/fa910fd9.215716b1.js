"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[2041],{28453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>o});var r=n(96540);const a={},i=r.createContext(a);function t(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(i.Provider,{value:s},e.children)}},82793:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"servicios-corporativos/servicio-mensajeria-sita/vista-tiempo-ejecucion","title":"6. Vista de tiempo de ejecuci\xf3n","description":"Esta secci\xf3n describe los principales escenarios de ejecuci\xf3n y patrones de interacci\xf3n del sistema de mensajer\xeda SITA, detallando flujos cr\xedticos, manejo de errores, patrones de resiliencia y consideraciones de monitoreo y despliegue, alineados a mejores pr\xe1cticas de arquitectura y operaci\xf3n.","source":"@site/docs/servicios-corporativos/servicio-mensajeria-sita/06-vista-tiempo-ejecucion.md","sourceDirName":"servicios-corporativos/servicio-mensajeria-sita","slug":"/servicios-corporativos/servicio-mensajeria-sita/vista-tiempo-ejecucion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-mensajeria-sita/vista-tiempo-ejecucion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-mensajeria-sita/06-vista-tiempo-ejecucion.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"5. Vista de bloques de construcci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-mensajeria-sita/vista-bloques-construccion"},"next":{"title":"7. Vista de implementaci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-mensajeria-sita/vista-implementacion"}}');var a=n(74848),i=n(28453);const t={},o="6. Vista de tiempo de ejecuci\xf3n",c={},d=[{value:"6.1 Escenarios principales",id:"61-escenarios-principales",level:2},{value:"6.2 Patrones de interacci\xf3n",id:"62-patrones-de-interacci\xf3n",level:2},{value:"6.3 Flujos de ejecuci\xf3n detallados",id:"63-flujos-de-ejecuci\xf3n-detallados",level:2},{value:"6.3.1 Env\xedo de mensaje SITA outbound",id:"631-env\xedo-de-mensaje-sita-outbound",level:3},{value:"6.3.2 Recepci\xf3n de mensaje SITA inbound",id:"632-recepci\xf3n-de-mensaje-sita-inbound",level:3},{value:"6.3.3 Procesamiento batch de mensajes",id:"633-procesamiento-batch-de-mensajes",level:3},{value:"6.4 Flujos de control y resiliencia",id:"64-flujos-de-control-y-resiliencia",level:2},{value:"6.4.1 Gesti\xf3n de conexiones SITA",id:"641-gesti\xf3n-de-conexiones-sita",level:3},{value:"6.4.2 Validaci\xf3n y transformaci\xf3n de mensajes",id:"642-validaci\xf3n-y-transformaci\xf3n-de-mensajes",level:3},{value:"6.4.3 Manejo de errores y retry logic",id:"643-manejo-de-errores-y-retry-logic",level:3},{value:"6.5 Patrones de runtime",id:"65-patrones-de-runtime",level:2},{value:"6.6 Performance y monitoreo",id:"66-performance-y-monitoreo",level:2},{value:"6.7 Escenarios de despliegue",id:"67-escenarios-de-despliegue",level:2}];function l(e){const s={h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"6-vista-de-tiempo-de-ejecuci\xf3n",children:"6. Vista de tiempo de ejecuci\xf3n"})}),"\n",(0,a.jsx)(s.p,{children:"Esta secci\xf3n describe los principales escenarios de ejecuci\xf3n y patrones de interacci\xf3n del sistema de mensajer\xeda SITA, detallando flujos cr\xedticos, manejo de errores, patrones de resiliencia y consideraciones de monitoreo y despliegue, alineados a mejores pr\xe1cticas de arquitectura y operaci\xf3n."}),"\n",(0,a.jsx)(s.h2,{id:"61-escenarios-principales",children:"6.1 Escenarios principales"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Escenario"}),(0,a.jsx)(s.th,{children:"Flujo"}),(0,a.jsx)(s.th,{children:"Componentes"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Procesamiento evento"})}),(0,a.jsx)(s.td,{children:"Event Consumer \u2192 Orchestrator \u2192 Generator"}),(0,a.jsx)(s.td,{children:"Event Processor"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Generaci\xf3n archivo"})}),(0,a.jsx)(s.td,{children:"Template Engine \u2192 SITA Generator \u2192 Storage"}),(0,a.jsx)(s.td,{children:"Event Processor"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Env\xedo programado"})}),(0,a.jsx)(s.td,{children:"Sending Worker \u2192 Fetcher \u2192 Partner Sender"}),(0,a.jsx)(s.td,{children:"Sender"})]})]})]}),"\n",(0,a.jsx)(s.h2,{id:"62-patrones-de-interacci\xf3n",children:"6.2 Patrones de interacci\xf3n"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Patr\xf3n"}),(0,a.jsx)(s.th,{children:"Descripci\xf3n"}),(0,a.jsx)(s.th,{children:"Tecnolog\xeda"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Event-Driven"})}),(0,a.jsx)(s.td,{children:"Procesamiento as\xedncrono"}),(0,a.jsx)(s.td,{children:"PostgreSQL queue"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Worker Service"})}),(0,a.jsx)(s.td,{children:"Procesamiento background"}),(0,a.jsx)(s.td,{children:".NET 8"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"File-based"})}),(0,a.jsx)(s.td,{children:"Intercambio archivos"}),(0,a.jsx)(s.td,{children:"Sistema archivos"})]})]})]}),"\n",(0,a.jsx)(s.h2,{id:"63-flujos-de-ejecuci\xf3n-detallados",children:"6.3 Flujos de ejecuci\xf3n detallados"}),"\n",(0,a.jsx)(s.h3,{id:"631-env\xedo-de-mensaje-sita-outbound",children:"6.3.1 Env\xedo de mensaje SITA outbound"}),"\n",(0,a.jsx)(s.mermaid,{value:"sequenceDiagram\n    participant App as Aplicaci\xf3n Cliente\n    participant API as SITA Messaging API\n    participant Validator as Message Validator\n    participant Translator as Message Translator\n    participant Adapter as SITA Protocol Adapter\n    participant SITA as Red SITA\n    participant DB as Message Store\n    participant Kafka as Event Bus\n    participant Track as Track & Trace\n\n    App->>API: POST /api/v1/sita-messages/send\n    API->>Validator: ValidateMessage(request)\n\n    alt Validation Success\n        Validator--\x3e>API: ValidationResult.Valid\n        API->>DB: SaveMessage(PENDING)\n        API--\x3e>App: 202 Accepted {messageId}\n\n        API->>Translator: TranslateToSitaFormat(message)\n        Translator--\x3e>API: SitaFormattedMessage\n\n        API->>Adapter: SendMessage(sitaMessage)\n        Adapter->>SITA: Transmit via SITA Protocol\n\n        alt \xc9xito SITA\n            SITA--\x3e>Adapter: ACK/NAK Response\n            Adapter--\x3e>API: SendResult.Success\n            API->>DB: UpdateStatus(SENT)\n            API->>Kafka: PublishEvent(MessageSentEvent)\n            Kafka->>Track: LogEvent(SitaMessageSent)\n        else Error SITA\n            SITA--\x3e>Adapter: Error/Timeout\n            Adapter--\x3e>API: SendResult.Failed\n            API->>DB: UpdateStatus(FAILED)\n            API->>Kafka: PublishEvent(MessageFailedEvent)\n        end\n\n    else Validaci\xf3n Fallida\n        Validator--\x3e>API: ValidationResult.Invalid\n        API--\x3e>App: 400 BadRequest {errors}\n    end"}),"\n",(0,a.jsx)(s.h3,{id:"632-recepci\xf3n-de-mensaje-sita-inbound",children:"6.3.2 Recepci\xf3n de mensaje SITA inbound"}),"\n",(0,a.jsx)(s.mermaid,{value:"sequenceDiagram\n    participant SITA as Red SITA\n    participant Adapter as SITA Protocol Adapter\n    participant Processor as Message Processor\n    participant Parser as Message Parser\n    participant Router as Message Router\n    participant Corp as Servicios Corporativos\n    participant DB as Message Store\n    participant Kafka as Event Bus\n\n    SITA->>Adapter: Incoming SITA Message\n    Adapter->>Processor: ProcessIncomingMessage(rawMessage)\n\n    Processor->>Parser: ParseSitaMessage(rawMessage)\n    Parser--\x3e>Processor: ParsedMessage\n\n    Processor->>DB: SaveIncomingMessage(message)\n    Processor->>Router: DetermineRoute(message)\n\n    alt Ruta a Servicios Corporativos\n        Router--\x3e>Processor: Route.ToCorporateServices\n        Processor->>Corp: ForwardMessage(translatedMessage)\n\n        alt Procesamiento Corporativo Exitoso\n            Corp--\x3e>Processor: ProcessingResult.Success\n            Processor->>DB: UpdateStatus(PROCESSED)\n            Processor->>Kafka: PublishEvent(MessageProcessedEvent)\n            Processor->>Adapter: SendAcknowledgment(ACK)\n            Adapter->>SITA: ACK Response\n        else Procesamiento Corporativo Fallido\n            Corp--\x3e>Processor: ProcessingResult.Failed\n            Processor->>DB: UpdateStatus(FAILED)\n            Processor->>Kafka: PublishEvent(MessageFailedEvent)\n            Processor->>Adapter: SendAcknowledgment(NAK)\n            Adapter->>SITA: NAK Response\n        end\n\n    else Ruta No Encontrada\n        Router--\x3e>Processor: Route.NotFound\n        Processor->>DB: UpdateStatus(UNROUTABLE)\n        Processor->>Adapter: SendAcknowledgment(NAK)\n        Adapter->>SITA: NAK Response\n    end"}),"\n",(0,a.jsx)(s.h3,{id:"633-procesamiento-batch-de-mensajes",children:"6.3.3 Procesamiento batch de mensajes"}),"\n",(0,a.jsx)(s.mermaid,{value:"sequenceDiagram\n    participant Scheduler as Batch Scheduler\n    participant Processor as Batch Processor\n    participant DB as Message Store\n    participant Adapter as SITA Protocol Adapter\n    participant SITA as Red SITA\n    participant Monitor as Monitoring\n\n    Scheduler->>Processor: TriggerBatchProcessing()\n    Processor->>DB: GetPendingMessages(batchSize: 100)\n    DB--\x3e>Processor: PendingMessages[]\n\n    loop For each message batch\n        Processor->>Adapter: SendBatch(messages[])\n\n        par Parallel processing\n            Adapter->>SITA: SendMessage(msg1)\n            Adapter->>SITA: SendMessage(msg2)\n            Adapter->>SITA: SendMessage(msgN)\n        end\n\n        alt Todo Exitoso\n            SITA--\x3e>Adapter: ACK Responses\n            Adapter--\x3e>Processor: BatchResult.AllSuccess\n            Processor->>DB: UpdateBatchStatus(SENT)\n        else \xc9xito Parcial\n            SITA--\x3e>Adapter: Mixed ACK/NAK\n            Adapter--\x3e>Processor: BatchResult.PartialSuccess\n            Processor->>DB: UpdateIndividualStatuses()\n        else Todo Fallido\n            SITA--\x3e>Adapter: NAK/Timeout\n            Adapter--\x3e>Processor: BatchResult.AllFailed\n            Processor->>DB: UpdateBatchStatus(FAILED)\n        end\n    end\n\n    Processor->>Monitor: ReportBatchMetrics(stats)"}),"\n",(0,a.jsx)(s.h2,{id:"64-flujos-de-control-y-resiliencia",children:"6.4 Flujos de control y resiliencia"}),"\n",(0,a.jsx)(s.h3,{id:"641-gesti\xf3n-de-conexiones-sita",children:"6.4.1 Gesti\xf3n de conexiones SITA"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Pool de conexiones concurrentes y heartbeat"}),"\n",(0,a.jsx)(s.li,{children:"Health checks y auto-reconexi\xf3n"}),"\n",(0,a.jsx)(s.li,{children:"Load balancing y failover autom\xe1tico"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"642-validaci\xf3n-y-transformaci\xf3n-de-mensajes",children:"6.4.2 Validaci\xf3n y transformaci\xf3n de mensajes"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Validaci\xf3n de esquema y reglas de negocio"}),"\n",(0,a.jsx)(s.li,{children:"Transformaci\xf3n entre formatos y enriquecimiento"}),"\n",(0,a.jsx)(s.li,{children:"Cache de reglas y validaciones as\xedncronas"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"643-manejo-de-errores-y-retry-logic",children:"6.4.3 Manejo de errores y retry logic"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Retries con backoff exponencial para errores transitorios"}),"\n",(0,a.jsx)(s.li,{children:"Dead letter para errores permanentes"}),"\n",(0,a.jsx)(s.li,{children:"Logging y m\xe9tricas de intentos y fallos"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"65-patrones-de-runtime",children:"6.5 Patrones de runtime"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Connection Pool"}),": Conexiones persistentes y balanceadas"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Circuit Breaker"}),": Protecci\xf3n ante fallos de destino"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Bulkhead"}),": Aislamiento de recursos por tenant"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Saga"}),": Coordinaci\xf3n de procesos multi-step"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"66-performance-y-monitoreo",children:"6.6 Performance y monitoreo"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"1,000 mensajes/segundo por instancia"}),"\n",(0,a.jsx)(s.li,{children:"Batch de 100 mensajes para eficiencia"}),"\n",(0,a.jsx)(s.li,{children:"P95 < 200ms API, < 2s transmisi\xf3n SITA"}),"\n",(0,a.jsx)(s.li,{children:"Uso de CPU/memoria autoescalable"}),"\n",(0,a.jsx)(s.li,{children:"Health checks, m\xe9tricas y alertas operacionales"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"67-escenarios-de-despliegue",children:"6.7 Escenarios de despliegue"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Blue-Green"}),": Zero downtime, validaci\xf3n y rollback instant\xe1neo"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Canary"}),": Rollout gradual, monitoreo y auto-rollback"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Disaster Recovery"}),": RTO 15min, RPO 5min, failover autom\xe1tico"]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);