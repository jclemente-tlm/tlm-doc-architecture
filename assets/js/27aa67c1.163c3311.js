"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[7681],{12686:(e,n,d)=>{d.d(n,{A:()=>i});const i=d.p+"assets/images/track_and_trace_tracking_ingest_api-3b5ccd1fc71c0bca370f1c94ccadac91.png"},28453:(e,n,d)=>{d.d(n,{R:()=>t,x:()=>c});var i=d(96540);const r={},s=i.createContext(r);function t(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(s.Provider,{value:n},e.children)}},29642:(e,n,d)=>{d.d(n,{A:()=>i});const i=d.p+"assets/images/track_and_trace_tracking_query_api-2a06aa94f1cefbcf023d4670f3056226.png"},67332:(e,n,d)=>{d.d(n,{A:()=>i});const i=d.p+"assets/images/track_and_trace_event_processor-693e5078df6bce0a4ac825dee5be2be5.png"},68757:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"servicios-corporativos/servicio-track-trace/vista-bloques-construccion","title":"5. Vista de bloques de construcci\xf3n","description":"Esta secci\xf3n describe la estructura modular del sistema Track & Trace, presentando los bloques principales (contenedores y componentes), sus responsabilidades y tecnolog\xedas, as\xed como los principales esquemas de datos y contratos de integraci\xf3n. La visi\xf3n se centra en los elementos implementados y sus relaciones clave para la trazabilidad operacional multi-tenant.","source":"@site/docs/servicios-corporativos/servicio-track-trace/05-vista-bloques-construccion.md","sourceDirName":"servicios-corporativos/servicio-track-trace","slug":"/servicios-corporativos/servicio-track-trace/vista-bloques-construccion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/vista-bloques-construccion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-track-trace/05-vista-bloques-construccion.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"4. Estrategia de soluci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/estrategia-solucion"},"next":{"title":"6. Vista de tiempo de ejecuci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/vista-tiempo-ejecucion"}}');var r=d(74848),s=d(28453);const t={},c="5. Vista de bloques de construcci\xf3n",a={},l=[{value:"5.1 Contenedores principales",id:"51-contenedores-principales",level:2},{value:"5.2 Componentes principales",id:"52-componentes-principales",level:2},{value:"Tracking Ingest API",id:"tracking-ingest-api",level:3},{value:"Tracking Query API",id:"tracking-query-api",level:3},{value:"Tracking Event Processor",id:"tracking-event-processor",level:3},{value:"5.3 Esquemas de datos",id:"53-esquemas-de-datos",level:2},{value:"Tabla: <code>tenant_tracking_settings</code>",id:"tabla-tenant_tracking_settings",level:3},{value:"Tabla: event_store",id:"tabla-event_store",level:3},{value:"Tabla: trace_views",id:"tabla-trace_views",level:3},{value:"Ejemplo de contenido y actualizaci\xf3n de trace view para trazabilidad",id:"ejemplo-de-contenido-y-actualizaci\xf3n-de-trace-view-para-trazabilidad",level:4},{value:"5.4 Endpoints principales",id:"54-endpoints-principales",level:2},{value:"Endpoints de Tracking Ingest API",id:"endpoints-de-tracking-ingest-api",level:3},{value:"Endpoints de Tracking Query API",id:"endpoints-de-tracking-query-api",level:3},{value:"5.5 Contratos de entrada y salida",id:"55-contratos-de-entrada-y-salida",level:2},{value:"Contrato de entrada: EventRequest (Tracking Ingest API)",id:"contrato-de-entrada-eventrequest-tracking-ingest-api",level:3},{value:"Contrato de salida: TraceResponse (Tracking Query API)",id:"contrato-de-salida-traceresponse-tracking-query-api",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"5-vista-de-bloques-de-construcci\xf3n",children:"5. Vista de bloques de construcci\xf3n"})}),"\n",(0,r.jsxs)(n.p,{children:["Esta secci\xf3n describe la estructura modular del sistema ",(0,r.jsx)(n.strong,{children:"Track & Trace"}),", presentando los bloques principales (contenedores y componentes), sus responsabilidades y tecnolog\xedas, as\xed como los principales esquemas de datos y contratos de integraci\xf3n. La visi\xf3n se centra en los elementos implementados y sus relaciones clave para la trazabilidad operacional multi-tenant."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Vista General del Sistema Track &amp; Trace",src:d(86058).A+"",width:"5528",height:"2790"})}),"\n",(0,r.jsx)(n.h2,{id:"51-contenedores-principales",children:"5.1 Contenedores principales"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Contenedor"}),(0,r.jsx)(n.th,{children:"Responsabilidad"}),(0,r.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Ingest API"}),(0,r.jsx)(n.td,{children:"API REST para ingesta y validaci\xf3n de eventos"}),(0,r.jsx)(n.td,{children:"C#, ASP.NET Core, REST API"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Query API"}),(0,r.jsx)(n.td,{children:"API REST para consultas de tracking"}),(0,r.jsx)(n.td,{children:"C#, ASP.NET Core, REST API"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Event Queue"}),(0,r.jsx)(n.td,{children:"Cola para desacoplar ingesta y procesamiento as\xedncrono"}),(0,r.jsx)(n.td,{children:"AWS SQS"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Event Processor"}),(0,r.jsx)(n.td,{children:"Procesamiento, validaci\xf3n y enriquecimiento de eventos"}),(0,r.jsx)(n.td,{children:"C#, ASP.NET Core, AWS SDK (SQS)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Web"}),(0,r.jsx)(n.td,{children:"Visualizaci\xf3n en tiempo real y an\xe1lisis de eventos"}),(0,r.jsx)(n.td,{children:"React, TypeScript"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Database"}),(0,r.jsx)(n.td,{children:"Almacenamiento de eventos, estados y configuraciones"}),(0,r.jsx)(n.td,{children:"PostgreSQL"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"52-componentes-principales",children:"5.2 Componentes principales"}),"\n",(0,r.jsx)(n.h3,{id:"tracking-ingest-api",children:"Tracking Ingest API"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Componentes Tracking Ingest API",src:d(12686).A+"",width:"5330",height:"3195"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Componente"}),(0,r.jsx)(n.th,{children:"Funci\xf3n"}),(0,r.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Event Controller"}),(0,r.jsx)(n.td,{children:"Expone endpoints REST para recepci\xf3n masiva de eventos"}),(0,r.jsx)(n.td,{children:"ASP.NET Core"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Event Service"}),(0,r.jsx)(n.td,{children:"Procesa y valida eventos, aplica reglas de negocio y enriquecimiento"}),(0,r.jsx)(n.td,{children:"C#"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Event Publisher"}),(0,r.jsx)(n.td,{children:"Publica eventos validados en la cola AWS SQS"}),(0,r.jsx)(n.td,{children:"C#, AWS SDK (SQS)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Configuration Manager"}),(0,r.jsx)(n.td,{children:"Gestiona configuraciones del servicio y por tenant"}),(0,r.jsx)(n.td,{children:"C#, .NET 8, EF Core"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Health Check"}),(0,r.jsx)(n.td,{children:"Monitoreo de salud del API"}),(0,r.jsx)(n.td,{children:"ASP.NET Core Health Checks"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Metrics Collector"}),(0,r.jsx)(n.td,{children:"Recolecci\xf3n de m\xe9tricas para observabilidad"}),(0,r.jsx)(n.td,{children:"Prometheus.NET"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Structured Logger"}),(0,r.jsx)(n.td,{children:"Logging estructurado unificado"}),(0,r.jsx)(n.td,{children:"Serilog"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"tracking-query-api",children:"Tracking Query API"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Componentes Tracking Query API",src:d(29642).A+"",width:"5210",height:"2595"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Componente"}),(0,r.jsx)(n.th,{children:"Funci\xf3n"}),(0,r.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Query Controller"}),(0,r.jsx)(n.td,{children:"Expone endpoints REST para consultas"}),(0,r.jsx)(n.td,{children:"ASP.NET Core"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Query Service"}),(0,r.jsx)(n.td,{children:"Orquesta operaciones de consulta y aplica l\xf3gica de negocio"}),(0,r.jsx)(n.td,{children:"C#"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Data Repository"}),(0,r.jsx)(n.td,{children:"Acceso optimizado a datos de tracking"}),(0,r.jsx)(n.td,{children:"C#, EF Core"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Configuration Manager"}),(0,r.jsx)(n.td,{children:"Gesti\xf3n de configuraciones"}),(0,r.jsx)(n.td,{children:"C#, .NET 8, EF Core"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Health Check"}),(0,r.jsx)(n.td,{children:"Monitoreo de salud del API"}),(0,r.jsx)(n.td,{children:"ASP.NET Core Health Checks"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Metrics Collector"}),(0,r.jsx)(n.td,{children:"Recolecci\xf3n de m\xe9tricas"}),(0,r.jsx)(n.td,{children:"Prometheus.NET"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Structured Logger"}),(0,r.jsx)(n.td,{children:"Logging estructurado"}),(0,r.jsx)(n.td,{children:"Serilog"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"tracking-event-processor",children:"Tracking Event Processor"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Componentes Tracking Event Processor",src:d(67332).A+"",width:"5250",height:"2680"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Componente"}),(0,r.jsx)(n.th,{children:"Funci\xf3n"}),(0,r.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Event Consumer"}),(0,r.jsx)(n.td,{children:"Consume eventos desde la cola"}),(0,r.jsx)(n.td,{children:"C#, AWS SDK (SQS)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Event Handler"}),(0,r.jsx)(n.td,{children:"Valida y aplica reglas de negocio a los eventos"}),(0,r.jsx)(n.td,{children:"C#"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Processing Service"}),(0,r.jsx)(n.td,{children:"L\xf3gica de enriquecimiento y correlaci\xf3n"}),(0,r.jsx)(n.td,{children:"C#"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Tracking Event Repository"}),(0,r.jsx)(n.td,{children:"Persistencia de eventos"}),(0,r.jsx)(n.td,{children:"C#, EF Core"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Downstream Event Publisher"}),(0,r.jsx)(n.td,{children:"Publica eventos procesados a sistemas downstream"}),(0,r.jsx)(n.td,{children:"C#, AWS SDK (SNS)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Configuration Manager"}),(0,r.jsx)(n.td,{children:"Gesti\xf3n de configuraciones"}),(0,r.jsx)(n.td,{children:"C#, .NET 8, EF Core"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Health Check"}),(0,r.jsx)(n.td,{children:"Monitoreo de salud"}),(0,r.jsx)(n.td,{children:"ASP.NET Core Health Checks"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Metrics Collector"}),(0,r.jsx)(n.td,{children:"M\xe9tricas"}),(0,r.jsx)(n.td,{children:"Prometheus.NET"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Structured Logger"}),(0,r.jsx)(n.td,{children:"Logging estructurado"}),(0,r.jsx)(n.td,{children:"Serilog"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"53-esquemas-de-datos",children:"5.3 Esquemas de datos"}),"\n",(0,r.jsxs)(n.h3,{id:"tabla-tenant_tracking_settings",children:["Tabla: ",(0,r.jsx)(n.code,{children:"tenant_tracking_settings"})]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Tipo"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"}),(0,r.jsx)(n.th,{children:"Restricciones"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"id"}),(0,r.jsx)(n.td,{children:"UUID"}),(0,r.jsx)(n.td,{children:"Identificador \xfanico"}),(0,r.jsx)(n.td,{children:"PRIMARY KEY"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"tenant_id"}),(0,r.jsx)(n.td,{children:"VARCHAR(50)"}),(0,r.jsx)(n.td,{children:"Identificador del tenant"}),(0,r.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"country_code"}),(0,r.jsx)(n.td,{children:"VARCHAR(5)"}),(0,r.jsx)(n.td,{children:"C\xf3digo de pa\xeds (PE, EC, CO, MX)"}),(0,r.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"allowed_event_types"}),(0,r.jsx)(n.td,{children:"JSONB"}),(0,r.jsx)(n.td,{children:"Tipos de eventos permitidos (tracking, sita, etc.)"}),(0,r.jsx)(n.td,{children:"NOT NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"event_retention_days"}),(0,r.jsx)(n.td,{children:"INTEGER"}),(0,r.jsx)(n.td,{children:"D\xedas de retenci\xf3n de eventos"}),(0,r.jsx)(n.td,{children:"NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"max_payload_size"}),(0,r.jsx)(n.td,{children:"INTEGER"}),(0,r.jsx)(n.td,{children:"Tama\xf1o m\xe1ximo permitido para eventos (bytes)"}),(0,r.jsx)(n.td,{children:"NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"allowed_sources"}),(0,r.jsx)(n.td,{children:"JSONB"}),(0,r.jsx)(n.td,{children:"Sistemas/autores permitidos para registrar eventos"}),(0,r.jsx)(n.td,{children:"NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"preferences"}),(0,r.jsx)(n.td,{children:"JSONB"}),(0,r.jsx)(n.td,{children:"Preferencias adicionales (idioma, formato, etc.)"}),(0,r.jsx)(n.td,{children:"NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"is_active"}),(0,r.jsx)(n.td,{children:"BOOLEAN"}),(0,r.jsx)(n.td,{children:"Configuraci\xf3n activa"}),(0,r.jsx)(n.td,{children:"DEFAULT true"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"created_at"}),(0,r.jsx)(n.td,{children:"TIMESTAMP"}),(0,r.jsx)(n.td,{children:"Fecha de creaci\xf3n"}),(0,r.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"updated_at"}),(0,r.jsx)(n.td,{children:"TIMESTAMP"}),(0,r.jsx)(n.td,{children:"Fecha de actualizaci\xf3n"}),(0,r.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ejemplo de datos:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"id"}),(0,r.jsx)(n.th,{children:"tenant_id"}),(0,r.jsx)(n.th,{children:"country_code"}),(0,r.jsx)(n.th,{children:"allowed_event_types"}),(0,r.jsx)(n.th,{children:"event_retention_days"}),(0,r.jsx)(n.th,{children:"max_payload_size"}),(0,r.jsx)(n.th,{children:"allowed_sources"}),(0,r.jsx)(n.th,{children:"preferences"}),(0,r.jsx)(n.th,{children:"is_active"}),(0,r.jsx)(n.th,{children:"created_at"}),(0,r.jsx)(n.th,{children:"updated_at"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"7a8b9c0d-1e2f-3a4b-5c6d-7e8f9a0b1c2d"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"tenant-pe"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"PE"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'["tracking","sita"]'})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"365"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1048576"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'["appPeru","sitaGW"]'})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'{"idioma":"es"}'})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2025-08-13T07:00:00Z"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2025-08-13T07:00:00Z"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"8b9c0d1e-2f3a-4b5c-6d7e-8f9a0b1c2d3e"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"tenant-ec"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"EC"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'["tracking"]'})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"180"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"524288"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'["appEcuador"]'})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'{"idioma":"en"}'})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2025-08-13T07:30:00Z"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2025-08-13T07:30:00Z"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"tabla-event_store",children:"Tabla: event_store"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Tipo"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"}),(0,r.jsx)(n.th,{children:"Restricciones"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"id"}),(0,r.jsx)(n.td,{children:"UUID"}),(0,r.jsx)(n.td,{children:"Identificador \xfanico de evento"}),(0,r.jsx)(n.td,{children:"PRIMARY KEY"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"tenant_id"}),(0,r.jsx)(n.td,{children:"VARCHAR(50)"}),(0,r.jsx)(n.td,{children:"Identificador del tenant"}),(0,r.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"correlation_id"}),(0,r.jsx)(n.td,{children:"VARCHAR(100)"}),(0,r.jsx)(n.td,{children:"ID de correlaci\xf3n"}),(0,r.jsx)(n.td,{children:"NULL, INDEX"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"aggregate_id"}),(0,r.jsx)(n.td,{children:"UUID"}),(0,r.jsx)(n.td,{children:"ID de la entidad agregada"}),(0,r.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"event_type"}),(0,r.jsx)(n.td,{children:"VARCHAR(100)"}),(0,r.jsx)(n.td,{children:"Tipo de evento"}),(0,r.jsx)(n.td,{children:"NOT NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"payload"}),(0,r.jsx)(n.td,{children:"JSONB"}),(0,r.jsx)(n.td,{children:"Datos del evento"}),(0,r.jsx)(n.td,{children:"NOT NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"timestamp"}),(0,r.jsx)(n.td,{children:"TIMESTAMP"}),(0,r.jsx)(n.td,{children:"Fecha de ocurrencia"}),(0,r.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"created_at"}),(0,r.jsx)(n.td,{children:"TIMESTAMP"}),(0,r.jsx)(n.td,{children:"Fecha y hora de creaci\xf3n del registro"}),(0,r.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"updated_at"}),(0,r.jsx)(n.td,{children:"TIMESTAMP"}),(0,r.jsx)(n.td,{children:"Fecha y hora de \xfaltima actualizaci\xf3n"}),(0,r.jsx)(n.td,{children:"NULL"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"tabla-trace_views",children:"Tabla: trace_views"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Tipo"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"}),(0,r.jsx)(n.th,{children:"Restricciones"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"id"}),(0,r.jsx)(n.td,{children:"UUID"}),(0,r.jsx)(n.td,{children:"Identificador \xfanico"}),(0,r.jsx)(n.td,{children:"PRIMARY KEY"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"tenant_id"}),(0,r.jsx)(n.td,{children:"VARCHAR(50)"}),(0,r.jsx)(n.td,{children:"Identificador del tenant"}),(0,r.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"correlation_id"}),(0,r.jsx)(n.td,{children:"VARCHAR(100)"}),(0,r.jsx)(n.td,{children:"ID de correlaci\xf3n"}),(0,r.jsx)(n.td,{children:"NULL, INDEX"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"view_type"}),(0,r.jsx)(n.td,{children:"VARCHAR(100)"}),(0,r.jsx)(n.td,{children:"Tipo de vista"}),(0,r.jsx)(n.td,{children:"NOT NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"data"}),(0,r.jsx)(n.td,{children:"JSONB"}),(0,r.jsx)(n.td,{children:"Datos optimizados para consulta"}),(0,r.jsx)(n.td,{children:"NOT NULL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"created_at"}),(0,r.jsx)(n.td,{children:"TIMESTAMP"}),(0,r.jsx)(n.td,{children:"Fecha y hora de creaci\xf3n del registro"}),(0,r.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"updated_at"}),(0,r.jsx)(n.td,{children:"TIMESTAMP"}),(0,r.jsx)(n.td,{children:"\xdaltima actualizaci\xf3n"}),(0,r.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"ejemplo-de-contenido-y-actualizaci\xf3n-de-trace-view-para-trazabilidad",children:"Ejemplo de contenido y actualizaci\xf3n de trace view para trazabilidad"}),"\n",(0,r.jsxs)(n.p,{children:["El campo ",(0,r.jsx)(n.code,{children:"data"})," en la tabla ",(0,r.jsx)(n.code,{children:"trace_views"})," almacena la informaci\xf3n agregada y optimizada para cada correlaci\xf3n. Por ejemplo:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "correlation_id": "ABC123",\n  "status": "en_transito",\n  "events": [\n    { "event_type": "checked_in", "timestamp": "2025-09-11T08:00:00Z", "location": "LIM" },\n    { "event_type": "loaded", "timestamp": "2025-09-11T08:30:00Z", "location": "LIM" },\n    { "event_type": "arrived", "timestamp": "2025-09-11T09:15:00Z", "location": "JFK" }\n  ]\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Cada vez que llega un nuevo evento para el ",(0,r.jsx)(n.code,{children:"correlation_id"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["El Event Processor procesa el evento y lo agrega al arreglo ",(0,r.jsx)(n.code,{children:"events"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["El campo ",(0,r.jsx)(n.code,{children:"status"})," se actualiza seg\xfan el \xfaltimo evento relevante."]}),"\n",(0,r.jsxs)(n.li,{children:["El registro en la tabla ",(0,r.jsx)(n.code,{children:"trace_views"})," se actualiza con el nuevo JSON."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ejemplo de actualizaci\xf3n:"})}),"\n",(0,r.jsx)(n.p,{children:"Si llega un evento:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{ "event_type": "delivered", "timestamp": "2025-09-11T10:00:00Z", "location": "JFK" }\n'})}),"\n",(0,r.jsx)(n.p,{children:"El JSON actualizado ser\xeda:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "correlation_id": "ABC123",\n  "status": "delivered",\n  "events": [\n    { "event_type": "checked_in", "timestamp": "2025-09-11T08:00:00Z", "location": "LIM" },\n    { "event_type": "loaded", "timestamp": "2025-09-11T08:30:00Z", "location": "LIM" },\n    { "event_type": "arrived", "timestamp": "2025-09-11T09:15:00Z", "location": "JFK" },\n    { "event_type": "delivered", "timestamp": "2025-09-11T10:00:00Z", "location": "JFK" }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"54-endpoints-principales",children:"5.4 Endpoints principales"}),"\n",(0,r.jsx)(n.h3,{id:"endpoints-de-tracking-ingest-api",children:"Endpoints de Tracking Ingest API"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"POST"})," ",(0,r.jsx)(n.code,{children:"/api/v1/events"}),": Ingesta de eventos operacionales (tracking, sita, etc.)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GET"})," ",(0,r.jsx)(n.code,{children:"/api/v1/events/health"}),": Estado de salud del API de ingesta"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GET"})," ",(0,r.jsx)(n.code,{children:"/api/v1/events/metrics"}),": M\xe9tricas de ingesta y procesamiento"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"endpoints-de-tracking-query-api",children:"Endpoints de Tracking Query API"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GET"})," ",(0,r.jsx)(n.code,{children:"/api/v1/trace/{correlationId}"}),": Consulta de trazabilidad por correlaci\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GET"})," ",(0,r.jsx)(n.code,{children:"/api/v1/trace?aggregateId={aggregateId}"}),": Consulta de historial por entidad agregada"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GET"})," ",(0,r.jsx)(n.code,{children:"/api/v1/trace/health"}),": Estado de salud del API de consulta"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GET"})," ",(0,r.jsx)(n.code,{children:"/api/v1/trace/metrics"}),": M\xe9tricas de consulta y uso"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"55-contratos-de-entrada-y-salida",children:"5.5 Contratos de entrada y salida"}),"\n",(0,r.jsx)(n.h3,{id:"contrato-de-entrada-eventrequest-tracking-ingest-api",children:"Contrato de entrada: EventRequest (Tracking Ingest API)"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Campo"}),(0,r.jsx)(n.th,{children:"Tipo"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"tenant_id"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Identificador del tenant"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"correlation_id"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"ID de correlaci\xf3n"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"aggregate_id"}),(0,r.jsx)(n.td,{children:"UUID"}),(0,r.jsx)(n.td,{children:"ID de la entidad agregada"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"event_type"}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Tipo de evento (tracking, sita, etc.)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"timestamp"}),(0,r.jsx)(n.td,{children:"string (ISO 8601)"}),(0,r.jsx)(n.td,{children:"Fecha de ocurrencia"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"payload"}),(0,r.jsx)(n.td,{children:"objeto"}),(0,r.jsx)(n.td,{children:"Datos del evento"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ejemplo de solicitud:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "tenant_id": "talma-pe",\n    "correlation_id": "ABC123",\n    "aggregate_id": "BAG001",\n    "event_type": "tracking_arrived",\n    "timestamp": "2025-09-11T09:15:00Z",\n    "payload": {\n        "location": "JFK",\n        "operator": "Juan Perez"\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Respuesta exitosa:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "status": "success",\n    "data": {\n        "event_id": "ev_7a8b9c0d-1e2f-3a4b-5c6d-7e8f9a0b1c2d",\n        "aggregate_id": "BAG001",\n        "event_type": "tracking_arrived",\n        "processed_at": "2025-09-11T09:15:30Z"\n    },\n    "meta": {\n        "timestamp": "2025-09-11T09:15:30Z"\n    },\n    "trace_id": "track_abc123-def456-789012"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"contrato-de-salida-traceresponse-tracking-query-api",children:"Contrato de salida: TraceResponse (Tracking Query API)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Endpoint:"})," ",(0,r.jsx)(n.code,{children:"GET /api/v1/trace/{aggregate_id}"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Respuesta exitosa:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "status": "success",\n    "data": {\n        "tenant_id": "talma-pe",\n        "correlation_id": "ABC123",\n        "aggregate_id": "BAG001",\n        "status": "arrived",\n        "events": [\n            {\n                "event_id": "ev_1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",\n                "event_type": "checked_in",\n                "timestamp": "2025-09-11T08:00:00Z",\n                "payload": {\n                    "location": "LIM",\n                    "operator": "Maria Garcia"\n                }\n            },\n            {\n                "event_id": "ev_2b3c4d5e-6f7a-8b9c-0d1e-2f3a4b5c6d7e",\n                "event_type": "loaded",\n                "timestamp": "2025-09-11T08:30:00Z",\n                "payload": {\n                    "location": "LIM",\n                    "flight": "LA2001"\n                }\n            },\n            {\n                "event_id": "ev_3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f",\n                "event_type": "arrived",\n                "timestamp": "2025-09-11T09:15:00Z",\n                "payload": {\n                    "location": "JFK",\n                    "operator": "Juan Perez"\n                }\n            }\n        ]\n    },\n    "meta": {\n        "timestamp": "2025-09-11T09:16:00Z",\n        "pagination": {\n            "page": 1,\n            "per_page": 50,\n            "total": 3,\n            "total_pages": 1\n        }\n    },\n    "links": {\n        "self": "/api/v1/trace/BAG001",\n        "related": "/api/v1/trace/BAG001/timeline"\n    },\n    "trace_id": "query_def789-abc012-345678"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Respuesta de error (agregado no encontrado):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "status": "error",\n    "error": {\n        "code": "AGGREGATE_NOT_FOUND",\n        "message": "No se encontraron eventos para el identificador especificado",\n        "details": [\n            {\n                "field": "aggregate_id",\n                "issue": "No se encontr\xf3 ning\xfan evento con el identificador \'BAG999\'"\n            }\n        ]\n    },\n    "meta": {\n        "timestamp": "2025-09-11T09:16:00Z"\n    },\n    "trace_id": "query_error_ghi345-jkl678-901234"\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},86058:(e,n,d)=>{d.d(n,{A:()=>i});const i=d.p+"assets/images/track_and_trace_system-43d88981ed6699c163bea36e401bc429.png"}}]);