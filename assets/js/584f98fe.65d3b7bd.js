"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[4942],{28453:(e,i,n)=>{n.d(i,{R:()=>s,x:()=>c});var a=n(96540);const t={},r=a.createContext(t);function s(e){const i=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),a.createElement(r.Provider,{value:i},e.children)}},39361:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"servicios-corporativos/api-gateway/vista-tiempo-ejecucion","title":"6. Vista de tiempo de ejecuci\xf3n","description":"6.1 Escenarios principales","source":"@site/docs/servicios-corporativos/api-gateway/06-vista-tiempo-ejecucion.md","sourceDirName":"servicios-corporativos/api-gateway","slug":"/servicios-corporativos/api-gateway/vista-tiempo-ejecucion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/api-gateway/vista-tiempo-ejecucion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/api-gateway/06-vista-tiempo-ejecucion.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"5. Vista de bloques de construcci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/api-gateway/vista-bloques-construccion"},"next":{"title":"7. Vista de implementaci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/api-gateway/vista-implementacion"}}');var t=n(74848),r=n(28453);const s={},c="6. Vista de tiempo de ejecuci\xf3n",d={},o=[{value:"6.1 Escenarios principales",id:"61-escenarios-principales",level:2},{value:"6.2 Flujos de interacci\xf3n y patrones",id:"62-flujos-de-interacci\xf3n-y-patrones",level:2},{value:"6.3 Ejemplos de ejecuci\xf3n (diagramas de secuencia)",id:"63-ejemplos-de-ejecuci\xf3n-diagramas-de-secuencia",level:2},{value:"6.3.1 Flujo de autenticaci\xf3n y enrutamiento",id:"631-flujo-de-autenticaci\xf3n-y-enrutamiento",level:3},{value:"6.3.2 Health check y circuit breaker",id:"632-health-check-y-circuit-breaker",level:3},{value:"6.3.3 Rate limiting distribuido",id:"633-rate-limiting-distribuido",level:3},{value:"6.3.4 Failover autom\xe1tico y degradaci\xf3n",id:"634-failover-autom\xe1tico-y-degradaci\xf3n",level:3},{value:"6.3.5 Multi-tenancy y routing inteligente",id:"635-multi-tenancy-y-routing-inteligente",level:3},{value:"6.3.6 Observabilidad y monitoreo",id:"636-observabilidad-y-monitoreo",level:3},{value:"6.4 Objetivos de rendimiento y SLA",id:"64-objetivos-de-rendimiento-y-sla",level:2},{value:"6.5 Manejo de errores y resiliencia",id:"65-manejo-de-errores-y-resiliencia",level:2}];function l(e){const i={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"6-vista-de-tiempo-de-ejecuci\xf3n",children:"6. Vista de tiempo de ejecuci\xf3n"})}),"\n",(0,t.jsx)(i.h2,{id:"61-escenarios-principales",children:"6.1 Escenarios principales"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Escenario"}),(0,t.jsx)(i.th,{children:"Flujo principal"}),(0,t.jsx)(i.th,{children:"Componentes involucrados"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Proxy request"})}),(0,t.jsx)(i.td,{children:"Cliente \u2192 Gateway \u2192 Backend"}),(0,t.jsxs)(i.td,{children:[(0,t.jsx)(i.code,{children:"YARP"}),", ",(0,t.jsx)(i.code,{children:"ALB"}),", ",(0,t.jsx)(i.code,{children:".NET 8"})]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Autenticaci\xf3n"})}),(0,t.jsx)(i.td,{children:"JWT validation \u2192 Claims"}),(0,t.jsxs)(i.td,{children:[(0,t.jsx)(i.code,{children:"Auth Middleware"}),", ",(0,t.jsx)(i.code,{children:"Keycloak"})]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Rate limiting"})}),(0,t.jsx)(i.td,{children:"Request \u2192 Redis \u2192 Allow/Deny"}),(0,t.jsxs)(i.td,{children:[(0,t.jsx)(i.code,{children:"Rate Limiter"}),", ",(0,t.jsx)(i.code,{children:"Redis"})]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Circuit breaker"})}),(0,t.jsx)(i.td,{children:"Proxy \u2192 Polly \u2192 Servicio/Fallback"}),(0,t.jsxs)(i.td,{children:[(0,t.jsx)(i.code,{children:"Polly"}),", ",(0,t.jsx)(i.code,{children:"YARP"})]})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Observabilidad"})}),(0,t.jsx)(i.td,{children:"Request \u2192 Logging/Metrics/Tracing"}),(0,t.jsxs)(i.td,{children:[(0,t.jsx)(i.code,{children:"Serilog"}),", ",(0,t.jsx)(i.code,{children:"Loki"}),", ",(0,t.jsx)(i.code,{children:"Prometheus"}),", ",(0,t.jsx)(i.code,{children:"Jaeger"})]})]})]})]}),"\n",(0,t.jsx)(i.h2,{id:"62-flujos-de-interacci\xf3n-y-patrones",children:"6.2 Flujos de interacci\xf3n y patrones"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Autenticaci\xf3n y enrutamiento"}),": El gateway valida el token ",(0,t.jsx)(i.code,{children:"JWT"})," (cache en ",(0,t.jsx)(i.code,{children:"Redis"}),"), resuelve el contexto de ",(0,t.jsx)(i.code,{children:"tenant"}),", aplica ",(0,t.jsx)(i.code,{children:"rate limiting"})," y enruta la solicitud al backend correspondiente, enriqueciendo los headers con informaci\xf3n de tenant y usuario."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Health checks y circuit breaker"}),": Monitoreo activo de instancias, apertura/cierre de circuitos y failover autom\xe1tico entre instancias saludables."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Rate limiting distribuido"}),": Ventana deslizante de 1 minuto, sincronizaci\xf3n entre instancias v\xeda ",(0,t.jsx)(i.code,{children:"Redis"}),", headers est\xe1ndar de rate limit en la respuesta."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Failover y degradaci\xf3n"}),": Switchover autom\xe1tico ante fallos, degradaci\xf3n controlada bajo sobrecarga, priorizaci\xf3n de clientes premium."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Multi-tenancy"}),": Resoluci\xf3n de tenant v\xeda claims ",(0,t.jsx)(i.code,{children:"JWT"}),", ",(0,t.jsx)(i.code,{children:"API Key"}),", subdominio o query param; routing inteligente por tier y pa\xeds."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Observabilidad"}),": Trazabilidad distribuida (",(0,t.jsx)(i.code,{children:"Jaeger"}),"), m\xe9tricas en tiempo real (",(0,t.jsx)(i.code,{children:"Prometheus"}),"), logs estructurados (",(0,t.jsx)(i.code,{children:"Loki"}),"), dashboards y alertas (",(0,t.jsx)(i.code,{children:"Grafana"}),")."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"63-ejemplos-de-ejecuci\xf3n-diagramas-de-secuencia",children:"6.3 Ejemplos de ejecuci\xf3n (diagramas de secuencia)"}),"\n",(0,t.jsx)(i.h3,{id:"631-flujo-de-autenticaci\xf3n-y-enrutamiento",children:"6.3.1 Flujo de autenticaci\xf3n y enrutamiento"}),"\n",(0,t.jsx)(i.mermaid,{value:"sequenceDiagram\n    participant Client as Cliente Web/Mobile\n    participant Gateway as API Gateway\n    participant Auth as Identity Service\n    participant Service as Target Service\n    participant Redis as Redis Cache\n    Client->>Gateway: Request con token JWT\n    Gateway->>Redis: Verificar token en cache\n    alt Token en cache\n        Redis->>Gateway: Token v\xe1lido\n    else Token no en cache\n        Gateway->>Auth: Validar token\n        Auth->>Gateway: Resultado validaci\xf3n\n        Gateway->>Redis: Cachear token\n    end\n    Gateway->>Gateway: Resolver tenant y aplicar rate limiting\n    Gateway->>Service: Forward con headers enriquecidos\n    Service->>Gateway: Response\n    Gateway->>Client: Response con headers de rate limit"}),"\n",(0,t.jsx)(i.h3,{id:"632-health-check-y-circuit-breaker",children:"6.3.2 Health check y circuit breaker"}),"\n",(0,t.jsx)(i.mermaid,{value:"sequenceDiagram\n    participant Monitor as Health Monitor\n    participant Gateway as API Gateway\n    participant Service1 as Service Instance 1\n    participant Service2 as Service Instance 2\n    participant Circuit as Circuit Breaker\n    loop Cada 30s\n        Monitor->>Service1: Health check\n        Monitor->>Service2: Health check\n        alt Healthy\n            Service1->>Monitor: 200 OK\n        else Unhealthy\n            Service2->>Monitor: 500/Error\n            Monitor->>Circuit: Open circuit\n        end\n    end\n    Gateway->>Circuit: Check state\n    Circuit->>Gateway: Circuit OPEN\n    Gateway->>Service1: Route only to healthy"}),"\n",(0,t.jsx)(i.h3,{id:"633-rate-limiting-distribuido",children:"6.3.3 Rate limiting distribuido"}),"\n",(0,t.jsx)(i.mermaid,{value:"sequenceDiagram\n    participant Client as Cliente\n    participant Gateway1 as Gateway 1\n    participant Gateway2 as Gateway 2\n    participant Redis as Redis\n    Client->>Gateway1: Request\n    Gateway1->>Redis: INCR rate_limit\n    Redis->>Gateway1: Counter\n    Gateway1->>Client: 200 OK\n    Client->>Gateway2: Request\n    Gateway2->>Redis: INCR rate_limit\n    Redis->>Gateway2: Counter\n    Gateway2->>Client: 200 OK\n    Note over Gateway1,Redis: Al superar l\xedmite\n    Gateway1->>Client: 429 Too Many Requests"}),"\n",(0,t.jsx)(i.h3,{id:"634-failover-autom\xe1tico-y-degradaci\xf3n",children:"6.3.4 Failover autom\xe1tico y degradaci\xf3n"}),"\n",(0,t.jsx)(i.mermaid,{value:"sequenceDiagram\n    participant Client as Cliente\n    participant Gateway as API Gateway\n    participant Primary as Servicio Primario\n    participant Secondary as Servicio Secundario\n    participant Monitor as Health Monitor\n    Client->>Gateway: Request\n    Gateway->>Primary: Forward\n    Primary->>Gateway: Response\n    Gateway->>Client: Response\n    Note over Primary: Falla\n    Monitor->>Gateway: Mark primary unhealthy\n    Gateway->>Secondary: Forward\n    Secondary->>Gateway: Response\n    Gateway->>Client: Response"}),"\n",(0,t.jsx)(i.h3,{id:"635-multi-tenancy-y-routing-inteligente",children:"6.3.5 Multi-tenancy y routing inteligente"}),"\n",(0,t.jsx)(i.mermaid,{value:"sequenceDiagram\n    participant ClientA as Tenant Premium\n    participant ClientB as Tenant Standard\n    participant Gateway as API Gateway\n    participant PremiumService as Premium Instance\n    participant StandardService as Standard Instance\n    ClientA->>Gateway: Request (premium)\n    Gateway->>PremiumService: Route\n    PremiumService->>Gateway: Response\n    Gateway->>ClientA: Response\n    ClientB->>Gateway: Request (standard)\n    Gateway->>StandardService: Route\n    StandardService->>Gateway: Response\n    Gateway->>ClientB: Response"}),"\n",(0,t.jsx)(i.h3,{id:"636-observabilidad-y-monitoreo",children:"6.3.6 Observabilidad y monitoreo"}),"\n",(0,t.jsx)(i.mermaid,{value:"sequenceDiagram\n    participant Gateway as API Gateway\n    participant Metrics as Metrics Collector\n    participant Prometheus as Prometheus\n    participant Grafana as Grafana\n    participant Loki as Loki\n    participant Jaeger as Jaeger\n    Gateway->>Metrics: Record metrics\n    Gateway->>Loki: Log request\n    Gateway->>Jaeger: Trace span\n    Metrics->>Prometheus: Scrape\n    Grafana->>Prometheus: Query\n    Grafana->>Loki: Query logs\n    Grafana->>Jaeger: Query traces"}),"\n",(0,t.jsx)(i.h2,{id:"64-objetivos-de-rendimiento-y-sla",children:"6.4 Objetivos de rendimiento y SLA"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Operaci\xf3n"}),(0,t.jsx)(i.th,{children:"Target"}),(0,t.jsx)(i.th,{children:"Timeout"}),(0,t.jsx)(i.th,{children:"SLA"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Token validation (cache)"})}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"< 10ms"})}),(0,t.jsx)(i.td,{children:"100ms"}),(0,t.jsx)(i.td,{children:"99.9%"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Token validation (fresh)"})}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"< 100ms"})}),(0,t.jsx)(i.td,{children:"500ms"}),(0,t.jsx)(i.td,{children:"99.5%"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Request routing"})}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"< 5ms"})}),(0,t.jsx)(i.td,{children:"50ms"}),(0,t.jsx)(i.td,{children:"99.9%"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Health check"})}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"< 200ms"})}),(0,t.jsx)(i.td,{children:"5s"}),(0,t.jsx)(i.td,{children:"95%"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Rate limit check"})}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"< 5ms"})}),(0,t.jsx)(i.td,{children:"100ms"}),(0,t.jsx)(i.td,{children:"99.9%"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Config reload"})}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"< 1s"})}),(0,t.jsx)(i.td,{children:"30s"}),(0,t.jsx)(i.td,{children:"99%"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Circuit breaker"})}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"< 100ms"})}),(0,t.jsx)(i.td,{children:"500ms"}),(0,t.jsx)(i.td,{children:"99%"})]})]})]}),"\n",(0,t.jsx)(i.h2,{id:"65-manejo-de-errores-y-resiliencia",children:"6.5 Manejo de errores y resiliencia"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Timeout downstream"}),": 30s, 3 reintentos con backoff, circuit breaker tras 5 fallos, responde 504 con retry-after."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Identity service ca\xeddo"}),": Cache de tokens extendido 1h, solo requests con tokens v\xe1lidos, responde 503 para nuevas autenticaciones."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Degradaci\xf3n bajo carga"}),": Priorizaci\xf3n de clientes premium, cola para est\xe1ndar, 503 si no hay capacidad."]}),"\n"]}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsxs)(i.p,{children:["Todos los flujos y escenarios est\xe1n alineados a los patrones de arquitectura, ADRs y modelos de componentes definidos para el API Gateway. El monitoreo y la observabilidad se implementan con ",(0,t.jsx)(i.code,{children:"Grafana"}),", ",(0,t.jsx)(i.code,{children:"Prometheus"}),", ",(0,t.jsx)(i.code,{children:"Loki"})," y ",(0,t.jsx)(i.code,{children:"Jaeger"})," siguiendo las mejores pr\xe1cticas de la industria."]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);