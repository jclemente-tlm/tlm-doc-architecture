"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[4262],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var s=i(96540);const r={},a=s.createContext(r);function t(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(a.Provider,{value:n},e.children)}},50100:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"servicios-corporativos/servicio-track-trace/decisiones-arquitectura","title":"9. Decisiones de arquitectura","description":"9.1 Decisiones principales","source":"@site/docs/servicios-corporativos/servicio-track-trace/09-decisiones-arquitectura.md","sourceDirName":"servicios-corporativos/servicio-track-trace","slug":"/servicios-corporativos/servicio-track-trace/decisiones-arquitectura","permalink":"/docs/servicios-corporativos/servicio-track-trace/decisiones-arquitectura","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-track-trace/09-decisiones-arquitectura.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"8. Conceptos transversales","permalink":"/docs/servicios-corporativos/servicio-track-trace/conceptos-transversales"},"next":{"title":"10. Requisitos de calidad","permalink":"/docs/servicios-corporativos/servicio-track-trace/requisitos-calidad"}}');var r=i(74848),a=i(28453);const t={},c="9. Decisiones de arquitectura",d={},l=[{value:"9.1 Decisiones principales",id:"91-decisiones-principales",level:2},{value:"9.2 Alternativas evaluadas",id:"92-alternativas-evaluadas",level:2},{value:"9.1 ADR-001: Event Sourcing como patr\xf3n principal",id:"91-adr-001-event-sourcing-como-patr\xf3n-principal",level:2},{value:"Contexto",id:"contexto",level:3},{value:"Alternativas consideradas",id:"alternativas-consideradas",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n",level:3},{value:"Consecuencias",id:"consecuencias",level:3},{value:"9.2 ADR-002: PostgreSQL como Event Store",id:"92-adr-002-postgresql-como-event-store",level:2},{value:"Contexto",id:"contexto-1",level:3},{value:"Alternativas consideradas",id:"alternativas-consideradas-1",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-1",level:3},{value:"Implementaci\xf3n",id:"implementaci\xf3n",level:3},{value:"Consecuencias",id:"consecuencias-1",level:3},{value:"9.3 ADR-003: CQRS con Read Models especializados",id:"93-adr-003-cqrs-con-read-models-especializados",level:2},{value:"Contexto",id:"contexto-2",level:3},{value:"Alternativas consideradas",id:"alternativas-consideradas-2",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-1",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-2",level:3},{value:"Implementaci\xf3n",id:"implementaci\xf3n-1",level:3},{value:"Consecuencias",id:"consecuencias-2",level:3},{value:"9.6 ADR-006: Multi-tenant schema separation",id:"96-adr-006-multi-tenant-schema-separation",level:2},{value:"Contexto",id:"contexto-3",level:3},{value:"Alternativas consideradas",id:"alternativas-consideradas-3",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-2",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-3",level:3},{value:"Implementaci\xf3n",id:"implementaci\xf3n-2",level:3},{value:"Consecuencias",id:"consecuencias-3",level:3},{value:"9.7 ADR-007: Observabilidad con OpenTelemetry",id:"97-adr-007-observabilidad-con-opentelemetry",level:2},{value:"Contexto",id:"contexto-4",level:3},{value:"Alternativas consideradas",id:"alternativas-consideradas-4",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-3",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-4",level:3},{value:"Implementaci\xf3n",id:"implementaci\xf3n-3",level:3},{value:"Consecuencias",id:"consecuencias-4",level:3},{value:"9.8 Resumen de decisiones",id:"98-resumen-de-decisiones",level:2},{value:"9.9 Decisiones pendientes",id:"99-decisiones-pendientes",level:2},{value:"PND-001: Sharding strategy para escalamiento horizontal",id:"pnd-001-sharding-strategy-para-escalamiento-horizontal",level:3},{value:"PND-002: Event archiving policy para retenci\xf3n a largo plazo",id:"pnd-002-event-archiving-policy-para-retenci\xf3n-a-largo-plazo",level:3},{value:"PND-003: Schema evolution strategy para eventos",id:"pnd-003-schema-evolution-strategy-para-eventos",level:3},{value:"9.10 Lecciones aprendidas",id:"910-lecciones-aprendidas",level:2},{value:"\xc9xitos",id:"\xe9xitos",level:3},{value:"Desaf\xedos",id:"desaf\xedos",level:3},{value:"Ajustes realizados",id:"ajustes-realizados",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-5",level:3},{value:"Consecuencias",id:"consecuencias-5",level:3},{value:"9.3 ADR-003: CQRS con read models separados",id:"93-adr-003-cqrs-con-read-models-separados",level:2},{value:"Contexto",id:"contexto-5",level:3},{value:"Alternativas consideradas",id:"alternativas-consideradas-5",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-4",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-6",level:3},{value:"Implementaci\xf3n",id:"implementaci\xf3n-4",level:3},{value:"Consecuencias",id:"consecuencias-6",level:3},{value:"9.4 ADR-004: Event Store Agn\xf3stico para Event Streaming",id:"94-adr-004-event-store-agn\xf3stico-para-event-streaming",level:2},{value:"Contexto",id:"contexto-6",level:3},{value:"Alternativas consideradas",id:"alternativas-consideradas-6",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-5",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-7",level:3},{value:"Configuraci\xf3n",id:"configuraci\xf3n",level:3},{value:"Consecuencias",id:"consecuencias-7",level:3},{value:"9.5 ADR-005: Redis para caching distribuido",id:"95-adr-005-redis-para-caching-distribuido",level:2},{value:"Contexto",id:"contexto-7",level:3},{value:"Alternativas consideradas",id:"alternativas-consideradas-7",level:3},{value:"Decisi\xf3n",id:"decisi\xf3n-6",level:3},{value:"Justificaci\xf3n",id:"justificaci\xf3n-8",level:3},{value:"Estrategia de cache",id:"estrategia-de-cache",level:3},{value:"Consecuencias",id:"consecuencias-8",level:3},{value:"9.7 Resumen de decisiones",id:"97-resumen-de-decisiones",level:2},{value:"9.8 Decisiones pendientes",id:"98-decisiones-pendientes",level:2},{value:"PND-001: Sharding strategy para escalamiento",id:"pnd-001-sharding-strategy-para-escalamiento",level:3},{value:"PND-002: Archiving policy para event store",id:"pnd-002-archiving-policy-para-event-store",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"9-decisiones-de-arquitectura",children:"9. Decisiones de arquitectura"})}),"\n",(0,r.jsx)(n.h2,{id:"91-decisiones-principales",children:"9.1 Decisiones principales"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"ADR"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"}),(0,r.jsx)(n.th,{children:"Estado"}),(0,r.jsx)(n.th,{children:"Justificaci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ADR-001"})}),(0,r.jsx)(n.td,{children:"CQRS + Event Sourcing"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Trazabilidad inmutable"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ADR-002"})}),(0,r.jsx)(n.td,{children:"PostgreSQL event store"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Simplicidad inicial"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ADR-003"})}),(0,r.jsx)(n.td,{children:"Deduplicaci\xf3n por tenant"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Prevenci\xf3n duplicados"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"ADR-004"})}),(0,r.jsx)(n.td,{children:"Event-driven propagaci\xf3n"}),(0,r.jsx)(n.td,{children:"Aceptado"}),(0,r.jsx)(n.td,{children:"Integraci\xf3n SITA"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"92-alternativas-evaluadas",children:"9.2 Alternativas evaluadas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Componente"}),(0,r.jsx)(n.th,{children:"Alternativas"}),(0,r.jsx)(n.th,{children:"Selecci\xf3n"}),(0,r.jsx)(n.th,{children:"Raz\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Event Store"})}),(0,r.jsx)(n.td,{children:"EventStore, PostgreSQL, SNS+SQS"}),(0,r.jsx)(n.td,{children:"PostgreSQL"}),(0,r.jsx)(n.td,{children:"Simplicidad"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"API"})}),(0,r.jsx)(n.td,{children:"REST, GraphQL, gRPC"}),(0,r.jsx)(n.td,{children:"REST + GraphQL"}),(0,r.jsx)(n.td,{children:"Flexibilidad"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Deduplicaci\xf3n"})}),(0,r.jsx)(n.td,{children:"Global, Por tenant"}),(0,r.jsx)(n.td,{children:"Por tenant"}),(0,r.jsx)(n.td,{children:"Aislamiento"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Propagaci\xf3n"})}),(0,r.jsx)(n.td,{children:"S\xedncrona, As\xedncrona"}),(0,r.jsx)(n.td,{children:"As\xedncrona"}),(0,r.jsx)(n.td,{children:"Desacoplamiento"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"91-adr-001-event-sourcing-como-patr\xf3n-principal",children:"9.1 ADR-001: Event Sourcing como patr\xf3n principal"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Estado"}),": Aceptado\n",(0,r.jsx)(n.strong,{children:"Fecha"}),": 2024-01-15\n",(0,r.jsx)(n.strong,{children:"Decidido por"}),": Equipo de Arquitectura"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"El servicio Track & Trace requiere trazabilidad completa de eventos operacionales con capacidades de auditor\xeda robustas y an\xe1lisis temporal de patrones."}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas",children:"Alternativas consideradas"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CRUD tradicional con audit log"}),": Base de datos relacional con tabla de auditor\xeda"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Event Sourcing"}),": Almacenamiento de eventos como \xfanica fuente de verdad"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Hybrid approach"}),": CRUD principal + Event log secundario"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Adoptamos ",(0,r.jsx)(n.strong,{children:"Event Sourcing"})," como patr\xf3n arquitect\xf3nico principal."]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Auditor\xeda completa"}),": Cumplimiento con regulaciones que requieren trazabilidad total"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"An\xe1lisis temporal"}),": Capacidad de reconstruir estado en cualquier momento"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Escalabilidad de lectura"}),": Read models especializados para diferentes vistas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Debugging avanzado"}),": Replay de eventos para reproducir problemas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Analytics nativo"}),": Stream de eventos ideal para an\xe1lisis en tiempo real"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Auditabilidad, escalabilidad, flexibilidad anal\xedtica"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": Complejidad inicial, curva de aprendizaje, eventual consistency"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": Training del equipo, herramientas de debugging robustas"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"92-adr-002-postgresql-como-event-store",children:"9.2 ADR-002: PostgreSQL como Event Store"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Estado"}),": Aceptado\n",(0,r.jsx)(n.strong,{children:"Fecha"}),": 2024-01-20\n",(0,r.jsx)(n.strong,{children:"Decidido por"}),": Equipo de Arquitectura"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-1",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Necesidad de un almac\xe9n confiable y performante para eventos con soporte ACID y capacidades de consulta avanzadas."}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-1",children:"Alternativas consideradas"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PostgreSQL"}),": Base relacional con soporte JSONB, estrategia inicial"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SNS+SQS"}),": Escalabilidad managed AWS para vol\xfamenes medios"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RabbitMQ/Amazon MQ"}),": Event streaming robusto para alto volumen"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Event Store DB"}),": Base especializada en event sourcing (evaluaci\xf3n futura)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-1",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ACID compliance"}),": Transacciones consistentes para eventos cr\xedticos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JSONB support"}),": Flexibilidad para esquemas de eventos evolutivos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": \xcdndices GIN para consultas JSONB eficientes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Operaciones"}),": Expertise existente del equipo en PostgreSQL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Costos"}),": Licencia open source vs soluciones comerciales"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ecosystem"}),": Tooling maduro para backup, replicaci\xf3n, monitoring"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementaci\xf3n",children:"Implementaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Optimized event store schema\nCREATE TABLE events (\n    id BIGSERIAL PRIMARY KEY,\n    stream_id VARCHAR(255) NOT NULL,\n    version BIGINT NOT NULL,\n    event_type VARCHAR(255) NOT NULL,\n    event_data JSONB NOT NULL,\n    metadata JSONB,\n    timestamp TIMESTAMPTZ DEFAULT NOW(),\n    tenant_id VARCHAR(50) NOT NULL,\n\n    CONSTRAINT events_stream_version_unique UNIQUE (stream_id, version)\n);\n\n-- Performance indexes\nCREATE INDEX CONCURRENTLY idx_events_stream_id ON events (stream_id);\nCREATE INDEX CONCURRENTLY idx_events_timestamp ON events (timestamp);\nCREATE INDEX CONCURRENTLY idx_events_type ON events (event_type);\nCREATE INDEX CONCURRENTLY idx_events_tenant ON events (tenant_id);\n\n-- JSONB indexes for event data queries\nCREATE INDEX CONCURRENTLY idx_events_data_gin ON events USING GIN (event_data);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-1",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Confiabilidad, performance, conocimiento del equipo"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": Complejidad para sharding futuro, gesti\xf3n de crecimiento"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": Particionamento por fecha, archiving strategy, read replicas"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"93-adr-003-cqrs-con-read-models-especializados",children:"9.3 ADR-003: CQRS con Read Models especializados"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Estado"}),": Aceptado\n",(0,r.jsx)(n.strong,{children:"Fecha"}),": 2024-01-25\n",(0,r.jsx)(n.strong,{children:"Decidido por"}),": Equipo de Arquitectura"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-2",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Optimizaci\xf3n de consultas complejas y diferentes vistas de datos para casos de uso espec\xedficos como analytics y reporting."}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-2",children:"Alternativas consideradas"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consultas directas al Event Store"}),": Sin read models"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Vista materializada \xfanica"}),": Single read model gen\xe9rico"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Read models especializados"}),": Proyecciones por caso de uso"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Elasticsearch"}),": Search engine como read store"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-1",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Implementamos ",(0,r.jsx)(n.strong,{children:"CQRS con read models especializados"})," usando PostgreSQL y Redis."]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-2",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": Optimizaci\xf3n espec\xedfica por caso de uso"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Escalabilidad"}),": Read models independientes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Flexibilidad"}),": Nuevas vistas sin impactar existentes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Analytics"}),": Agregaciones pre-calculadas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User Experience"}),": Respuestas instant\xe1neas para consultas complejas"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementaci\xf3n-1",children:"Implementaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"// Timeline read model para trazabilidad\npublic class TimelineReadModel\n{\n    public string EntityId { get; set; }\n    public List<TimelineEvent> Events { get; set; }\n    public DateTime LastUpdated { get; set; }\n    public Dictionary<string, object> Aggregations { get; set; }\n}\n\n// Analytics read model para m\xe9tricas\npublic class AnalyticsReadModel\n{\n    public string Period { get; set; }\n    public int EventCount { get; set; }\n    public TimeSpan AverageProcessingTime { get; set; }\n    public Dictionary<string, int> EventTypeDistribution { get; set; }\n}\n\n// Projection engine\npublic class ProjectionManager\n{\n    public async Task HandleEventAsync(IDomainEvent @event)\n    {\n        var projections = _projectionRegistry.GetProjectionsForEvent(@event.GetType());\n\n        foreach (var projection in projections)\n        {\n            await projection.HandleAsync(@event);\n            await _readModelStore.SaveAsync(projection);\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-2",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Performance excelente, flexibilidad, escalabilidad"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": Complejidad adicional, eventual consistency"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": Health checks de projections, rebuild autom\xe1tico"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"96-adr-006-multi-tenant-schema-separation",children:"9.6 ADR-006: Multi-tenant schema separation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Estado"}),": Aceptado\n",(0,r.jsx)(n.strong,{children:"Fecha"}),": 2024-02-10\n",(0,r.jsx)(n.strong,{children:"Decidido por"}),": Equipo de Arquitectura + Security"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-3",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Aislamiento completo de datos entre tenants para compliance y security, con diferentes niveles de servicio por cliente."}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-3",children:"Alternativas consideradas"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single schema con tenant_id"}),": Row-level security"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Schema per tenant"}),": Separaci\xf3n a nivel de schema"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database per tenant"}),": Base de datos dedicada por tenant"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service per tenant"}),": Instancia de servicio dedicada"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-2",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Implementamos ",(0,r.jsx)(n.strong,{children:"Schema per tenant"})," en PostgreSQL con tenant context injection."]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-3",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Aislamiento"}),": Separaci\xf3n f\xedsica de datos garantizada"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": \xcdndices y optimizaciones espec\xedficas por tenant"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compliance"}),": Cumplimiento con regulaciones de aislamiento de datos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backup"}),": Estrategias diferenciadas por criticidad del cliente"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Scaling"}),": Facilita sharding futuro por tenant"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cost-effectiveness"}),": Balance entre aislamiento y recursos"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementaci\xf3n-2",children:"Implementaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Dynamic schema creation script\nCREATE SCHEMA IF NOT EXISTS tenant_${tenantId};\n\n-- Tenant-specific event table\nCREATE TABLE tenant_${tenantId}.events (\n    stream_id VARCHAR(255) NOT NULL,\n    version BIGINT NOT NULL,\n    event_type VARCHAR(255) NOT NULL,\n    event_data JSONB NOT NULL,\n    metadata JSONB,\n    timestamp TIMESTAMPTZ DEFAULT NOW(),\n    PRIMARY KEY (stream_id, version)\n);\n\n-- Tenant-specific read model tables\nCREATE TABLE tenant_${tenantId}.timeline_view (\n    entity_id VARCHAR(255) PRIMARY KEY,\n    timeline_data JSONB NOT NULL,\n    last_updated TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Optimized indexes per tenant\nCREATE INDEX idx_events_timestamp ON tenant_${tenantId}.events(timestamp);\nCREATE INDEX idx_events_type ON tenant_${tenantId}.events(event_type);\nCREATE INDEX idx_timeline_updated ON tenant_${tenantId}.timeline_view(last_updated);\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'// Tenant context injection\npublic class TenantAwareDbContext : DbContext\n{\n    private readonly ITenantContext _tenantContext;\n\n    protected override void OnModelCreating(ModelBuilder modelBuilder)\n    {\n        var schema = $"tenant_{_tenantContext.TenantId}";\n\n        modelBuilder.Entity<Event>().ToTable("events", schema);\n        modelBuilder.Entity<TimelineView>().ToTable("timeline_view", schema);\n\n        base.OnModelCreating(modelBuilder);\n    }\n}\n\n// Tenant middleware\npublic class TenantResolutionMiddleware\n{\n    public async Task InvokeAsync(HttpContext context, RequestDelegate next)\n    {\n        var tenantId = ExtractTenantId(context);\n\n        if (string.IsNullOrEmpty(tenantId))\n        {\n            context.Response.StatusCode = 400;\n            await context.Response.WriteAsync("Tenant ID required");\n            return;\n        }\n\n        context.Items["TenantId"] = tenantId;\n        await next(context);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-3",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Aislamiento total, performance optimizada, compliance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": Gesti\xf3n compleja de schemas, migraciones complejas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": Automatizaci\xf3n de setup, scripts de migraci\xf3n versionados"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"97-adr-007-observabilidad-con-opentelemetry",children:"9.7 ADR-007: Observabilidad con OpenTelemetry"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Estado"}),": Aceptado\n",(0,r.jsx)(n.strong,{children:"Fecha"}),": 2024-02-15\n",(0,r.jsx)(n.strong,{children:"Decidido por"}),": Equipo de Arquitectura + SRE"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-4",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Necesidad de observabilidad completa en arquitectura distribuida con correlaci\xf3n de eventos entre servicios."}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-4",children:"Alternativas consideradas"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Application Insights"}),": Azure native monitoring"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Datadog"}),": Comprehensive monitoring platform"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"OpenTelemetry + ELK"}),": Open source stack"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prometheus + Grafana"}),": Metrics-focused approach"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-3",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Adoptamos ",(0,r.jsx)(n.strong,{children:"OpenTelemetry"})," con Jaeger, Prometheus y ELK stack."]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-4",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Vendor neutrality"}),": Est\xe1ndar abierto, sin lock-in"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Comprehensive"}),": Traces, metrics, logs unified"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Correlation"}),": Distributed tracing con correlation IDs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ecosystem"}),": Compatible con m\xfaltiples backends"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Future-proof"}),": Est\xe1ndar en evoluci\xf3n de CNCF"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementaci\xf3n-3",children:"Implementaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'// OpenTelemetry configuration\nservices.AddOpenTelemetry()\n    .WithTracing(builder =>\n    {\n        builder\n            .AddSource("TrackTrace")\n            .SetSampler(new AlwaysOnSampler())\n            .AddAspNetCoreInstrumentation()\n            .AddHttpClientInstrumentation()\n            .AddNpgsqlInstrumentation()\n            .AddJaegerExporter();\n    })\n    .WithMetrics(builder =>\n    {\n        builder\n            .AddMeter("TrackTrace")\n            .AddAspNetCoreInstrumentation()\n            .AddPrometheusExporter();\n    });\n\n// Custom activity source\nprivate static readonly ActivitySource ActivitySource = new("TrackTrace");\n\npublic async Task<T> ProcessEventWithTracing<T>(IDomainEvent @event, Func<Task<T>> handler)\n{\n    using var activity = ActivitySource.StartActivity($"process-{@event.GetType().Name}");\n    activity?.SetTag("event.type", @event.GetType().Name);\n    activity?.SetTag("event.stream", @event.StreamId);\n    activity?.SetTag("tenant.id", @event.TenantId);\n\n    try\n    {\n        return await handler();\n    }\n    catch (Exception ex)\n    {\n        activity?.SetStatus(ActivityStatusCode.Error, ex.Message);\n        throw;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-4",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Observabilidad completa, debugging eficiente, performance insights"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": Overhead de instrumentaci\xf3n, complejidad de setup"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": Sampling inteligente, monitoring de overhead"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"98-resumen-de-decisiones",children:"9.8 Resumen de decisiones"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"ADR"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"}),(0,r.jsx)(n.th,{children:"Impacto"}),(0,r.jsx)(n.th,{children:"Estado"}),(0,r.jsx)(n.th,{children:"Riesgo"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"001"}),(0,r.jsx)(n.td,{children:"Event Sourcing"}),(0,r.jsx)(n.td,{children:"\ud83d\udd34 Alto - Arquitectura fundamental"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"}),(0,r.jsx)(n.td,{children:"Bajo"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"002"}),(0,r.jsx)(n.td,{children:"PostgreSQL Event Store"}),(0,r.jsx)(n.td,{children:"\ud83d\udd34 Alto - Storage principal"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"}),(0,r.jsx)(n.td,{children:"Bajo"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"003"}),(0,r.jsx)(n.td,{children:"CQRS Read Models"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Medio - Performance"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"}),(0,r.jsx)(n.td,{children:"Bajo"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"004"}),(0,r.jsx)(n.td,{children:"Kafka Streaming"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Medio - Integration"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"}),(0,r.jsx)(n.td,{children:"Medio"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"005"}),(0,r.jsx)(n.td,{children:"Redis Caching"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe2 Bajo - Optimization"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"}),(0,r.jsx)(n.td,{children:"Bajo"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"006"}),(0,r.jsx)(n.td,{children:"Multi-tenant Schema"}),(0,r.jsx)(n.td,{children:"\ud83d\udd34 Alto - Security/Compliance"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"}),(0,r.jsx)(n.td,{children:"Medio"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"007"}),(0,r.jsx)(n.td,{children:"OpenTelemetry"}),(0,r.jsx)(n.td,{children:"\ud83d\udfe1 Medio - Observability"}),(0,r.jsx)(n.td,{children:"\ud83d\udea7 En progreso"}),(0,r.jsx)(n.td,{children:"Bajo"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"99-decisiones-pendientes",children:"9.9 Decisiones pendientes"}),"\n",(0,r.jsx)(n.h3,{id:"pnd-001-sharding-strategy-para-escalamiento-horizontal",children:"PND-001: Sharding strategy para escalamiento horizontal"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Contexto"}),": Crecimiento proyectado requiere distribuci\xf3n m\xe1s all\xe1 de single instance\n",(0,r.jsx)(n.strong,{children:"Opciones bajo evaluaci\xf3n"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Shard por tenant (isolation benefits)"}),"\n",(0,r.jsx)(n.li,{children:"Shard por tiempo (archiving natural)"}),"\n",(0,r.jsxs)(n.li,{children:["Shard por hash de entity (distribuci\xf3n uniforme)\n",(0,r.jsx)(n.strong,{children:"Criterios de decisi\xf3n"}),": Volume projections, query patterns, operational complexity\n",(0,r.jsx)(n.strong,{children:"Target decisi\xf3n"}),": Q2 2024\n",(0,r.jsx)(n.strong,{children:"Owner"}),": Equipo de Arquitectura"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"pnd-002-event-archiving-policy-para-retenci\xf3n-a-largo-plazo",children:"PND-002: Event archiving policy para retenci\xf3n a largo plazo"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Contexto"}),": Balance entre compliance requirements y storage costs\n",(0,r.jsx)(n.strong,{children:"Opciones bajo evaluaci\xf3n"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cold storage en S3 Glacier despu\xe9s de 2 a\xf1os"}),"\n",(0,r.jsx)(n.li,{children:"Event compression con schema evolution"}),"\n",(0,r.jsxs)(n.li,{children:["Event summarization para analytics hist\xf3ricos\n",(0,r.jsx)(n.strong,{children:"Criterios de decisi\xf3n"}),": Compliance requirements, query frequency, cost optimization\n",(0,r.jsx)(n.strong,{children:"Target decisi\xf3n"}),": Q3 2024\n",(0,r.jsx)(n.strong,{children:"Owner"}),": Equipo de Arquitectura + Legal"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"pnd-003-schema-evolution-strategy-para-eventos",children:"PND-003: Schema evolution strategy para eventos"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Contexto"}),": Manejo de cambios en esquemas de eventos sin breaking changes\n",(0,r.jsx)(n.strong,{children:"Opciones bajo evaluaci\xf3n"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Schema Registry con Avro/Protobuf"}),"\n",(0,r.jsx)(n.li,{children:"JSON Schema evolution con versioning"}),"\n",(0,r.jsxs)(n.li,{children:["Event transformation pipelines\n",(0,r.jsx)(n.strong,{children:"Criterios de decisi\xf3n"}),": Breaking changes handling, performance impact, tooling\n",(0,r.jsx)(n.strong,{children:"Target decisi\xf3n"}),": Q2 2024\n",(0,r.jsx)(n.strong,{children:"Owner"}),": Equipo de Desarrollo"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"910-lecciones-aprendidas",children:"9.10 Lecciones aprendidas"}),"\n",(0,r.jsx)(n.h3,{id:"\xe9xitos",children:"\xc9xitos"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Event Sourcing adoption"}),": Redujo tiempo de auditor\xeda en 80%"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PostgreSQL choice"}),": Performance mejor que esperado para workload OLTP/OLAP h\xedbrido"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CQRS implementation"}),": Query performance mejor\xf3 10x vs approach naive"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"desaf\xedos",children:"Desaf\xedos"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Learning curve"}),": Team ramping time fue 3 meses vs 1 mes estimado"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Debugging complexity"}),": Nuevas herramientas requeridas para resoluci\xf3n de problemas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Testing strategy"}),": Contract testing entre eventos m\xe1s complejo que anticipado"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ajustes-realizados",children:"Ajustes realizados"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Projection rebuilds"}),": Implementaci\xf3n de rebuild incremental vs full rebuild"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cache invalidation"}),": Estrategia m\xe1s granular que initial TTL-only approach"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Tenant onboarding"}),": Automatizaci\xf3n completa vs manual schema creation"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-5",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Familiaridad del equipo"}),": Conocimiento existente en PostgreSQL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ACID compliance"}),": Transacciones robustas para consistency"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JSONB support"}),": Flexibilidad para evoluci\xf3n de esquemas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": \xcdndices especializados para queries temporales"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ecosystem"}),": Amplio soporte de herramientas y librer\xedas"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-tenancy"}),": Schema-per-tenant para aislamiento"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-5",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Confiabilidad, performance, ecosystem maduro"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": No especializado para event sourcing, setup m\xe1s complejo"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": Optimizaciones espec\xedficas, monitoring especializado"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"93-adr-003-cqrs-con-read-models-separados",children:"9.3 ADR-003: CQRS con read models separados"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Estado"}),": Aceptado\n",(0,r.jsx)(n.strong,{children:"Fecha"}),": 2024-01-25\n",(0,r.jsx)(n.strong,{children:"Decidido por"}),": Tech Lead"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-5",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Optimizaci\xf3n de queries para diferentes casos de uso (timeline, analytics, search) con patrones de acceso muy distintos."}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-5",children:"Alternativas consideradas"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Query directo desde Event Store"}),": Una sola fuente de datos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CQRS con read models"}),": Separaci\xf3n de lectura y escritura"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Materialized views"}),": Vistas materializadas en misma DB"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-4",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Implementamos ",(0,r.jsx)(n.strong,{children:"CQRS"})," con read models especializados."]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-6",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": Queries optimizadas por caso de uso"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Escalabilidad"}),": Read models independientes escalables"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Flexibilidad"}),": Diferentes estructuras de datos por necesidad"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Disponibilidad"}),": Tolerancia a fallos independiente"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"implementaci\xf3n-4",children:"Implementaci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"// Command side - Event Store\npublic class EventStoreRepository : IEventRepository\n{\n    public async Task SaveEventsAsync(string streamId, IEnumerable<DomainEvent> events)\n    {\n        // Append events to PostgreSQL event store\n    }\n}\n\n// Query side - Read Models\npublic class TimelineReadModel : ITimelineQueries\n{\n    public async Task<TimelineView> GetTimelineAsync(string entityId)\n    {\n        // Query from optimized timeline projection\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-6",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Performance, escalabilidad, mantenibilidad"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": Eventual consistency, complejidad de sincronizaci\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": Monitoreo de lag, circuit breakers, fallback queries"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"94-adr-004-event-store-agn\xf3stico-para-event-streaming",children:"9.4 ADR-004: Event Store Agn\xf3stico para Event Streaming"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Estado"}),": Aceptado\n",(0,r.jsx)(n.strong,{children:"Fecha"}),": 2024-02-01 (Actualizado: 2025-08-05)\n",(0,r.jsx)(n.strong,{children:"Decidido por"}),": Equipo de Arquitectura"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-6",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Necesidad de streaming de eventos hacia read models y sistemas externos con alta capacidad de procesamiento y durabilidad, con flexibilidad para escalar seg\xfan volumen operacional."}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-6",children:"Alternativas consideradas"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PostgreSQL"}),": Inicio simple, ACID compliance, expertise del equipo"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SNS+SQS"}),": Escalabilidad managed AWS, integraci\xf3n nativa"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RabbitMQ/Amazon MQ"}),": Event streaming robusto, patrones messaging complejos"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Event Bus (Kafka)"}),": Alto capacidad de procesamiento, ecosistema maduro (para vol\xfamenes muy altos)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-5",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Adoptamos ",(0,r.jsx)(n.strong,{children:"Event Store agn\xf3stico basado en volumen"})," con abstracci\xf3n IEventStore."]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-7",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PostgreSQL-first"}),": Inicio con PostgreSQL para simplicidad operacional"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Volume-based scaling"}),": < 1K events/hora PostgreSQL, 1K-10K evaluaci\xf3n, > 10K SNS+SQS/RabbitMQ"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Abstraction pattern"}),": IEventStore permite migraci\xf3n sin reescribir l\xf3gica de negocio"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cost-effective"}),": Optimizaci\xf3n de costos seg\xfan volumen real vs proyectado"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Scalability"}),": Escalamiento horizontal natural"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuraci\xf3n",children:"Configuraci\xf3n"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"topics:\n  domain-events:\n    partitions: 12\n    replication-factor: 3\n    retention: 7d\n  integration-events:\n    partitions: 6\n    replication-factor: 3\n    retention: 30d\n"})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-7",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Alta performance, durabilidad, ecosystem rico"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": Complejidad operacional, learning curve"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": Managed Kafka service, monitoring robusto, documentaci\xf3n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"95-adr-005-redis-para-caching-distribuido",children:"9.5 ADR-005: Redis para caching distribuido"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Estado"}),": Aceptado\n",(0,r.jsx)(n.strong,{children:"Fecha"}),": 2024-02-05\n",(0,r.jsx)(n.strong,{children:"Decidido por"}),": Tech Lead"]}),"\n",(0,r.jsx)(n.h3,{id:"contexto-7",children:"Contexto"}),"\n",(0,r.jsx)(n.p,{children:"Optimizaci\xf3n de queries frecuentes de timeline y reducci\xf3n de latencia en consultas de read models."}),"\n",(0,r.jsx)(n.h3,{id:"alternativas-consideradas-7",children:"Alternativas consideradas"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"In-memory caching"}),": Cache local por instancia"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redis"}),": Cache distribuido"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Memcached"}),": Simple distributed cache"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Database query cache"}),": Cache a nivel de DB"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"decisi\xf3n-6",children:"Decisi\xf3n"}),"\n",(0,r.jsxs)(n.p,{children:["Implementamos ",(0,r.jsx)(n.strong,{children:"Redis"})," como cache distribuido."]}),"\n",(0,r.jsx)(n.h3,{id:"justificaci\xf3n-8",children:"Justificaci\xf3n"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": Sub-millisecond latency para hot data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consistency"}),": Cache compartido entre instancias"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Durability"}),": Opcional persistence para warm-up"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Features"}),": Estructuras de datos avanzadas (TTL, pipelines)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring"}),": M\xe9tricas detalladas de hit/miss ratios"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"estrategia-de-cache",children:"Estrategia de cache"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public class CacheStrategy\n{\n    // L1: In-memory (5 min TTL)\n    // L2: Redis distributed (15 min TTL)\n    // L3: Database fallback\n\n    public async Task<T> GetOrSetAsync<T>(string key, Func<Task<T>> factory)\n    {\n        return await _memoryCache.GetOrCreateAsync(key, async entry =>\n        {\n            entry.SlidingExpiration = TimeSpan.FromMinutes(5);\n            return await _distributedCache.GetOrSetAsync(key, factory, TimeSpan.FromMinutes(15));\n        });\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"consecuencias-8",children:"Consecuencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Positivas"}),": Latencia ultra-baja, consistency, monitoring"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Negativas"}),": Complejidad adicional, gesti\xf3n de invalidaci\xf3n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mitigaci\xf3n"}),": TTL autom\xe1tico, cache warming, fallback strategies"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"97-resumen-de-decisiones",children:"9.7 Resumen de decisiones"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"ADR"}),(0,r.jsx)(n.th,{children:"Decisi\xf3n"}),(0,r.jsx)(n.th,{children:"Impacto"}),(0,r.jsx)(n.th,{children:"Estado"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"001"}),(0,r.jsx)(n.td,{children:"Event Sourcing"}),(0,r.jsx)(n.td,{children:"Alto - Arquitectura fundamental"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"002"}),(0,r.jsx)(n.td,{children:"PostgreSQL Event Store"}),(0,r.jsx)(n.td,{children:"Alto - Storage principal"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"003"}),(0,r.jsx)(n.td,{children:"CQRS Read Models"}),(0,r.jsx)(n.td,{children:"Medio - Performance"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"004"}),(0,r.jsx)(n.td,{children:"Event Bus Streaming"}),(0,r.jsx)(n.td,{children:"Medio - Integration"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"005"}),(0,r.jsx)(n.td,{children:"Redis Caching"}),(0,r.jsx)(n.td,{children:"Bajo - Optimization"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"006"}),(0,r.jsx)(n.td,{children:"Multi-tenant Schema"}),(0,r.jsx)(n.td,{children:"Alto - Security/Compliance"}),(0,r.jsx)(n.td,{children:"\u2705 Implementado"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"98-decisiones-pendientes",children:"9.8 Decisiones pendientes"}),"\n",(0,r.jsx)(n.h3,{id:"pnd-001-sharding-strategy-para-escalamiento",children:"PND-001: Sharding strategy para escalamiento"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Contexto"}),": Crecimiento esperado requiere distribuci\xf3n horizontal\n",(0,r.jsx)(n.strong,{children:"Opciones"}),": Shard por tenant, por tiempo, por hash de entity\n",(0,r.jsx)(n.strong,{children:"Target"}),": Q2 2024"]}),"\n",(0,r.jsx)(n.h3,{id:"pnd-002-archiving-policy-para-event-store",children:"PND-002: Archiving policy para event store"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Contexto"}),": Retenci\xf3n a largo plazo vs performance\n",(0,r.jsx)(n.strong,{children:"Opciones"}),": Cold storage, compression, summarization\n",(0,r.jsx)(n.strong,{children:"Target"}),": Q3 2024"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);