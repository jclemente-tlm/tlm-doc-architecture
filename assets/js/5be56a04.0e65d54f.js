"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[3907],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>r});var t=i(96540);const s={},d=t.createContext(s);function c(e){const n=t.useContext(d);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(d.Provider,{value:n},e.children)}},52774:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/notification_system-cb1ded2e27dd2e4ecf5d4f26b8d2bc4f.png"},61019:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/notification_system_api-d239945aa466f3166db18f13c0e12d90.png"},70181:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"servicios-corporativos/servicio-notificacion/vista-bloques-construccion","title":"5. Vista de Bloques de Construcci\xf3n","description":"Esta secci\xf3n describe la estructura modular del Sistema de Notificaci\xf3n, detallando contenedores, componentes, esquemas de datos, APIs y ejemplos de implementaci\xf3n. Se incluyen diagramas C4 para ilustrar la arquitectura y la interacci\xf3n entre los bloques principales.","source":"@site/docs/servicios-corporativos/servicio-notificacion/05-vista-bloques-construccion.md","sourceDirName":"servicios-corporativos/servicio-notificacion","slug":"/servicios-corporativos/servicio-notificacion/vista-bloques-construccion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/vista-bloques-construccion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-notificacion/05-vista-bloques-construccion.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"4. Estrategia de soluci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/estrategia-solucion"},"next":{"title":"6. Vista de tiempo de ejecuci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/vista-tiempo-ejecucion"}}');var s=i(74848),d=i(28453);const c={},r="5. Vista de Bloques de Construcci\xf3n",l={},o=[{value:"5.1 Contenedores Principales",id:"51-contenedores-principales",level:2},{value:"5.2 Componentes del API",id:"52-componentes-del-api",level:2},{value:"5.3 Componentes del Processor",id:"53-componentes-del-processor",level:2},{value:"5.4 Esquemas de Base de Datos",id:"54-esquemas-de-base-de-datos",level:2},{value:"5.4.1 Tabla: <code>notifications</code>",id:"541-tabla-notifications",level:3},{value:"5.4.2 Tabla: <code>notification_deliveries</code>",id:"542-tabla-notification_deliveries",level:3},{value:"5.4.3 Tabla: <code>notification_templates</code>",id:"543-tabla-notification_templates",level:3},{value:"5.5 Endpoints de API",id:"55-endpoints-de-api",level:2},{value:"5.5.1 Notification API",id:"551-notification-api",level:3},{value:"5.5.2 Template Management API",id:"552-template-management-api",level:3},{value:"5.6 Contratos de Datos (DTOs)",id:"56-contratos-de-datos-dtos",level:2},{value:"5.6.1 <code>NotificationRequest</code>",id:"561-notificationrequest",level:3},{value:"5.6.2 <code>NotificationResponse</code>",id:"562-notificationresponse",level:3},{value:"5.7 Ejemplos de Implementaci\xf3n",id:"57-ejemplos-de-implementaci\xf3n",level:2},{value:"5.7.1 Controller de Notificaciones",id:"571-controller-de-notificaciones",level:3},{value:"5.7.2 Servicio de Notificaciones",id:"572-servicio-de-notificaciones",level:3},{value:"5.7.3 Procesador de Email",id:"573-procesador-de-email",level:3}];function a(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"5-vista-de-bloques-de-construcci\xf3n",children:"5. Vista de Bloques de Construcci\xf3n"})}),"\n",(0,s.jsxs)(n.p,{children:["Esta secci\xf3n describe la estructura modular del ",(0,s.jsx)(n.strong,{children:"Sistema de Notificaci\xf3n"}),", detallando contenedores, componentes, esquemas de datos, APIs y ejemplos de implementaci\xf3n. Se incluyen diagramas C4 para ilustrar la arquitectura y la interacci\xf3n entre los bloques principales."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"Vista General del Sistema de Notificaci\xf3n",src:i(52774).A+"",width:"5575",height:"2313"}),"\n",(0,s.jsx)(n.em,{children:"Figura 5.1: Contenedores principales del sistema"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"Componentes Notification API",src:i(61019).A+"",width:"5520",height:"2974"}),"\n",(0,s.jsx)(n.em,{children:"Figura 5.2: Componentes internos de la Notification API"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"Componentes Notification Processor",src:i(92831).A+"",width:"6147",height:"2901"}),"\n",(0,s.jsx)(n.em,{children:"Figura 5.3: Componentes internos del Notification Processor"})]}),"\n",(0,s.jsx)(n.h2,{id:"51-contenedores-principales",children:"5.1 Contenedores Principales"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Contenedor"}),(0,s.jsx)(n.th,{children:"Responsabilidad"}),(0,s.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Notification API"})}),(0,s.jsx)(n.td,{children:"Recepci\xf3n y validaci\xf3n de solicitudes"}),(0,s.jsx)(n.td,{children:".NET 8 Web API"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Notification Processor"})}),(0,s.jsx)(n.td,{children:"Procesamiento y env\xedo de notificaciones"}),(0,s.jsx)(n.td,{children:".NET 8 Worker Service"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"PostgreSQL"})}),(0,s.jsx)(n.td,{children:"Persistencia de datos y auditor\xeda"}),(0,s.jsx)(n.td,{children:"PostgreSQL 15+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Redis"})}),(0,s.jsx)(n.td,{children:"Cola de mensajes y cache"}),(0,s.jsx)(n.td,{children:"Redis 7+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"File Storage"})}),(0,s.jsx)(n.td,{children:"Almacenamiento de adjuntos"}),(0,s.jsx)(n.td,{children:"Sistema de archivos"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"52-componentes-del-api",children:"5.2 Componentes del API"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Componente"}),(0,s.jsx)(n.th,{children:"Responsabilidad"}),(0,s.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Notification Controller"})}),(0,s.jsx)(n.td,{children:"Exposici\xf3n de endpoints REST"}),(0,s.jsx)(n.td,{children:"ASP.NET Core"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Template Controller"})}),(0,s.jsx)(n.td,{children:"Gesti\xf3n de plantillas"}),(0,s.jsx)(n.td,{children:"ASP.NET Core"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Attachment Service"})}),(0,s.jsx)(n.td,{children:"Manejo de adjuntos"}),(0,s.jsx)(n.td,{children:".NET 8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Validation Service"})}),(0,s.jsx)(n.td,{children:"Validaci\xf3n de datos y reglas"}),(0,s.jsx)(n.td,{children:"FluentValidation"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"53-componentes-del-processor",children:"5.3 Componentes del Processor"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Componente"}),(0,s.jsx)(n.th,{children:"Responsabilidad"}),(0,s.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Orchestrator Service"})}),(0,s.jsx)(n.td,{children:"Orquestaci\xf3n y control de flujos"}),(0,s.jsx)(n.td,{children:".NET 8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Template Engine"})}),(0,s.jsx)(n.td,{children:"Procesamiento de plantillas"}),(0,s.jsx)(n.td,{children:"RazorEngine"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Email Handler"})}),(0,s.jsx)(n.td,{children:"Env\xedo de emails"}),(0,s.jsx)(n.td,{children:"SMTP"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"SMS Handler"})}),(0,s.jsx)(n.td,{children:"Env\xedo de SMS"}),(0,s.jsx)(n.td,{children:"HTTP API"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Push Handler"})}),(0,s.jsx)(n.td,{children:"Env\xedo de notificaciones push"}),(0,s.jsx)(n.td,{children:"HTTP API"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Scheduler Service"})}),(0,s.jsx)(n.td,{children:"Programaci\xf3n y temporizaci\xf3n"}),(0,s.jsx)(n.td,{children:".NET 8 Timer"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"54-esquemas-de-base-de-datos",children:"5.4 Esquemas de Base de Datos"}),"\n",(0,s.jsxs)(n.h3,{id:"541-tabla-notifications",children:["5.4.1 Tabla: ",(0,s.jsx)(n.code,{children:"notifications"})]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Campo"}),(0,s.jsx)(n.th,{children:"Tipo"}),(0,s.jsx)(n.th,{children:"Descripci\xf3n"}),(0,s.jsx)(n.th,{children:"Restricciones"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"id"})}),(0,s.jsx)(n.td,{children:"UUID"}),(0,s.jsx)(n.td,{children:"Identificador \xfanico"}),(0,s.jsx)(n.td,{children:"PRIMARY KEY"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"request_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(100)"}),(0,s.jsx)(n.td,{children:"ID de la solicitud"}),(0,s.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"message_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(100)"}),(0,s.jsx)(n.td,{children:"ID del mensaje"}),(0,s.jsx)(n.td,{children:"UNIQUE"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tenant_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(50)"}),(0,s.jsx)(n.td,{children:"Identificador del tenant"}),(0,s.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"user_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(100)"}),(0,s.jsx)(n.td,{children:"ID del usuario destinatario"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"notification_type"})}),(0,s.jsx)(n.td,{children:"VARCHAR(50)"}),(0,s.jsx)(n.td,{children:"transactional, marketing"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"channels"})}),(0,s.jsx)(n.td,{children:"JSONB"}),(0,s.jsx)(n.td,{children:"Canales solicitados"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"recipient"})}),(0,s.jsx)(n.td,{children:"JSONB"}),(0,s.jsx)(n.td,{children:"Datos del destinatario"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"message_content"})}),(0,s.jsx)(n.td,{children:"JSONB"}),(0,s.jsx)(n.td,{children:"Contenido del mensaje"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"schedule"})}),(0,s.jsx)(n.td,{children:"JSONB"}),(0,s.jsx)(n.td,{children:"Configuraci\xf3n de programaci\xf3n"}),(0,s.jsx)(n.td,{children:"NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"metadata"})}),(0,s.jsx)(n.td,{children:"JSONB"}),(0,s.jsx)(n.td,{children:"Metadatos adicionales"}),(0,s.jsx)(n.td,{children:"NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"status"})}),(0,s.jsx)(n.td,{children:"VARCHAR(20)"}),(0,s.jsx)(n.td,{children:"pending, processing, sent, failed"}),(0,s.jsx)(n.td,{children:"NOT NULL, DEFAULT 'pending'"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"created_at"})}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de creaci\xf3n"}),(0,s.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"updated_at"})}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de actualizaci\xf3n"}),(0,s.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sent_at"})}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de env\xedo"}),(0,s.jsx)(n.td,{children:"NULL"})]})]})]}),"\n",(0,s.jsxs)(n.h3,{id:"542-tabla-notification_deliveries",children:["5.4.2 Tabla: ",(0,s.jsx)(n.code,{children:"notification_deliveries"})]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Campo"}),(0,s.jsx)(n.th,{children:"Tipo"}),(0,s.jsx)(n.th,{children:"Descripci\xf3n"}),(0,s.jsx)(n.th,{children:"Restricciones"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"id"})}),(0,s.jsx)(n.td,{children:"UUID"}),(0,s.jsx)(n.td,{children:"Identificador \xfanico"}),(0,s.jsx)(n.td,{children:"PRIMARY KEY"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"notification_id"})}),(0,s.jsx)(n.td,{children:"UUID"}),(0,s.jsx)(n.td,{children:"Referencia a notification"}),(0,s.jsx)(n.td,{children:"FOREIGN KEY, NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"channel"})}),(0,s.jsx)(n.td,{children:"VARCHAR(20)"}),(0,s.jsx)(n.td,{children:"Canal: email, sms, push"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"status"})}),(0,s.jsx)(n.td,{children:"VARCHAR(20)"}),(0,s.jsx)(n.td,{children:"pending, sent, delivered, failed"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"provider"})}),(0,s.jsx)(n.td,{children:"VARCHAR(50)"}),(0,s.jsx)(n.td,{children:"Proveedor utilizado"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"provider_message_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(200)"}),(0,s.jsx)(n.td,{children:"ID del proveedor"}),(0,s.jsx)(n.td,{children:"NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"error_message"})}),(0,s.jsx)(n.td,{children:"TEXT"}),(0,s.jsx)(n.td,{children:"Mensaje de error"}),(0,s.jsx)(n.td,{children:"NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"retry_count"})}),(0,s.jsx)(n.td,{children:"INTEGER"}),(0,s.jsx)(n.td,{children:"N\xfamero de reintentos"}),(0,s.jsx)(n.td,{children:"DEFAULT 0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sent_at"})}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de env\xedo"}),(0,s.jsx)(n.td,{children:"NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"delivered_at"})}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de entrega confirmada"}),(0,s.jsx)(n.td,{children:"NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"created_at"})}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de creaci\xf3n"}),(0,s.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]})]})]}),"\n",(0,s.jsxs)(n.h3,{id:"543-tabla-notification_templates",children:["5.4.3 Tabla: ",(0,s.jsx)(n.code,{children:"notification_templates"})]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Campo"}),(0,s.jsx)(n.th,{children:"Tipo"}),(0,s.jsx)(n.th,{children:"Descripci\xf3n"}),(0,s.jsx)(n.th,{children:"Restricciones"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"id"})}),(0,s.jsx)(n.td,{children:"UUID"}),(0,s.jsx)(n.td,{children:"Identificador \xfanico"}),(0,s.jsx)(n.td,{children:"PRIMARY KEY"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"template_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(100)"}),(0,s.jsx)(n.td,{children:"ID del template"}),(0,s.jsx)(n.td,{children:"UNIQUE, NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tenant_id"})}),(0,s.jsx)(n.td,{children:"VARCHAR(50)"}),(0,s.jsx)(n.td,{children:"Identificador del tenant"}),(0,s.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"name"})}),(0,s.jsx)(n.td,{children:"VARCHAR(200)"}),(0,s.jsx)(n.td,{children:"Nombre descriptivo"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"channel"})}),(0,s.jsx)(n.td,{children:"VARCHAR(20)"}),(0,s.jsx)(n.td,{children:"Canal: email, sms, push"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"subject_template"})}),(0,s.jsx)(n.td,{children:"TEXT"}),(0,s.jsx)(n.td,{children:"Template del asunto"}),(0,s.jsx)(n.td,{children:"NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"body_template"})}),(0,s.jsx)(n.td,{children:"TEXT"}),(0,s.jsx)(n.td,{children:"Template del cuerpo"}),(0,s.jsx)(n.td,{children:"NOT NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"variables"})}),(0,s.jsx)(n.td,{children:"JSONB"}),(0,s.jsx)(n.td,{children:"Variables disponibles"}),(0,s.jsx)(n.td,{children:"NULL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"is_active"})}),(0,s.jsx)(n.td,{children:"BOOLEAN"}),(0,s.jsx)(n.td,{children:"Estado del template"}),(0,s.jsx)(n.td,{children:"DEFAULT true"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"created_at"})}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de creaci\xf3n"}),(0,s.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"updated_at"})}),(0,s.jsx)(n.td,{children:"TIMESTAMP"}),(0,s.jsx)(n.td,{children:"Fecha de actualizaci\xf3n"}),(0,s.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"55-endpoints-de-api",children:"5.5 Endpoints de API"}),"\n",(0,s.jsx)(n.p,{children:"Se describen los principales endpoints REST para la gesti\xf3n y consulta de notificaciones y plantillas. Los contratos de datos siguen el est\xe1ndar DTO y est\xe1n alineados con la arquitectura Clean Architecture."}),"\n",(0,s.jsx)(n.h3,{id:"551-notification-api",children:"5.5.1 Notification API"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["POST ",(0,s.jsx)(n.code,{children:"/api/v1/notifications"})]}),": Enviar nueva notificaci\xf3n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["GET ",(0,s.jsx)(n.code,{children:"/api/v1/notifications/{notificationId}"})]}),": Consultar estado de notificaci\xf3n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["POST ",(0,s.jsx)(n.code,{children:"/api/v1/notifications/bulk"})]}),": Env\xedo masivo de notificaciones"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"552-template-management-api",children:"5.5.2 Template Management API"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["GET ",(0,s.jsx)(n.code,{children:"/api/v1/templates"})]}),": Listar plantillas disponibles"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["POST ",(0,s.jsx)(n.code,{children:"/api/v1/templates"})]}),": Crear nueva plantilla"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"56-contratos-de-datos-dtos",children:"5.6 Contratos de Datos (DTOs)"}),"\n",(0,s.jsx)(n.p,{children:"Los siguientes DTOs definen la estructura de los datos de entrada y salida de la API:"}),"\n",(0,s.jsxs)(n.h3,{id:"561-notificationrequest",children:["5.6.1 ",(0,s.jsx)(n.code,{children:"NotificationRequest"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'public class NotificationRequest\n{\n    public string RequestId { get; set; }\n    public DateTime Timestamp { get; set; }\n    public string NotificationType { get; set; } // "transactional" | "marketing"\n    public List<string> Channels { get; set; }\n    public RecipientDto Recipient { get; set; }\n    public MessageDto Message { get; set; }\n    public ScheduleDto Schedule { get; set; }\n    public Dictionary<string, object> Metadata { get; set; }\n}\n\npublic class RecipientDto\n{\n    public string UserId { get; set; }\n    public string Email { get; set; }\n    public string Phone { get; set; }\n    public string PushToken { get; set; }\n    public Dictionary<string, string> CustomFields { get; set; }\n}\n\npublic class MessageDto\n{\n    public string Subject { get; set; }\n    public string Body { get; set; }\n    public List<string> Attachments { get; set; }\n    public string SmsText { get; set; }\n    public PushNotificationDto PushNotification { get; set; }\n}\n\npublic class PushNotificationDto\n{\n    public string Title { get; set; }\n    public string Body { get; set; }\n    public string Icon { get; set; }\n    public PushActionDto Action { get; set; }\n}\n\npublic class PushActionDto\n{\n    public string Type { get; set; }\n    public string Url { get; set; }\n}\n\npublic class ScheduleDto\n{\n    public DateTime? SendAt { get; set; }\n    public string TimeZone { get; set; }\n}\n'})}),"\n",(0,s.jsxs)(n.h3,{id:"562-notificationresponse",children:["5.6.2 ",(0,s.jsx)(n.code,{children:"NotificationResponse"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public class NotificationResponse\n{\n    public string NotificationId { get; set; }\n    public string Status { get; set; }\n    public DateTime EstimatedDelivery { get; set; }\n    public List<string> Warnings { get; set; }\n}\n\npublic class NotificationStatusResponse\n{\n    public string NotificationId { get; set; }\n    public string RequestId { get; set; }\n    public string Status { get; set; }\n    public List<ChannelDeliveryDto> Channels { get; set; }\n    public DateTime CreatedAt { get; set; }\n    public DateTime? SentAt { get; set; }\n}\n\npublic class ChannelDeliveryDto\n{\n    public string Channel { get; set; }\n    public string Status { get; set; }\n    public DateTime? SentAt { get; set; }\n    public DateTime? DeliveredAt { get; set; }\n    public string Error { get; set; }\n    public int RetryCount { get; set; }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"57-ejemplos-de-implementaci\xf3n",children:"5.7 Ejemplos de Implementaci\xf3n"}),"\n",(0,s.jsx)(n.p,{children:"A continuaci\xf3n, se presentan ejemplos de implementaci\xf3n de controladores y servicios siguiendo buenas pr\xe1cticas de Clean Architecture, DDD y manejo de errores."}),"\n",(0,s.jsx)(n.h3,{id:"571-controller-de-notificaciones",children:"5.7.1 Controller de Notificaciones"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'[ApiController]\n[Route("api/v1/[controller]")]\npublic class NotificationsController : ControllerBase\n{\n    private readonly INotificationService _notificationService;\n    private readonly ILogger<NotificationsController> _logger;\n\n    public NotificationsController(\n        INotificationService notificationService,\n        ILogger<NotificationsController> logger)\n    {\n        _notificationService = notificationService;\n        _logger = logger;\n    }\n\n    [HttpPost]\n    public async Task<IActionResult> SendNotification(\n        [FromBody] NotificationRequest request)\n    {\n        try\n        {\n            var result = await _notificationService.SendAsync(request);\n            return Accepted(result);\n        }\n        catch (ValidationException ex)\n        {\n            return BadRequest(new { error = ex.Message });\n        }\n        catch (Exception ex)\n        {\n            _logger.LogError(ex, "Error sending notification {RequestId}", request.RequestId);\n            return StatusCode(500, new { error = "Internal server error" });\n        }\n    }\n\n    [HttpGet("{notificationId}")]\n    public async Task<IActionResult> GetNotificationStatus(string notificationId)\n    {\n        var status = await _notificationService.GetStatusAsync(notificationId);\n        if (status == null)\n            return NotFound();\n\n        return Ok(status);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"572-servicio-de-notificaciones",children:"5.7.2 Servicio de Notificaciones"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'public class NotificationService : INotificationService\n{\n    private readonly INotificationRepository _repository;\n    private readonly IQueueService _queueService;\n    private readonly ITemplateEngine _templateEngine;\n    private readonly ILogger<NotificationService> _logger;\n\n    public async Task<NotificationResponse> SendAsync(NotificationRequest request)\n    {\n        // Validar request\n        await ValidateRequestAsync(request);\n\n        // Crear notificaci\xf3n en BD\n        var notification = new Notification\n        {\n            Id = Guid.NewGuid(),\n            RequestId = request.RequestId,\n            MessageId = GenerateMessageId(),\n            TenantId = GetCurrentTenantId(),\n            UserId = request.Recipient.UserId,\n            NotificationType = request.NotificationType,\n            Channels = request.Channels,\n            Recipient = request.Recipient,\n            MessageContent = request.Message,\n            Schedule = request.Schedule,\n            Metadata = request.Metadata,\n            Status = NotificationStatus.Pending\n        };\n\n        await _repository.CreateAsync(notification);\n\n        // Encolar para procesamiento\n        if (request.Schedule?.SendAt != null && request.Schedule.SendAt > DateTime.UtcNow)\n        {\n            await _queueService.ScheduleAsync(notification, request.Schedule.SendAt.Value);\n        }\n        else\n        {\n            await _queueService.EnqueueAsync(notification);\n        }\n\n        return new NotificationResponse\n        {\n            NotificationId = notification.Id.ToString(),\n            Status = "accepted",\n            EstimatedDelivery = CalculateEstimatedDelivery(request)\n        };\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"573-procesador-de-email",children:"5.7.3 Procesador de Email"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'public class EmailHandler : IChannelHandler\n{\n    private readonly ISmtpClient _smtpClient;\n    private readonly ITemplateEngine _templateEngine;\n    private readonly ILogger<EmailHandler> _logger;\n\n    public async Task<DeliveryResult> SendAsync(NotificationDelivery delivery)\n    {\n        try\n        {\n            var notification = delivery.Notification;\n            var emailContent = await _templateEngine.RenderEmailAsync(\n                notification.MessageContent,\n                notification.Metadata);\n\n            var message = new MimeMessage();\n            message.From.Add(new MailboxAddress("System", "noreply@company.com"));\n            message.To.Add(new MailboxAddress("", notification.Recipient.Email));\n            message.Subject = emailContent.Subject;\n\n            var bodyBuilder = new BodyBuilder\n            {\n                HtmlBody = emailContent.HtmlBody,\n                TextBody = emailContent.TextBody\n            };\n\n            // Agregar attachments\n            foreach (var attachment in emailContent.Attachments)\n            {\n                bodyBuilder.Attachments.Add(attachment.FileName, attachment.Content);\n            }\n\n            message.Body = bodyBuilder.ToMessageBody();\n\n            await _smtpClient.SendAsync(message);\n\n            return DeliveryResult.Success(DateTime.UtcNow);\n        }\n        catch (Exception ex)\n        {\n            _logger.LogError(ex, "Failed to send email for delivery {DeliveryId}", delivery.Id);\n            return DeliveryResult.Failed(ex.Message);\n        }\n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},92831:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/notification_system_processor-d432aa2bf909970e756c295d9f9d6abb.png"}}]);