"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[8973],{28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>c});var r=i(96540);const s={},t=r.createContext(s);function a(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}},63814:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"servicios-corporativos/servicio-track-trace/vista-tiempo-ejecucion","title":"6. Vista de tiempo de ejecuci\xf3n","description":"6.1 Escenarios principales","source":"@site/docs/servicios-corporativos/servicio-track-trace/06-vista-tiempo-ejecucion.md","sourceDirName":"servicios-corporativos/servicio-track-trace","slug":"/servicios-corporativos/servicio-track-trace/vista-tiempo-ejecucion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/vista-tiempo-ejecucion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-track-trace/06-vista-tiempo-ejecucion.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"5. Vista de Bloques de Construcci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/vista-bloques-construccion"},"next":{"title":"7. Vista de implementaci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/vista-implementacion"}}');var s=i(74848),t=i(28453);const a={},c="6. Vista de tiempo de ejecuci\xf3n",d={},l=[{value:"6.1 Escenarios principales",id:"61-escenarios-principales",level:2},{value:"6.2 Patrones de interacci\xf3n",id:"62-patrones-de-interacci\xf3n",level:2},{value:"6.1 Escenarios de runtime",id:"61-escenarios-de-runtime",level:2},{value:"6.1.1 Captura de evento operacional",id:"611-captura-de-evento-operacional",level:3},{value:"6.1.2 Consulta de trazabilidad",id:"612-consulta-de-trazabilidad",level:3},{value:"6.1.3 An\xe1lisis de performance",id:"613-an\xe1lisis-de-performance",level:3},{value:"6.2 Flujos principales",id:"62-flujos-principales",level:2},{value:"6.2.1 Ingesta de eventos",id:"621-ingesta-de-eventos",level:3},{value:"6.2.2 Construcci\xf3n de timeline",id:"622-construcci\xf3n-de-timeline",level:3},{value:"6.2.3 Agregaci\xf3n de m\xe9tricas",id:"623-agregaci\xf3n-de-m\xe9tricas",level:3},{value:"6.3 Patrones de runtime",id:"63-patrones-de-runtime",level:2},{value:"6.3.1 Event Sourcing",id:"631-event-sourcing",level:3},{value:"6.3.2 CQRS",id:"632-cqrs",level:3},{value:"6.3.3 Saga Pattern",id:"633-saga-pattern",level:3},{value:"6.4 Manejo de concurrencia",id:"64-manejo-de-concurrencia",level:2},{value:"6.4.1 Optimistic Concurrency",id:"641-optimistic-concurrency",level:3},{value:"6.4.2 Particionado",id:"642-particionado",level:3},{value:"6.5 Monitoreo de runtime",id:"65-monitoreo-de-runtime",level:2},{value:"6.5.1 M\xe9tricas de negocio",id:"651-m\xe9tricas-de-negocio",level:3},{value:"6.5.2 M\xe9tricas t\xe9cnicas",id:"652-m\xe9tricas-t\xe9cnicas",level:3},{value:"6.5.3 Alertas",id:"653-alertas",level:3}];function o(e){const n={h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"6-vista-de-tiempo-de-ejecuci\xf3n",children:"6. Vista de tiempo de ejecuci\xf3n"})}),"\n",(0,s.jsx)(n.h2,{id:"61-escenarios-principales",children:"6.1 Escenarios principales"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Escenario"}),(0,s.jsx)(n.th,{children:"Flujo"}),(0,s.jsx)(n.th,{children:"Componentes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Registro evento"})}),(0,s.jsx)(n.td,{children:"API \u2192 Validator \u2192 Repository"}),(0,s.jsx)(n.td,{children:"API, Processor"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Consulta tracking"})}),(0,s.jsx)(n.td,{children:"API \u2192 Query Handler \u2192 Database"}),(0,s.jsx)(n.td,{children:"API"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Propagaci\xf3n evento"})}),(0,s.jsx)(n.td,{children:"Event Publisher \u2192 Queue \u2192 SITA"}),(0,s.jsx)(n.td,{children:"Processor"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"62-patrones-de-interacci\xf3n",children:"6.2 Patrones de interacci\xf3n"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Patr\xf3n"}),(0,s.jsx)(n.th,{children:"Descripci\xf3n"}),(0,s.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"CQRS"})}),(0,s.jsx)(n.td,{children:"Separaci\xf3n comando/consulta"}),(0,s.jsx)(n.td,{children:"API/Processor"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Event Sourcing"})}),(0,s.jsx)(n.td,{children:"Registro eventos"}),(0,s.jsx)(n.td,{children:"PostgreSQL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Pub/Sub"})}),(0,s.jsx)(n.td,{children:"Propagaci\xf3n eventos"}),(0,s.jsx)(n.td,{children:"Queue"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"61-escenarios-de-runtime",children:"6.1 Escenarios de runtime"}),"\n",(0,s.jsx)(n.h3,{id:"611-captura-de-evento-operacional",children:"6.1.1 Captura de evento operacional"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client as Cliente\n    participant API as Track&Trace API\n    participant Validator as Validator\n    participant CommandBus as Command Bus\n    participant Handler as Command Handler\n    participant EventStore as Event Store\n    participant EventBus as Event Bus\n    participant ReadModel as Read Model Service\n\n    Client->>API: POST /api/v1/events\n    API->>Validator: ValidateCommand(CreateEventCommand)\n    Validator--\x3e>API: ValidationResult\n\n    alt Validation Success\n        API->>CommandBus: Dispatch(CreateEventCommand)\n        CommandBus->>Handler: Handle(CreateEventCommand)\n        Handler->>EventStore: AppendEvent(OperationalEvent)\n        EventStore--\x3e>Handler: EventAppended\n        Handler->>EventBus: PublishEvent(EventCreated)\n        Handler--\x3e>API: CommandResult.Success\n        API--\x3e>Client: 201 Created {eventId}\n\n        EventBus->>ReadModel: ConsumeEvent(EventCreated)\n        ReadModel->>ReadModel: UpdateProjections\n    else Validation Failed\n        API--\x3e>Client: 400 BadRequest {errors}\n    end"}),"\n",(0,s.jsx)(n.h3,{id:"612-consulta-de-trazabilidad",children:"6.1.2 Consulta de trazabilidad"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client as Cliente\n    participant API as Track&Trace API\n    participant Auth as Auth Service\n    participant QueryHandler as Query Handler\n    participant ReadStore as Read Store\n    participant Cache as Redis Cache\n\n    Client->>API: GET /api/v1/trace/{entityId}\n    API->>Auth: ValidateToken()\n    Auth--\x3e>API: TokenValidated\n\n    API->>Cache: GetTrace(entityId)\n    alt Cache Hit\n        Cache--\x3e>API: TraceData\n        API--\x3e>Client: 200 OK {traceData}\n    else Cache Miss\n        API->>QueryHandler: Handle(GetTraceQuery)\n        QueryHandler->>ReadStore: GetEntityTimeline(entityId)\n        ReadStore--\x3e>QueryHandler: TimelineEvents[]\n        QueryHandler->>QueryHandler: BuildTraceView\n        QueryHandler--\x3e>API: TraceView\n        API->>Cache: SetTrace(entityId, traceView)\n        API--\x3e>Client: 200 OK {traceData}\n    end"}),"\n",(0,s.jsx)(n.h3,{id:"613-an\xe1lisis-de-performance",children:"6.1.3 An\xe1lisis de performance"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Scheduler as Scheduler\n    participant AnalyticsEngine as Analytics Engine\n    participant EventStore as Event Store\n    participant TimeSeriesDB as InfluxDB\n    participant Dashboard as Grafana\n\n    Scheduler->>AnalyticsEngine: TriggerAnalysis(HourlyBatch)\n    AnalyticsEngine->>EventStore: GetEventsByTimeRange()\n    EventStore--\x3e>AnalyticsEngine: Events[]\n\n    AnalyticsEngine->>AnalyticsEngine: CalculateMetrics()\n    AnalyticsEngine->>AnalyticsEngine: DetectAnomalies()\n    AnalyticsEngine->>TimeSeriesDB: WriteMetrics(KPIs)\n\n    TimeSeriesDB--\x3e>Dashboard: MetricsStream\n    Dashboard->>Dashboard: UpdateCharts()"}),"\n",(0,s.jsx)(n.h2,{id:"62-flujos-principales",children:"6.2 Flujos principales"}),"\n",(0,s.jsx)(n.h3,{id:"621-ingesta-de-eventos",children:"6.2.1 Ingesta de eventos"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Procesamiento de eventos operacionales desde m\xfaltiples fuentes"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Actores"}),": Sistemas externos, Aplicaciones internas, APIs de terceros"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Precondiciones"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Sistema autenticado"}),"\n",(0,s.jsx)(n.li,{children:"Evento v\xe1lido seg\xfan schema"}),"\n",(0,s.jsx)(n.li,{children:"Tenant activo"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flujo normal"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Recepci\xf3n de evento v\xeda API REST o Event Bus"}),"\n",(0,s.jsx)(n.li,{children:"Validaci\xf3n de formato y permisos"}),"\n",(0,s.jsx)(n.li,{children:"Enriquecimiento con metadata"}),"\n",(0,s.jsx)(n.li,{children:"Persistencia en Event Store"}),"\n",(0,s.jsx)(n.li,{children:"Publicaci\xf3n en event bus"}),"\n",(0,s.jsx)(n.li,{children:"Actualizaci\xf3n de read models"}),"\n",(0,s.jsx)(n.li,{children:"Notificaci\xf3n a suscriptores"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flujo alternativo - Evento duplicado"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Detecci\xf3n por deduplication key"}),"\n",(0,s.jsx)(n.li,{children:"Retorno de referencia existente"}),"\n",(0,s.jsxs)(n.li,{children:["Log de intento duplicado\n",(0,s.jsx)(n.strong,{children:"Flujo de error"}),":"]}),"\n",(0,s.jsx)(n.li,{children:"Validaci\xf3n fallida \u2192 Error 400"}),"\n",(0,s.jsx)(n.li,{children:"Problemas de conectividad \u2192 Retry autom\xe1tico"}),"\n",(0,s.jsx)(n.li,{children:"Event Store no disponible \u2192 Circuit breaker"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"622-construcci\xf3n-de-timeline",children:"6.2.2 Construcci\xf3n de timeline"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Precondiciones"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Entidad existente en el sistema"}),"\n",(0,s.jsx)(n.li,{children:"Permisos de lectura para el tenant"}),"\n",(0,s.jsx)(n.li,{children:"Read models actualizados"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flujo normal"}),":\n2. Consulta a read store optimizado\n3. Aplicaci\xf3n de filtros temporales/contextuales\n4. Construcci\xf3n de timeline estructurado\n5. Aplicaci\xf3n de transformaciones de vista\n6. Cacheo del resultado\n7. Retorno de timeline paginado"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Optimizaciones"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cache distribuido con TTL"}),"\n",(0,s.jsx)(n.li,{children:"\xcdndices especializados por entidad"}),"\n",(0,s.jsx)(n.li,{children:"Proyecciones pre-calculadas"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"623-agregaci\xf3n-de-m\xe9tricas",children:"6.2.3 Agregaci\xf3n de m\xe9tricas"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": C\xe1lculo de KPIs y m\xe9tricas de negocio"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Actores"}),": Scheduler, Usuarios de dashboard"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Precondiciones"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Event store con datos hist\xf3ricos"}),"\n",(0,s.jsx)(n.li,{children:"Configuraci\xf3n de m\xe9tricas por tenant"}),"\n",(0,s.jsx)(n.li,{children:"Time series database disponible"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flujo normal"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Trigger por schedule o demanda"}),"\n",(0,s.jsx)(n.li,{children:"Consulta de eventos en ventana temporal"}),"\n",(0,s.jsx)(n.li,{children:"Aplicaci\xf3n de reglas de agregaci\xf3n"}),"\n",(0,s.jsx)(n.li,{children:"C\xe1lculo de m\xe9tricas derivadas"}),"\n",(0,s.jsx)(n.li,{children:"Detecci\xf3n de anomal\xedas"}),"\n",(0,s.jsx)(n.li,{children:"Persistencia en time series DB"}),"\n",(0,s.jsx)(n.li,{children:"Actualizaci\xf3n de dashboards"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"63-patrones-de-runtime",children:"6.3 Patrones de runtime"}),"\n",(0,s.jsx)(n.h3,{id:"631-event-sourcing",children:"6.3.1 Event Sourcing"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Estado"}),": Reconstruido desde eventos"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Persistencia"}),": Solo eventos, never snapshots para auditor\xeda completa"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),": Snapshots opcionales para entidades con alta frecuencia"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"632-cqrs",children:"6.3.2 CQRS"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Commands"}),": Modifican estado v\xeda Event Store"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Queries"}),": Leen desde read models especializados"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sincronizaci\xf3n"}),": Eventually consistent v\xeda event handlers"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"633-saga-pattern",children:"6.3.3 Saga Pattern"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Coordinaci\xf3n"}),": Para procesos de larga duraci\xf3n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Compensaci\xf3n"}),": Rollback de operaciones fallidas"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Estado"}),": Persistido como eventos de saga"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"64-manejo-de-concurrencia",children:"6.4 Manejo de concurrencia"}),"\n",(0,s.jsx)(n.h3,{id:"641-optimistic-concurrency",children:"6.4.1 Optimistic Concurrency"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Mecanismo"}),": Version-based concurrency control"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Conflictos"}),": Detecci\xf3n y resoluci\xf3n autom\xe1tica"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Retry"}),": Automatic retry con backoff exponencial"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"642-particionado",children:"6.4.2 Particionado"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sharding"}),": Por tenant y tipo de entidad"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Routing"}),": Basado en hash de entity ID"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Balanceado"}),": Distribuci\xf3n equitativa de carga"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"65-monitoreo-de-runtime",children:"6.5 Monitoreo de runtime"}),"\n",(0,s.jsx)(n.h3,{id:"651-m\xe9tricas-de-negocio",children:"6.5.1 M\xe9tricas de negocio"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Event ingestion rate"}),": Eventos/segundo por tenant"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Query response time"}),": P95 < 100ms para timeline queries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data freshness"}),": Lag entre command y query consistency"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"652-m\xe9tricas-t\xe9cnicas",children:"6.5.2 M\xe9tricas t\xe9cnicas"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Event store latency"}),": Append operations < 50ms"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Read model lag"}),": < 5 segundos para projections cr\xedticas"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Memory usage"}),": Bounded por configuraci\xf3n de tenant"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"653-alertas",children:"6.5.3 Alertas"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"High lag"}),": Read model lag > 30 segundos"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Failed commands"}),": Error rate > 1%"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Storage growth"}),": Crecimiento an\xf3malo de event store"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);