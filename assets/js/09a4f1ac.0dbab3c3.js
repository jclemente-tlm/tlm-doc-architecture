"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[6374],{4600:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"servicios-corporativos/servicio-identidad/vista-bloques-construccion","title":"5. Vista De Bloques De Construcci\xf3n","description":"5.1 Componentes Principales","source":"@site/docs/servicios-corporativos/servicio-identidad/05-vista-bloques-construccion.md","sourceDirName":"servicios-corporativos/servicio-identidad","slug":"/servicios-corporativos/servicio-identidad/vista-bloques-construccion","permalink":"/docs/servicios-corporativos/servicio-identidad/vista-bloques-construccion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-identidad/05-vista-bloques-construccion.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"4. Estrategia De Soluci\xf3n","permalink":"/docs/servicios-corporativos/servicio-identidad/estrategia-solucion"},"next":{"title":"6. Vista De Tiempo De Ejecuci\xf3n","permalink":"/docs/servicios-corporativos/servicio-identidad/vista-tiempo-ejecucion"}}');var r=i(74848),t=i(28453);const c={},d="5. Vista De Bloques De Construcci\xf3n",o={},a=[{value:"5.1 Componentes Principales",id:"51-componentes-principales",level:2},{value:"5.2 Diagrama De Bloques (C4: Container/Component)",id:"52-diagrama-de-bloques-c4-containercomponent",level:2},{value:"5.3 Despliegue Automatizado (Terraform + AWS ECS)",id:"53-despliegue-automatizado-terraform--aws-ecs",level:2},{value:"5.4 Observabilidad Y Monitoreo",id:"54-observabilidad-y-monitoreo",level:2},{value:"5.5 Relaci\xf3n Con C4 Y Structurizr DSL",id:"55-relaci\xf3n-con-c4-y-structurizr-dsl",level:2},{value:"5.6 Modelo De Datos Y Persistencia",id:"56-modelo-de-datos-y-persistencia",level:2},{value:"5.7 Interfaces Externas",id:"57-interfaces-externas",level:2},{value:"5.8 Ejemplos T\xe9cnicos",id:"58-ejemplos-t\xe9cnicos",level:2},{value:"Token Exchange (OAuth2/OIDC)",id:"token-exchange-oauth2oidc",level:3},{value:"User Management API",id:"user-management-api",level:3},{value:"5.9 Referencias",id:"59-referencias",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"5-vista-de-bloques-de-construcci\xf3n",children:"5. Vista De Bloques De Construcci\xf3n"})}),"\n",(0,r.jsx)(n.h2,{id:"51-componentes-principales",children:"5.1 Componentes Principales"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Componente"}),(0,r.jsx)(n.th,{children:"Responsabilidad"}),(0,r.jsx)(n.th,{children:"Tecnolog\xeda"}),(0,r.jsx)(n.th,{children:"Interfaces"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Keycloak Core"}),(0,r.jsx)(n.td,{children:"Proveedor de identidad multi-tenant (realm)"}),(0,r.jsx)(n.td,{children:"Keycloak 23+, Java 21, PostgreSQL"}),(0,r.jsx)(n.td,{children:"OAuth2/OIDC, SAML, Admin API"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"API Gesti\xf3n Identidad"}),(0,r.jsx)(n.td,{children:"Gesti\xf3n program\xe1tica de identidades"}),(0,r.jsx)(n.td,{children:"ASP.NET Core 8, EF Core"}),(0,r.jsx)(n.td,{children:"API REST, GraphQL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Servicio Validaci\xf3n Tokens"}),(0,r.jsx)(n.td,{children:"Validaci\xf3n distribuida de JWT, introspecci\xf3n, cach\xe9"}),(0,r.jsx)(n.td,{children:".NET 8, gRPC, Redis"}),(0,r.jsx)(n.td,{children:"gRPC, HTTP/2"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Auditor\xeda Y Cumplimiento"}),(0,r.jsx)(n.td,{children:"Logging estructurado, cumplimiento normativo"}),(0,r.jsx)(n.td,{children:"Event Sourcing, ELK, Loki"}),(0,r.jsx)(n.td,{children:"Event Bus, REST"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Gateway Federaci\xf3n"}),(0,r.jsx)(n.td,{children:"Integraci\xf3n con IdPs externos"}),(0,r.jsx)(n.td,{children:"Conectores personalizados"}),(0,r.jsx)(n.td,{children:"SAML, OIDC, LDAP"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Consola Administraci\xf3n"}),(0,r.jsx)(n.td,{children:"Interfaz administrativa"}),(0,r.jsx)(n.td,{children:"React SPA"}),(0,r.jsx)(n.td,{children:"Consumo API REST"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"52-diagrama-de-bloques-c4-containercomponent",children:"5.2 Diagrama De Bloques (C4: Container/Component)"}),"\n",(0,r.jsx)(n.mermaid,{value:"flowchart TD\n    subgraph Keycloak[Keycloak Core]\n        KC[Keycloak 23+ (multi-tenant/realm)]\n    end\n    subgraph API[API Gesti\xf3n Identidad]\n        APIID[ASP.NET Core 8]\n    end\n    subgraph Token[Servicio Validaci\xf3n Tokens]\n        TVS[.NET 8 gRPC]\n    end\n    subgraph Audit[Auditor\xeda y Cumplimiento]\n        AUD[Event Sourcing]\n        LOKI[Loki]\n        ELK[ELK Stack]\n    end\n    subgraph Federation[Gateway Federaci\xf3n]\n        FED[Conectores SAML/OIDC/LDAP]\n    end\n    subgraph Admin[Consola Administraci\xf3n]\n        ADMIN[React SPA]\n    end\n    KC <--\x3e APIID\n    KC <--\x3e TVS\n    KC <--\x3e AUD\n    KC <--\x3e FED\n    APIID <--\x3e ADMIN\n    TVS <--\x3e KC\n    AUD <--\x3e KC\n    FED <--\x3e KC"}),"\n",(0,r.jsx)(n.h2,{id:"53-despliegue-automatizado-terraform--aws-ecs",children:"5.3 Despliegue Automatizado (Terraform + AWS ECS)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'resource "aws_ecs_cluster" "identity" {\n  name = "identity-service-cluster"\n}\nresource "aws_ecs_task_definition" "keycloak" {\n  family                   = "keycloak"\n  requires_compatibilities = ["FARGATE"]\n  network_mode             = "awsvpc"\n  cpu                      = "1024"\n  memory                   = "2048"\n  container_definitions    = file("keycloak-container.json")\n}\nresource "aws_ecs_service" "keycloak" {\n  name            = "keycloak"\n  cluster         = aws_ecs_cluster.identity.id\n  task_definition = aws_ecs_task_definition.keycloak.arn\n  desired_count   = 3\n  launch_type     = "FARGATE"\n  network_configuration {\n    subnets          = ["subnet-xxxx", "subnet-yyyy"]\n    security_groups  = ["sg-xxxx"]\n    assign_public_ip = true\n  }\n  load_balancer {\n    target_group_arn = aws_lb_target_group.keycloak.arn\n    container_name   = "keycloak"\n    container_port   = 8080\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"54-observabilidad-y-monitoreo",children:"5.4 Observabilidad Y Monitoreo"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"M\xe9tricas de autenticaci\xf3n, latencia y errores expuestas v\xeda Prometheus y visualizadas en Grafana."}),"\n",(0,r.jsx)(n.li,{children:"Logs estructurados centralizados en Loki y ELK Stack."}),"\n",(0,r.jsx)(n.li,{children:"Trazas distribuidas recolectadas con OpenTelemetry y visualizadas en Jaeger."}),"\n",(0,r.jsx)(n.li,{children:"Ejemplo de integraci\xf3n de m\xe9tricas custom:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using Prometheus;\npublic class AuthMetrics\n{\n    private static readonly Counter AuthSuccess = Metrics.CreateCounter("auth_success_total", "Total de autenticaciones exitosas");\n    private static readonly Counter AuthFailure = Metrics.CreateCounter("auth_failure_total", "Total de autenticaciones fallidas");\n    public static void IncSuccess() => AuthSuccess.Inc();\n    public static void IncFailure() => AuthFailure.Inc();\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"55-relaci\xf3n-con-c4-y-structurizr-dsl",children:"5.5 Relaci\xf3n Con C4 Y Structurizr DSL"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cada bloque corresponde a un Container o Component en el modelo C4."}),"\n",(0,r.jsx)(n.li,{children:"Los tenants (realms) de Keycloak est\xe1n modelados expl\xedcitamente en los diagramas Structurizr DSL."}),"\n",(0,r.jsxs)(n.li,{children:["Las relaciones, flujos y dependencias t\xe9cnicas est\xe1n documentadas en los archivos ",(0,r.jsx)(n.code,{children:".dsl"})," bajo ",(0,r.jsx)(n.code,{children:"design/"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"56-modelo-de-datos-y-persistencia",children:"5.6 Modelo De Datos Y Persistencia"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Tabla"}),(0,r.jsx)(n.th,{children:"Prop\xf3sito"}),(0,r.jsx)(n.th,{children:"Relaciones Clave"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"REALM"}),(0,r.jsx)(n.td,{children:"Configuraci\xf3n de tenants (realms)"}),(0,r.jsxs)(n.td,{children:["1",":N"," con USERS, ROLES"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"USER_ENTITY"}),(0,r.jsx)(n.td,{children:"Usuarios principales"}),(0,r.jsxs)(n.td,{children:["N:1 con REALM, 1",":N"," con USER_ROLE_MAPPING"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"KEYCLOAK_ROLE"}),(0,r.jsx)(n.td,{children:"Definici\xf3n de roles"}),(0,r.jsxs)(n.td,{children:["N:1 con REALM, N",":M"," con USERS"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CLIENT"}),(0,r.jsx)(n.td,{children:"Aplicaciones cliente OAuth2"}),(0,r.jsx)(n.td,{children:"N:1 con REALM"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"USER_SESSION"}),(0,r.jsx)(n.td,{children:"Sesiones activas"}),(0,r.jsx)(n.td,{children:"N:1 con USER_ENTITY"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"user_profiles"}),(0,r.jsx)(n.td,{children:"Perfiles extendidos"}),(0,r.jsx)(n.td,{children:"1:1 con USER_ENTITY"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"identity_audit_log"}),(0,r.jsx)(n.td,{children:"Auditor\xeda de eventos"}),(0,r.jsx)(n.td,{children:"N:1 con USER_ENTITY, N:1 con REALM"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"57-interfaces-externas",children:"5.7 Interfaces Externas"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Servicio Integrado"}),(0,r.jsx)(n.th,{children:"Prop\xf3sito principal"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"API Gateway"}),(0,r.jsx)(n.td,{children:"Validaci\xf3n de tokens"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Notification Service"}),(0,r.jsx)(n.td,{children:"MFA, alertas"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Audit Service"}),(0,r.jsx)(n.td,{children:"Seguridad, eventos"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Corporate Services"}),(0,r.jsx)(n.td,{children:"Contexto de usuario"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Federation Partners"}),(0,r.jsx)(n.td,{children:"Integraci\xf3n IdPs externos"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Monitoring & Observability"}),(0,r.jsx)(n.td,{children:"M\xe9tricas, trazas, logs"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"58-ejemplos-t\xe9cnicos",children:"5.8 Ejemplos T\xe9cnicos"}),"\n",(0,r.jsx)(n.h3,{id:"token-exchange-oauth2oidc",children:"Token Exchange (OAuth2/OIDC)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "...",\n  "token_type": "Bearer",\n  "expires_in": 900,\n  "refresh_token": "...",\n  "id_token": "...",\n  "scope": "openid profile email tenant:peru"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"user-management-api",children:"User Management API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "userId": "uuid",\n  "tenantId": "peru|ecuador|colombia|mexico",\n  "username": "string",\n  "email": "string",\n  "profile": { "firstName": "string", "lastName": "string" },\n  "roles": ["role1", "role2"],\n  "attributes": { "employeeId": "string" }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"59-referencias",children:"5.9 Referencias"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.keycloak.org/docs/latest/server_admin/",children:"Keycloak Server Administration Guide"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://tools.ietf.org/html/rfc6749",children:"OAuth 2.0 RFC 6749"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect Core 1.0"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.arc42.org/section-5/",children:"Arc42 Componentes de Construcci\xf3n"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://c4model.com/",children:"C4 Model for Software Architecture"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>d});var s=i(96540);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);