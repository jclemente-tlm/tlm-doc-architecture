"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[4853],{5307:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"servicios-corporativos/servicio-notificacion/vista-implementacion","title":"7. Vista De Implementaci\xf3n","description":"7.1 Estructura Del Proyecto","source":"@site/docs/servicios-corporativos/servicio-notificacion/07-vista-implementacion.md","sourceDirName":"servicios-corporativos/servicio-notificacion","slug":"/servicios-corporativos/servicio-notificacion/vista-implementacion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/vista-implementacion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-notificacion/07-vista-implementacion.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"6. Vista De Tiempo De Ejecuci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/vista-tiempo-ejecucion"},"next":{"title":"8. Conceptos Transversales","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-notificacion/conceptos-transversales"}}');var r=n(74848),c=n(28453);const o={},a="7. Vista De Implementaci\xf3n",t={},d=[{value:"7.1 Estructura Del Proyecto",id:"71-estructura-del-proyecto",level:2},{value:"7.2 Dependencias Principales",id:"72-dependencias-principales",level:2},{value:"7.3 Infraestructura De Despliegue",id:"73-infraestructura-de-despliegue",level:2},{value:"Contenedores Principales",id:"contenedores-principales",level:3},{value:"Ejemplo de despliegue (Kubernetes)",id:"ejemplo-de-despliegue-kubernetes",level:4},{value:"Mensajer\xeda y Almacenamiento",id:"mensajer\xeda-y-almacenamiento",level:3},{value:"7.4 Entornos De Despliegue",id:"74-entornos-de-despliegue",level:2},{value:"7.5 Integraci\xf3n Con Proveedores",id:"75-integraci\xf3n-con-proveedores",level:2},{value:"Abstracci\xf3n de proveedores",id:"abstracci\xf3n-de-proveedores",level:3},{value:"7.6 Seguridad",id:"76-seguridad",level:2},{value:"7.7 Observabilidad Y Monitoreo",id:"77-observabilidad-y-monitoreo",level:2},{value:"7.8 CI/CD Pipeline",id:"78-cicd-pipeline",level:2},{value:"7.9 Estrategia De Escalado",id:"79-estrategia-de-escalado",level:2},{value:"7.10 Recuperaci\xf3n Ante Desastres",id:"710-recuperaci\xf3n-ante-desastres",level:2},{value:"Referencias",id:"referencias",level:2}];function l(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"7-vista-de-implementaci\xf3n",children:"7. Vista De Implementaci\xf3n"})}),"\n",(0,r.jsx)(i.h2,{id:"71-estructura-del-proyecto",children:"7.1 Estructura Del Proyecto"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Componente"}),(0,r.jsx)(i.th,{children:"Ubicaci\xf3n"}),(0,r.jsx)(i.th,{children:"Tecnolog\xeda"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Notification API"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/src/NotificationApi"})}),(0,r.jsxs)(i.td,{children:[(0,r.jsx)(i.code,{children:".NET 8 Web API"}),", YARP"]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Notification Processor"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/src/NotificationProcessor"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:".NET 8 Worker"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"PostgreSQL"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"AWS RDS"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"PostgreSQL 15+"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Redis"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"AWS ElastiCache"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"Redis 7+"})})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"File Storage"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"AWS EFS"})}),(0,r.jsx)(i.td,{children:"Sistema de archivos"})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"72-dependencias-principales",children:"7.2 Dependencias Principales"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Dependencia"}),(0,r.jsx)(i.th,{children:"Versi\xf3n"}),(0,r.jsx)(i.th,{children:"Prop\xf3sito"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Entity Framework"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"8.0+"})}),(0,r.jsx)(i.td,{children:"ORM"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"FluentValidation"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"11.0+"})}),(0,r.jsx)(i.td,{children:"Validaci\xf3n"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Mapster"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"7.0+"})}),(0,r.jsx)(i.td,{children:"Mapeo objetos"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"RazorEngine"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"4.0+"})}),(0,r.jsx)(i.td,{children:"Plantillas"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Serilog"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"3.0+"})}),(0,r.jsx)(i.td,{children:"Logging"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"OpenTelemetry"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"1.7+"})}),(0,r.jsx)(i.td,{children:"Trazas"})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"73-infraestructura-de-despliegue",children:"7.3 Infraestructura De Despliegue"}),"\n",(0,r.jsx)(i.h3,{id:"contenedores-principales",children:"Contenedores Principales"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"Notification API"}),": expuesto v\xeda YARP y ALB, escalable, acceso a base de datos y cola de mensajes."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"Notification Processor"}),": worker para procesamiento as\xedncrono, acceso a proveedores externos y Redis."]}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"ejemplo-de-despliegue-kubernetes",children:"Ejemplo de despliegue (Kubernetes)"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: notification-api\nspec:\n  replicas: 3\n  template:\n    spec:\n      containers:\n      - name: notification-api\n        image: corporativo/notification-api:latest\n        ports:\n        - containerPort: 8080\n        env:\n        - name: DATABASE_URL\n          valueFrom:\n            secretKeyRef:\n              name: db-secret\n              key: url\n        - name: KAFKA_BROKERS\n          value: "eventbus-cluster:9092"\n        resources:\n          requests:\n            memory: "512Mi"\n            cpu: "250m"\n          limits:\n            memory: "1Gi"\n            cpu: "500m"\n'})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: notification-processor\nspec:\n  replicas: 5\n  template:\n    spec:\n      containers:\n      - name: notification-processor\n        image: corporativo/notification-processor:latest\n        env:\n        - name: SENDGRID_API_KEY\n          valueFrom:\n            secretKeyRef:\n              name: email-secrets\n              key: sendgrid-key\n        - name: TWILIO_AUTH_TOKEN\n          valueFrom:\n            secretKeyRef:\n              name: sms-secrets\n              key: twilio-token\n        - name: REDIS_URL\n          value: "redis-cluster:6379"\n        resources:\n          requests:\n            memory: "256Mi"\n            cpu: "200m"\n          limits:\n            memory: "512Mi"\n            cpu: "400m"\n'})}),"\n",(0,r.jsx)(i.h3,{id:"mensajer\xeda-y-almacenamiento",children:"Mensajer\xeda y Almacenamiento"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Event Bus agn\xf3stico (",(0,r.jsx)(i.code,{children:"Kafka"}),"): 3 brokers, 12 particiones por t\xf3pico, retenci\xf3n 7 d\xedas."]}),"\n",(0,r.jsxs)(i.li,{children:["T\xf3picos principales: ",(0,r.jsx)(i.code,{children:"notification-requests"})," (delete, 7 d\xedas), ",(0,r.jsx)(i.code,{children:"notification-status"})," (compact, 30 d\xedas)."]}),"\n",(0,r.jsxs)(i.li,{children:["Almacenamiento de archivos: ",(0,r.jsx)(i.code,{children:"AWS EFS"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"74-entornos-de-despliegue",children:"7.4 Entornos De Despliegue"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Desarrollo:"})," ",(0,r.jsx)(i.code,{children:"minikube"}),", PostgreSQL local, Kafka y Redis single instance, Mailhog, logs locales."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Staging:"})," ",(0,r.jsx)(i.code,{children:"AWS EKS"}),", RDS, MSK, ElastiCache, SendGrid/Twilio test, Prometheus, Grafana, Loki, Jaeger, CloudWatch."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Producci\xf3n:"})," ",(0,r.jsx)(i.code,{children:"AWS EKS"})," multi-AZ, RDS multi-AZ, MSK, ElastiCache cluster, CloudFront, SendGrid+SES+Mailgun, Twilio+SNS+360dialog, FCM+APNS, WhatsApp Business API."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"75-integraci\xf3n-con-proveedores",children:"7.5 Integraci\xf3n Con Proveedores"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Email: SendGrid (primario), SES (secundario), Mailgun (emergencia)."}),"\n",(0,r.jsx)(i.li,{children:"SMS: Twilio (primario), SNS (secundario), 360dialog (WhatsApp)."}),"\n",(0,r.jsx)(i.li,{children:"Push: Firebase Cloud Messaging (FCM), Apple Push Notification Service (APNS)."}),"\n",(0,r.jsx)(i.li,{children:"WhatsApp: 360dialog, WhatsApp Business API."}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"abstracci\xf3n-de-proveedores",children:"Abstracci\xf3n de proveedores"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:"public interface INotificationProvider\n{\n    Task<DeliveryResult> SendAsync(NotificationMessage message);\n    Task<HealthStatus> CheckHealthAsync();\n    string ProviderName { get; }\n    NotificationChannel SupportedChannel { get; }\n}\n\npublic class EmailProviderFactory\n{\n    public IEmailProvider GetProvider(EmailProviderType type)\n    {\n        return type switch\n        {\n            EmailProviderType.SendGrid => new SendGridProvider(),\n            EmailProviderType.SES => new SesProvider(),\n            EmailProviderType.Mailgun => new MailgunProvider(),\n            _ => throw new NotSupportedException()\n        };\n    }\n}\n"})}),"\n",(0,r.jsx)(i.h2,{id:"76-seguridad",children:"7.6 Seguridad"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Autenticaci\xf3n y autorizaci\xf3n: Keycloak, validaci\xf3n JWT, control de roles y claims."}),"\n",(0,r.jsx)(i.li,{children:"Pol\xedticas de red: acceso restringido por capa (API, procesamiento, base de datos, cache)."}),"\n",(0,r.jsx)(i.li,{children:"Grupos de seguridad: control de puertos y or\xedgenes."}),"\n",(0,r.jsxs)(i.li,{children:["Gesti\xf3n de secretos: ",(0,r.jsx)(i.code,{children:"AWS Secrets Manager"})," para credenciales de proveedores."]}),"\n",(0,r.jsx)(i.li,{children:"Cifrado: AES-256 en reposo, TLS 1.3 en tr\xe1nsito, mTLS interno, protecci\xf3n de PII (hash, cifrado)."}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"77-observabilidad-y-monitoreo",children:"7.7 Observabilidad Y Monitoreo"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["M\xe9tricas: ",(0,r.jsx)(i.code,{children:"Prometheus"})," (notificaciones enviadas, entregadas, fallidas, tiempos de entrega, uso de API, profundidad de cola, tiempos de respuesta de proveedores, cache hit ratio)."]}),"\n",(0,r.jsxs)(i.li,{children:["Logging: ",(0,r.jsx)(i.code,{children:"Serilog"})," + ",(0,r.jsx)(i.code,{children:"Loki"})," (JSON, correlationId, niveles DEBUG/INFO/WARN/ERROR/FATAL)."]}),"\n",(0,r.jsxs)(i.li,{children:["Trazas: ",(0,r.jsx)(i.code,{children:"OpenTelemetry"})," + ",(0,r.jsx)(i.code,{children:"Jaeger"})," (API, procesamiento, proveedores, base de datos; sampling adaptativo por entorno)."]}),"\n",(0,r.jsxs)(i.li,{children:["Visualizaci\xf3n: ",(0,r.jsx)(i.code,{children:"Grafana"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"78-cicd-pipeline",children:"7.8 CI/CD Pipeline"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Build: GitHub Actions, .NET 8, tests, cobertura, SonarQube, Docker, Trivy, push a registry."}),"\n",(0,r.jsx)(i.li,{children:"Deploy: validaci\xf3n de manifiestos, despliegue a staging, pruebas de integraci\xf3n, carga y seguridad, aprobaci\xf3n manual, blue-green, smoke tests."}),"\n",(0,r.jsx)(i.li,{children:"Configuraci\xf3n: ConfigMap y Secrets por entorno."}),"\n",(0,r.jsxs)(i.li,{children:["Infraestructura como c\xf3digo: ",(0,r.jsx)(i.code,{children:"Terraform"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:["Migraciones: ",(0,r.jsx)(i.code,{children:"Liquibase"}),", cambios compatibles, rollback, pipeline validado y automatizado."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"79-estrategia-de-escalado",children:"7.9 Estrategia De Escalado"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"API: autoescalado 2-10 r\xe9plicas, CPU 70%, memoria 80%, requests/segundo."}),"\n",(0,r.jsx)(i.li,{children:"Processor: autoescalado 3-20 r\xe9plicas, lag de Kafka."}),"\n",(0,r.jsx)(i.li,{children:"Kafka: particionado por tipo, tenant y tiempo; consumer groups por tipo, DLQ para fallos."}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"710-recuperaci\xf3n-ante-desastres",children:"7.10 Recuperaci\xf3n Ante Desastres"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Backups: base de datos diaria, recuperaci\xf3n puntual 7 d\xedas, replicaci\xf3n cross-region, pruebas mensuales; backup de t\xf3picos y offsets."}),"\n",(0,r.jsx)(i.li,{children:"Objetivos: failover < 5 min, restart < 10 min, recuperaci\xf3n regi\xf3n < 1h, p\xe9rdida de datos < 1 min, cero p\xe9rdida en colas/configuraci\xf3n."}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"referencias",children:"Referencias"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://kubernetes.io/docs/concepts/configuration/overview/",children:"Kubernetes Mejores Pr\xe1cticas"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://microservices.io/patterns/deployment/",children:"Microservices Deployment Patterns"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://kafka.apache.org/documentation/#operations",children:"Event Bus agn\xf3stico Operations"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://docs.arc42.org/section-7/",children:"Arc42 Deployment View"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,c.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>a});var s=n(96540);const r={},c=s.createContext(r);function o(e){const i=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(c.Provider,{value:i},e.children)}}}]);