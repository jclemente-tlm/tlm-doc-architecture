"use strict";(self.webpackChunktlm_doc_architecture=self.webpackChunktlm_doc_architecture||[]).push([[7681],{28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(96540);const d={},t=r.createContext(d);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),r.createElement(t.Provider,{value:n},e.children)}},68757:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"servicios-corporativos/servicio-track-trace/vista-bloques-construccion","title":"5. Vista de Bloques de Construcci\xf3n","description":"Esta secci\xf3n describe la arquitectura modular del Sistema Track & Trace, basada en CQRS y Event Sourcing. Se detallan los contenedores, componentes principales, esquemas de datos y la relaci\xf3n entre los bloques, con diagramas C4 para ilustrar la estructura y la interacci\xf3n.","source":"@site/docs/servicios-corporativos/servicio-track-trace/05-vista-bloques-construccion.md","sourceDirName":"servicios-corporativos/servicio-track-trace","slug":"/servicios-corporativos/servicio-track-trace/vista-bloques-construccion","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/vista-bloques-construccion","draft":false,"unlisted":false,"editUrl":"https://github.com/jclemente-tlm/tlm-doc-architecture/edit/main/docs/servicios-corporativos/servicio-track-trace/05-vista-bloques-construccion.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"4. Estrategia de Soluci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/estrategia-solucion"},"next":{"title":"6. Vista de Tiempo de Ejecuci\xf3n","permalink":"/tlm-doc-architecture/docs/servicios-corporativos/servicio-track-trace/vista-tiempo-ejecucion"}}');var d=s(74848),t=s(28453);const i={},c="5. Vista de Bloques de Construcci\xf3n",l={},o=[{value:"5.1 Contenedores Principales",id:"51-contenedores-principales",level:2},{value:"5.2 Componentes del Command API",id:"52-componentes-del-command-api",level:2},{value:"5.3 Componentes del Query API",id:"53-componentes-del-query-api",level:2},{value:"5.4 Esquemas de Base de Datos",id:"54-esquemas-de-base-de-datos",level:2},{value:"5.4.1 Tabla: <code>event_store</code>",id:"541-tabla-event_store",level:3},{value:"5.4.2 Tabla: <code>read_models</code>",id:"542-tabla-read_models",level:3},{value:"5.5 Endpoints de API",id:"55-endpoints-de-api",level:2},{value:"5.6 Contratos de Datos (DTOs)",id:"56-contratos-de-datos-dtos",level:2},{value:"5.6.1 <code>EventRequest</code>",id:"561-eventrequest",level:3},{value:"5.6.2 <code>TraceResponse</code>",id:"562-traceresponse",level:3},{value:"5.7 Ejemplos de Implementaci\xf3n",id:"57-ejemplos-de-implementaci\xf3n",level:2},{value:"5.7.1 Controller de Eventos",id:"571-controller-de-eventos",level:3},{value:"5.7.2 Servicio de Consultas",id:"572-servicio-de-consultas",level:3}];function a(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"5-vista-de-bloques-de-construcci\xf3n",children:"5. Vista de Bloques de Construcci\xf3n"})}),"\n",(0,d.jsxs)(n.p,{children:["Esta secci\xf3n describe la arquitectura modular del ",(0,d.jsx)(n.strong,{children:"Sistema Track & Trace"}),", basada en CQRS y Event Sourcing. Se detallan los contenedores, componentes principales, esquemas de datos y la relaci\xf3n entre los bloques, con diagramas C4 para ilustrar la estructura y la interacci\xf3n."]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{alt:"Vista General del Sistema Track &amp; Trace",src:s(86058).A+"",width:"5390",height:"2721"}),"\n",(0,d.jsx)(n.em,{children:"Figura 5.1: Contenedores principales del sistema"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{alt:"Componentes Command API",src:s(80851).A+"",width:"4336",height:"2577"}),"\n",(0,d.jsx)(n.em,{children:"Figura 5.2: Componentes internos del Command API"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{alt:"Componentes Query API",src:s(80851).A+"",width:"4336",height:"2577"}),"\n",(0,d.jsx)(n.em,{children:"Figura 5.3: Componentes internos del Query API"})]}),"\n",(0,d.jsx)(n.h2,{id:"51-contenedores-principales",children:"5.1 Contenedores Principales"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Contenedor"}),(0,d.jsx)(n.th,{children:"Responsabilidad"}),(0,d.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Command API"})}),(0,d.jsx)(n.td,{children:"Ingesta de eventos (Write Side)"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:".NET 8 Web API"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Query API"})}),(0,d.jsx)(n.td,{children:"Consultas de trazabilidad (Read Side)"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:".NET 8 Web API"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Event Store"})}),(0,d.jsx)(n.td,{children:"Almacenamiento inmutable de eventos"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"PostgreSQL 15+"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Read Models"})}),(0,d.jsx)(n.td,{children:"Vistas optimizadas para consultas"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"PostgreSQL 15+"})})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"52-componentes-del-command-api",children:"5.2 Componentes del Command API"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Componente"}),(0,d.jsx)(n.th,{children:"Responsabilidad"}),(0,d.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Event Controller"})}),(0,d.jsx)(n.td,{children:"Endpoint REST para eventos"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"ASP.NET Core"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Event Validator"})}),(0,d.jsx)(n.td,{children:"Validaci\xf3n de eventos"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"FluentValidation"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Event Store Service"})}),(0,d.jsx)(n.td,{children:"Persistencia de eventos"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:".NET 8"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Event Publisher"})}),(0,d.jsx)(n.td,{children:"Publicaci\xf3n de eventos a bus"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:".NET 8"})})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"53-componentes-del-query-api",children:"5.3 Componentes del Query API"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Componente"}),(0,d.jsx)(n.th,{children:"Responsabilidad"}),(0,d.jsx)(n.th,{children:"Tecnolog\xeda"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Query Controller"})}),(0,d.jsx)(n.td,{children:"Endpoints REST y GraphQL"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"ASP.NET Core"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Query Handler"})}),(0,d.jsx)(n.td,{children:"Procesamiento de consultas"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:".NET 8"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Read Model Service"})}),(0,d.jsx)(n.td,{children:"Acceso a vistas optimizadas"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Entity Framework"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.strong,{children:"Analytics Service"})}),(0,d.jsx)(n.td,{children:"An\xe1lisis de patrones y m\xe9tricas"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:".NET 8"})})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"54-esquemas-de-base-de-datos",children:"5.4 Esquemas de Base de Datos"}),"\n",(0,d.jsxs)(n.h3,{id:"541-tabla-event_store",children:["5.4.1 Tabla: ",(0,d.jsx)(n.code,{children:"event_store"})]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Campo"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"}),(0,d.jsx)(n.th,{children:"Restricciones"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"id"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"UUID"})}),(0,d.jsx)(n.td,{children:"Identificador \xfanico de evento"}),(0,d.jsx)(n.td,{children:"PRIMARY KEY"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"aggregate_id"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"UUID"})}),(0,d.jsx)(n.td,{children:"ID de la entidad agregada"}),(0,d.jsx)(n.td,{children:"NOT NULL, INDEX"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event_type"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"VARCHAR(100)"})}),(0,d.jsx)(n.td,{children:"Tipo de evento"}),(0,d.jsx)(n.td,{children:"NOT NULL"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"payload"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"JSONB"})}),(0,d.jsx)(n.td,{children:"Datos del evento"}),(0,d.jsx)(n.td,{children:"NOT NULL"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"timestamp"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"TIMESTAMP"})}),(0,d.jsx)(n.td,{children:"Fecha de ocurrencia"}),(0,d.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"correlation_id"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"VARCHAR(100)"})}),(0,d.jsx)(n.td,{children:"ID de correlaci\xf3n"}),(0,d.jsx)(n.td,{children:"NULL, INDEX"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"tenant_id"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"VARCHAR(50)"})}),(0,d.jsx)(n.td,{children:"Identificador del tenant"}),(0,d.jsx)(n.td,{children:"NOT NULL, INDEX"})]})]})]}),"\n",(0,d.jsxs)(n.h3,{id:"542-tabla-read_models",children:["5.4.2 Tabla: ",(0,d.jsx)(n.code,{children:"read_models"})]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Campo"}),(0,d.jsx)(n.th,{children:"Tipo"}),(0,d.jsx)(n.th,{children:"Descripci\xf3n"}),(0,d.jsx)(n.th,{children:"Restricciones"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"id"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"UUID"})}),(0,d.jsx)(n.td,{children:"Identificador \xfanico"}),(0,d.jsx)(n.td,{children:"PRIMARY KEY"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"model_type"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"VARCHAR(100)"})}),(0,d.jsx)(n.td,{children:"Tipo de vista"}),(0,d.jsx)(n.td,{children:"NOT NULL"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"data"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"JSONB"})}),(0,d.jsx)(n.td,{children:"Datos optimizados para consulta"}),(0,d.jsx)(n.td,{children:"NOT NULL"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"updated_at"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"TIMESTAMP"})}),(0,d.jsx)(n.td,{children:"\xdaltima actualizaci\xf3n"}),(0,d.jsx)(n.td,{children:"NOT NULL, DEFAULT NOW()"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"tenant_id"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"VARCHAR(50)"})}),(0,d.jsx)(n.td,{children:"Identificador del tenant"}),(0,d.jsx)(n.td,{children:"NOT NULL, INDEX"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"55-endpoints-de-api",children:"5.5 Endpoints de API"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"POST"})," ",(0,d.jsx)(n.code,{children:"/api/v1/events"}),": Ingesta de nuevos eventos operacionales"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"GET"})," ",(0,d.jsx)(n.code,{children:"/api/v1/trace/{correlationId}"}),": Consulta de trazabilidad por correlaci\xf3n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"GET"})," ",(0,d.jsx)(n.code,{children:"/api/v1/analytics"}),": M\xe9tricas y an\xe1lisis de eventos"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"GraphQL"})," ",(0,d.jsx)(n.code,{children:"/api/v1/query"}),": Consultas avanzadas sobre modelos de lectura"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"56-contratos-de-datos-dtos",children:"5.6 Contratos de Datos (DTOs)"}),"\n",(0,d.jsxs)(n.h3,{id:"561-eventrequest",children:["5.6.1 ",(0,d.jsx)(n.code,{children:"EventRequest"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-csharp",children:"public class EventRequest\n{\n    public string EventType { get; set; }\n    public Guid AggregateId { get; set; }\n    public string TenantId { get; set; }\n    public DateTime Timestamp { get; set; }\n    public Dictionary<string, object> Payload { get; set; }\n    public string CorrelationId { get; set; }\n}\n"})}),"\n",(0,d.jsxs)(n.h3,{id:"562-traceresponse",children:["5.6.2 ",(0,d.jsx)(n.code,{children:"TraceResponse"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-csharp",children:"public class TraceResponse\n{\n    public string CorrelationId { get; set; }\n    public List<EventDto> Events { get; set; }\n}\n\npublic class EventDto\n{\n    public string EventType { get; set; }\n    public DateTime Timestamp { get; set; }\n    public Dictionary<string, object> Payload { get; set; }\n}\n"})}),"\n",(0,d.jsx)(n.h2,{id:"57-ejemplos-de-implementaci\xf3n",children:"5.7 Ejemplos de Implementaci\xf3n"}),"\n",(0,d.jsx)(n.h3,{id:"571-controller-de-eventos",children:"5.7.1 Controller de Eventos"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-csharp",children:'[ApiController]\n[Route("api/v1/events")]\npublic class EventsController : ControllerBase\n{\n    private readonly IEventService _eventService;\n    private readonly ILogger<EventsController> _logger;\n\n    public EventsController(IEventService eventService, ILogger<EventsController> logger)\n    {\n        _eventService = eventService;\n        _logger = logger;\n    }\n\n    [HttpPost]\n    public async Task<IActionResult> IngestEvent([FromBody] EventRequest request)\n    {\n        try\n        {\n            await _eventService.IngestAsync(request);\n            return Accepted();\n        }\n        catch (ValidationException ex)\n        {\n            return BadRequest(new { error = ex.Message });\n        }\n        catch (Exception ex)\n        {\n            _logger.LogError(ex, "Error ingesting event {CorrelationId}", request.CorrelationId);\n            return StatusCode(500, new { error = "Internal server error" });\n        }\n    }\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"572-servicio-de-consultas",children:"5.7.2 Servicio de Consultas"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-csharp",children:"public class QueryService : IQueryService\n{\n    public async Task<TraceResponse> GetTraceAsync(string correlationId)\n    {\n        // L\xf3gica para recuperar eventos correlacionados\n        // ...\n    }\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},80851:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/track_and_trace_tracking_api-c05b70014020cfca4e9c740936a2b4ac.png"},86058:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/track_and_trace_system-7f3941e4bf53212f667bd41a76d48226.png"}}]);